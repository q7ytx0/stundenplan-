<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zyro - Modernes Schulverwaltungssystem</title>
    <style>
        /* Tailwind-ähnliche Basisstile */
        :root {
            --primary-50: #eef2ff;
            --primary-100: #e0e7ff;
            --primary-200: #c7d2fe;
            --primary-300: #a5b4fc;
            --primary-400: #818cf8;
            --primary-500: #6366f1;
            --primary-600: #4f46e5;
            --primary-700: #4338ca;
            --primary-800: #3730a3;
            --primary-900: #312e81;
            --primary-950: #1e1b4b;
            
            --secondary-50: #f0fdfa;
            --secondary-100: #ccfbf1;
            --secondary-200: #99f6e4;
            --secondary-300: #5eead4;
            --secondary-400: #2dd4bf;
            --secondary-500: #14b8a6;
            --secondary-600: #0d9488;
            --secondary-700: #0f766e;
            --secondary-800: #115e59;
            --secondary-900: #134e4a;
            --secondary-950: #042f2e;
            
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            --gray-950: #030712;
            
            --foreground-rgb: 0, 0, 0;
            --background-rgb: 255, 255, 255;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            color: rgb(var(--foreground-rgb));
            background: var(--gray-50);
            min-height: 100vh;
        }
        
        /* Login-Seite Stile */
        .login-page {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: url('hintergrund.jfif') no-repeat center center; /* Hintergrundbild mit .jfif-Endung */
            background-size: cover; /* Bild so skalieren, dass es den gesamten Bereich abdeckt */
            padding: 1rem;
            position: relative;
            overflow: hidden;
        }
        
        .login-page video {
            display: none; /* Video ausblenden */
        }
        
        .login-container {
            background-color: rgba(255, 255, 255, 0.5); /* 50% durchsichtig */
            backdrop-filter: blur(5px); /* Unschärfeeffekt für bessere Lesbarkeit */
            -webkit-backdrop-filter: blur(5px); /* Für Safari */
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            max-width: 64rem;
            width: 100%;
            display: flex;
            flex-direction: column;
            position: relative;
            z-index: 1;
        }
        
        @media (min-width: 768px) {
            .login-container {
                flex-direction: row;
            }
        }
        
        .login-sidebar {
            background-color: rgba(79, 70, 229, 0.8); /* Leicht transparenter Hintergrund für die Sidebar */
            padding: 3rem;
            color: white;
            display: none;
        }
        
        @media (min-width: 768px) {
            .login-sidebar {
                display: flex;
                flex-direction: column;
                justify-content: center;
                width: 50%;
            }
        }
        
        .login-sidebar h1 {
            font-size: 2.25rem;
            font-weight: bold;
            margin-bottom: 1.5rem;
        }
        
        .login-sidebar p {
            font-size: 1.25rem;
            margin-bottom: 2rem;
        }
        
        .features {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .feature {
            display: flex;
            align-items: center;
        }
        
        .feature-icon {
            background-color: rgba(255, 255, 255, 0.2);
            padding: 0.5rem;
            border-radius: 9999px;
            margin-right: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .login-content {
            padding: 3rem;
        }
        
        @media (min-width: 768px) {
            .login-content {
                width: 50%;
            }
        }
        
        .login-content h2 {
            font-size: 1.875rem;
            font-weight: bold;
            color: var(--primary-600);
            margin-bottom: 2rem;
            text-align: center;
        }
        
        @media (min-width: 768px) {
            .login-content h2 {
                text-align: left;
            }
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--gray-700);
            margin-bottom: 0.25rem;
        }
        
        input[type="text"],
        input[type="password"] {
            width: 100%;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            border: 1px solid var(--gray-300);
            outline: none;
        }
        
        input[type="text"]:focus,
        input[type="password"]:focus {
            outline: none;
            box-shadow: 0 0 0 2px var(--primary-500);
        }
        
        .form-footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }
        
        .remember-me {
            display: flex;
            align-items: center;
        }
        
        .remember-me input {
            height: 1rem;
            width: 1rem;
            color: var(--primary-600);
            border-color: var(--gray-300);
            border-radius: 0.25rem;
        }
        
        .remember-me label {
            margin-left: 0.5rem;
            display: inline;
        }
        
        .forgot-password {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--primary-600);
            text-decoration: none;
        }
        
        .forgot-password:hover {
            color: var(--primary-500);
        }
        
        button {
            width: 100%;
            display: flex;
            justify-content: center;
            padding: 0.75rem 1rem;
            border: 1px solid transparent;
            border-radius: 0.5rem;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            font-size: 0.875rem;
            font-weight: 500;
            color: white;
            background-color: var(--primary-600);
            cursor: pointer;
        }
        
        button:hover {
            background-color: var(--primary-700);
        }
        
        button:focus {
            outline: none;
            box-shadow: 0 0 0 2px white, 0 0 0 4px var(--primary-500);
        }
        
        /* Dashboard Stile */
        .dashboard {
            display: none;
            min-height: 100vh;
            background-color: var(--gray-50);
        }
        
        .navigation {
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            width: 16rem;
            background-color: rgba(255, 255, 255, 0.5); /* 50% durchsichtig */
            backdrop-filter: blur(5px); /* Unschärfeeffekt für bessere Lesbarkeit */
            -webkit-backdrop-filter: blur(5px); /* Für Safari */
            border-right: 1px solid var(--gray-200);
            z-index: 10;
            transform: translateX(-100%);
            transition: transform 0.3s ease;
        }
        
        @media (min-width: 768px) {
            .navigation {
                transform: translateX(0);
            }
        }
        
        .navigation.open {
            transform: translateX(0);
        }
        
        .nav-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--gray-200);
        }
        
        .nav-logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-600);
        }
        
        .nav-links {
            padding: 1.5rem 0;
        }
        
        .nav-link {
            display: flex;
            align-items: center;
            padding: 0.75rem 1.5rem;
            color: var(--gray-600);
            text-decoration: none;
            transition: background-color 0.2s;
        }
        
        .nav-link:hover {
            background-color: var(--gray-50);
        }
        
        .nav-link.active {
            background-color: var(--primary-50);
            color: var(--primary-600);
            border-left: 3px solid var(--primary-600);
        }
        
        .nav-link-icon {
            margin-right: 0.75rem;
        }
        
        .main-content {
            padding-left: 0;
        }
        
        @media (min-width: 768px) {
            .main-content {
                padding-left: 16rem;
            }
        }
        
        .header {
            position: sticky;
            top: 0;
            background-color: white;
            border-bottom: 1px solid var(--gray-200);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            height: 4rem;
            display: flex;
            align-items: center;
            padding: 0 1rem;
            z-index: 5;
        }
        
        .menu-button {
            display: block;
            margin-right: 1rem;
            background: none;
            border: none;
            color: var(--gray-600);
            cursor: pointer;
            width: auto;
        }
        
        @media (min-width: 768px) {
            .menu-button {
                display: none;
            }
        }
        
        .page-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--gray-900);
        }
        
        .header-actions {
            margin-left: auto;
            display: flex;
            align-items: center;
        }
        
        .notification-button {
            background: none;
            border: none;
            color: var(--gray-400);
            cursor: pointer;
            width: auto;
            padding: 0.5rem;
            margin-right: 1rem;
        }
        
        .notification-button:hover {
            color: var(--gray-500);
        }
        
        /* Nachrichten-Modal Stile */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 100;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        
        .modal.open {
            display: flex !important;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 32rem;
            max-height: 90vh;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        
        .modal-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--gray-900);
        }
        
        .modal-close {
            background: none;
            border: none;
            color: var(--gray-500);
            cursor: pointer;
            width: auto;
            padding: 0.5rem;
        }
        
        .modal-body {
            padding: 1.5rem;
            flex: 1;
        }
        
        .modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--gray-200);
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
        }
        
        .recipients-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .recipient {
            display: flex;
            align-items: center;
            padding: 0.5rem;
            border-radius: 0.25rem;
            cursor: pointer;
        }
        
        .recipient:hover {
            background-color: var(--gray-100);
        }
        
        .recipient.selected {
            background-color: var(--primary-50);
        }
        
        .recipient-name {
            font-weight: 500;
            margin-left: 0.75rem;
        }
        
        .recipient-role {
            font-size: 0.75rem;
            color: var(--gray-500);
            margin-left: auto;
        }
        
        .message-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .form-label {
            font-weight: 500;
            color: var(--gray-700);
            margin-bottom: 0.25rem;
        }
        
        .message-input {
            width: 100%;
            border: 1px solid var(--gray-300);
            border-radius: 0.375rem;
            padding: 0.75rem;
            min-height: 8rem;
            resize: vertical;
        }
        
        .message-input:focus {
            outline: none;
            border-color: var(--primary-500);
            box-shadow: 0 0 0 2px var(--primary-100);
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .btn-secondary {
            background-color: white;
            color: var(--gray-700);
            border: 1px solid var(--gray-300);
        }
        
        .btn-secondary:hover {
            background-color: var(--gray-50);
        }
        
        .btn-primary {
            background-color: var(--primary-600);
            color: white;
            border: 1px solid transparent;
        }
        
        .btn-primary:hover {
            background-color: var(--primary-700);
        }
        
        .content {
            padding: 1.5rem;
        }
        
        @media (min-width: 640px) {
            .content {
                padding: 1.5rem 2rem;
            }
        }
        
        .card {
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--gray-900);
        }
        
        .grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }
        
        @media (min-width: 1024px) {
            .grid {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        .col-span-full {
            grid-column: 1 / -1;
        }
        
        /* Stundenplan Stile */
        .timetable {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .timetable-day {
            border: 1px solid var(--gray-200);
            border-radius: 0.5rem;
            overflow: hidden;
        }
        
        .day-header {
            background-color: var(--gray-100);
            padding: 0.75rem 1rem;
            font-weight: 600;
            color: var(--gray-700);
            border-bottom: 1px solid var(--gray-200);
        }
        
        .lesson {
            display: flex;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--gray-200);
        }
        
        .lesson:last-child {
            border-bottom: none;
        }
        
        .lesson-time {
            width: 7rem;
            color: var(--gray-500);
            font-size: 0.875rem;
        }
        
        .lesson-content {
            flex: 1;
        }
        
        .lesson-subject {
            font-weight: 500;
            color: var(--gray-900);
        }
        
        .lesson-info {
            font-size: 0.875rem;
            color: var(--gray-500);
        }
        
        /* Noten Stile */
        .grades {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .subject {
            padding: 1rem;
            border: 1px solid var(--gray-200);
            border-radius: 0.5rem;
        }
        
        .subject-name {
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 0.5rem;
        }
        
        .subject-grades {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        .grade {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            font-weight: 600;
            color: white;
        }
        
        .grade.excellent {
            background-color: #10b981; /* Grün */
        }
        
        .grade.good {
            background-color: #3b82f6; /* Blau */
        }
        
        .grade.average {
            background-color: #f59e0b; /* Gelb */
        }
        
        .grade.poor {
            background-color: #ef4444; /* Rot */
        }
        
        .subject-average {
            font-size: 0.875rem;
            color: var(--gray-600);
        }
        
        /* Nachrichten Stile */
        .messages {
            display: flex;
            flex-direction: column;
        }
        
        .message {
            padding: 1rem;
            border-bottom: 1px solid var(--gray-200);
            display: grid;
            grid-template-columns: 1fr auto;
            grid-template-areas:
                "sender time"
                "subject subject"
                "preview preview";
            gap: 0.25rem;
        }
        
        .message:last-child {
            border-bottom: none;
        }
        
        .message-sender {
            grid-area: sender;
            font-weight: 600;
            color: var(--gray-900);
        }
        
        .message-time {
            grid-area: time;
            font-size: 0.75rem;
            color: var(--gray-500);
        }
        
        .message-subject {
            grid-area: subject;
            font-weight: 500;
        }
        
        .message-preview {
            grid-area: preview;
            font-size: 0.875rem;
            color: var(--gray-600);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .view-all {
            color: var(--primary-600);
            font-size: 0.875rem;
            font-weight: 500;
            text-decoration: none;
        }
        
        .view-all:hover {
            color: var(--primary-700);
            text-decoration: underline;
        }
        
        /* Benachrichtigungen Dropdown */
        .notifications-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            width: 320px;
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            margin-top: 0.5rem;
            z-index: 50;
            max-height: 400px;
            overflow-y: auto;
            display: none;
        }
        
        .notifications-dropdown.open {
            display: block;
        }
        
        .notifications-header {
            padding: 1rem;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .notifications-title {
            font-weight: 600;
            color: var(--gray-900);
        }
        
        .mark-all-read {
            font-size: 0.875rem;
            color: var(--primary-600);
            cursor: pointer;
        }
        
        .notifications-list {
            padding: 0.5rem 0;
        }
        
        .notification-item {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--gray-100);
            cursor: pointer;
            display: flex;
            gap: 0.75rem;
            align-items: flex-start;
        }
        
        .notification-item:last-child {
            border-bottom: none;
        }
        
        .notification-item:hover {
            background-color: var(--gray-50);
        }
        
        .notification-icon {
            background-color: var(--primary-100);
            color: var(--primary-600);
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .notification-content {
            flex: 1;
        }
        
        .notification-title {
            font-weight: 500;
            color: var(--gray-900);
            margin-bottom: 0.25rem;
            font-size: 0.875rem;
        }
        
        .notification-message {
            color: var(--gray-600);
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
        }
        
        .notification-time {
            color: var(--gray-500);
            font-size: 0.75rem;
        }
        
        .notification-unread {
            position: relative;
        }
        
        .notification-unread::before {
            content: '';
            position: absolute;
            top: 1rem;
            left: 0.5rem;
            width: 0.5rem;
            height: 0.5rem;
            border-radius: 50%;
            background-color: var(--primary-500);
        }
        
        .notification-empty {
            padding: 2rem 1rem;
            text-align: center;
            color: var(--gray-500);
        }
        
        /* Profil Dropdown */
        .profile-container {
            position: relative;
            margin-left: 1rem;
        }
        
        .profile-button {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 50%;
            border: 2px solid transparent;
            transition: border-color 0.2s;
        }
        
        .profile-button:hover {
            border-color: var(--gray-200);
        }
        
        .profile-image {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            object-fit: cover;
            background-color: var(--primary-100);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-600);
            font-weight: 600;
            font-size: 1rem;
        }
        
        .profile-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            width: 250px;
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            margin-top: 0.5rem;
            z-index: 50;
            display: none;
            overflow: hidden;
        }
        
        .profile-dropdown.open {
            display: block;
        }
        
        .profile-header {
            padding: 1rem;
            border-bottom: 1px solid var(--gray-200);
            text-align: center;
        }
        
        .profile-name {
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 0.25rem;
        }
        
        .profile-email {
            font-size: 0.875rem;
            color: var(--gray-600);
        }
        
        .profile-menu {
            padding: 0.5rem 0;
        }
        
        .profile-menu-item {
            padding: 0.75rem 1rem;
            display: flex;
            align-items: center;
            color: var(--gray-700);
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .profile-menu-item:hover {
            background-color: var(--gray-50);
        }
        
        .profile-menu-icon {
            margin-right: 0.75rem;
            width: 1.25rem;
            height: 1.25rem;
            color: var(--gray-500);
        }
        
        .profile-menu-text {
            font-size: 0.875rem;
        }
        
        .profile-menu-divider {
            height: 1px;
            background-color: var(--gray-200);
            margin: 0.5rem 0;
        }
        
        .logout-item {
            color: #ef4444;
        }
        
        .logout-item .profile-menu-icon {
            color: #ef4444;
        }
        
        /* Seiten-Container (Stundenplan, Noten, Nachrichten) */
        .page-container {
            display: none;
            padding: 1.5rem;
        }
        
        .page-container.active {
            display: block;
        }
        
        /* Voller Stundenplan */
        .full-timetable {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .time-column {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .time-header {
            background-color: var(--primary-600);
            color: white;
            text-align: center;
            padding: 0.75rem;
            border-radius: 0.5rem 0.5rem 0 0;
            font-weight: 600;
        }
        
        .time-slot {
            border: 1px solid var(--gray-200);
            border-radius: 0.5rem;
            padding: 0.75rem;
            display: flex;
            flex-direction: column;
            background-color: white;
        }
        
        .time-slot-empty {
            background-color: var(--gray-50);
            color: var(--gray-400);
            justify-content: center;
            align-items: center;
            min-height: 5rem;
        }
        
        .time-slot-time {
            font-size: 0.75rem;
            color: var(--gray-500);
            margin-bottom: 0.25rem;
        }
        
        .time-slot-subject {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .time-slot-info {
            font-size: 0.75rem;
            color: var(--gray-600);
        }
        
        /* Alle Noten */
        .all-grades {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        
        .grade-card {
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
        }
        
        .grade-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--gray-200);
        }
        
        .grade-card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--gray-900);
        }
        
        .grade-card-average {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            font-weight: 600;
            color: white;
        }
        
        .grade-card-content {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .grade-entry {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--gray-100);
        }
        
        .grade-entry:last-child {
            border-bottom: none;
        }
        
        .grade-entry-title {
            font-weight: 500;
        }
        
        .grade-entry-date {
            font-size: 0.75rem;
            color: var(--gray-500);
        }
        
        /* Alle Nachrichten */
        .messages-container {
            display: flex;
            height: calc(100vh - 11rem);
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        .messages-sidebar {
            width: 300px;
            border-right: 1px solid var(--gray-200);
            display: flex;
            flex-direction: column;
        }
        
        .messages-search {
            padding: 1rem;
            border-bottom: 1px solid var(--gray-200);
        }
        
        .messages-search-input {
            width: 100%;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            border: 1px solid var(--gray-300);
            background-color: var(--gray-50);
        }
        
        .messages-search-input:focus {
            outline: none;
            border-color: var(--primary-500);
            background-color: white;
        }
        
        .messages-list {
            flex: 1;
            overflow-y: auto;
        }
        
        .message-preview {
            padding: 1rem;
            border-bottom: 1px solid var(--gray-100);
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .message-preview:hover {
            background-color: var(--gray-50);
        }
        
        .message-preview.active {
            background-color: var(--primary-50);
        }
        
        .message-preview-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.25rem;
        }
        
        .message-preview-sender {
            font-weight: 600;
            color: var(--gray-900);
        }
        
        .message-preview-time {
            font-size: 0.75rem;
            color: var(--gray-500);
        }
        
        .message-preview-subject {
            font-weight: 500;
            margin-bottom: 0.25rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .message-preview-text {
            font-size: 0.875rem;
            color: var(--gray-600);
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }
        
        .message-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .message-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--gray-200);
        }
        
        .message-subject {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .message-meta {
            display: flex;
            gap: 1rem;
            color: var(--gray-600);
            font-size: 0.875rem;
        }
        
        .message-sender {
            font-weight: 500;
        }
        
        .message-body {
            padding: 1.5rem;
            flex: 1;
            overflow-y: auto;
            line-height: 1.6;
        }
        
        .message-reply {
            padding: 1.5rem;
            border-top: 1px solid var(--gray-200);
        }
        
        .message-reply-input {
            width: 100%;
            padding: 1rem;
            border: 1px solid var(--gray-300);
            border-radius: 0.5rem;
            resize: none;
            min-height: 6rem;
        }
        
        .message-reply-input:focus {
            outline: none;
            border-color: var(--primary-500);
        }
        
        .message-actions {
            margin-top: 1rem;
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
        }
        
        .login-tabs {
            display: flex;
            margin-bottom: 2rem;
            border-bottom: 1px solid var(--gray-200);
        }
        
        .login-tab {
            padding: 0.75rem 1rem;
            font-weight: 500;
            color: var(--gray-600);
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }
        
        .login-tab.active {
            color: var(--primary-600);
            border-bottom-color: var(--primary-600);
        }
        
        .login-form {
            display: none;
        }
        
        .login-form.active {
            display: block;
        }
        
        /* Schulsuche-Dropdown */
        .school-search-container {
            position: relative;
        }
        
        .school-search-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            border: 1px solid var(--gray-300);
            outline: none;
        }
        
        .school-search-input:focus {
            border-color: var(--primary-500);
            box-shadow: 0 0 0 2px var(--primary-100);
        }
        
        .school-search-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: white;
            border: 1px solid var(--gray-300);
            border-radius: 0 0 0.5rem 0.5rem;
            max-height: 200px;
            overflow-y: auto;
            z-index: 10;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            display: none;
        }
        
        .school-search-dropdown.open {
            display: block;
        }
        
        .school-item {
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .school-item:hover {
            background-color: var(--gray-100);
        }
        
        .school-name {
            font-weight: 500;
            margin-bottom: 0.25rem;
        }
        
        .school-address {
            font-size: 0.75rem;
            color: var(--gray-600);
        }
        
        .contact-toggle {
            display: flex;
            border-radius: 0.5rem;
            overflow: hidden;
            margin-bottom: 1rem;
            border: 1px solid var(--gray-300);
        }
        
        .contact-option {
            flex: 1;
            text-align: center;
            padding: 0.5rem;
            background-color: white;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .contact-option.active {
            background-color: var(--primary-100);
            color: var(--primary-700);
            font-weight: 500;
        }
        
        /* Stil für mehrstufiges Registrierungsformular */
        .register-steps {
            width: 100%;
        }
        
        .register-step {
            display: none;
        }
        
        .register-step.active {
            display: block;
        }
        
        .form-footer {
            display: flex;
            justify-content: space-between;
            margin-top: 1.5rem;
        }
        
        .form-footer button {
            width: auto;
            min-width: 100px;
        }
        
        .form-footer button:only-child {
            margin-left: auto;
        }
        
        small {
            display: block;
            color: var(--gray-500);
            font-size: 0.75rem;
            margin-top: 0.25rem;
        }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="schools.js"></script>
</head>
<body>
    <!-- Event-Listener für das Laden der Profildaten -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Event-Listener für das Öffnen des Profil-Modals
            const profileModal = document.getElementById('profile-modal');
            if (profileModal) {
                profileModal.addEventListener('click', function(event) {
                    if (event.target === this) {
                        this.classList.remove('open');
                    }
                });
            }
            
            // Event-Listener für das Öffnen des Einstellungen-Modals
            const settingsModal = document.getElementById('settings-modal');
            if (settingsModal) {
                settingsModal.addEventListener('click', function(event) {
                    if (event.target === this) {
                        this.classList.remove('open');
                    }
                });
            }
            
            // Event-Listener für das Öffnen des Benachrichtigungen-Modals
            const notificationsModal = document.getElementById('notifications-modal');
            if (notificationsModal) {
                notificationsModal.addEventListener('click', function(event) {
                    if (event.target === this) {
                        this.classList.remove('open');
                    }
                });
            }
            
            // Event-Listener für das Öffnen des Datenschutz-Modals
            const privacyModal = document.getElementById('privacy-modal');
            if (privacyModal) {
                privacyModal.addEventListener('click', function(event) {
                    if (event.target === this) {
                        this.classList.remove('open');
                    }
                });
            }
            
            // Profildaten laden, wenn das Profil-Modal geöffnet wird
            if (profileModal) {
                const profileModalObserver = new MutationObserver(function(mutations) {
                    mutations.forEach(function(mutation) {
                        if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                            if (profileModal.classList.contains('open')) {
                                // Benutzerdaten aus dem localStorage holen
                                const currentUser = JSON.parse(localStorage.getItem('zyroUser') || '{}');
                                
                                // Formularfelder mit den aktuellen Daten füllen
                                document.getElementById('profile-fullname').value = currentUser.fullname || '';
                                document.getElementById('profile-username').value = currentUser.username || '';
                                document.getElementById('profile-email').value = currentUser.contact || '';
                                document.getElementById('profile-school').value = currentUser.school || '';
                                
                                // Initiale im großen Profilbild anzeigen
                                const profileImageLarge = document.getElementById('profile-image-large');
                                if (profileImageLarge) {
                                    const initial = (currentUser.fullname || currentUser.username || '').charAt(0).toUpperCase();
                                    profileImageLarge.textContent = initial;
                                }
                            }
                        }
                    });
                });
                
                // Beobachter für das Profil-Modal starten
                profileModalObserver.observe(profileModal, { attributes: true });
            }
        });
    </script>

    <!-- Chat-System -->
    <div class="modal" id="chat-system-modal">
        <div class="modal-content" style="max-width: 800px; height: 80vh;">
            <div class="modal-header">
                <h2 class="modal-title">Chat mit Benutzern</h2>
                <button class="modal-close" onclick="document.getElementById('chat-system-modal').classList.remove('open');">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="modal-body" style="display: flex; flex-direction: column; height: calc(100% - 120px); padding: 0;">
                <div style="display: flex; height: 100%;">
                    <!-- Benutzerliste -->
                    <div style="width: 200px; border-right: 1px solid var(--gray-200); overflow-y: auto;">
                        <div style="padding: 1rem;">
                            <input type="text" id="user-search" placeholder="Benutzer suchen..." style="width: 100%; padding: 0.5rem; border-radius: 0.25rem; border: 1px solid var(--gray-300);">
                        </div>
                        <div id="chat-users-list" style="display: flex; flex-direction: column;">
                            <!-- Benutzer werden hier dynamisch eingefügt -->
                        </div>
                    </div>
                    
                    <!-- Chat-Bereich -->
                    <div style="flex: 1; display: flex; flex-direction: column; height: 100%;">
                        <div id="chat-messages" style="flex: 1; padding: 1rem; overflow-y: auto; background-color: var(--gray-50);">
                            <!-- Nachrichten werden hier dynamisch eingefügt -->
                            <div class="chat-welcome" style="text-align: center; margin-top: 2rem; color: var(--gray-500);">
                                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" style="margin: 0 auto 1rem;">
                                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                                </svg>
                                <h3>Willkommen im Chat</h3>
                                <p>Wähle einen Benutzer aus der Liste, um einen Chat zu starten.</p>
                            </div>
                        </div>
                        <div id="chat-input-area" style="padding: 1rem; border-top: 1px solid var(--gray-200); display: none;">
                            <div style="display: flex;">
                                <input type="text" id="chat-message-input" placeholder="Nachricht eingeben..." style="flex: 1; padding: 0.75rem; border-radius: 0.25rem; border: 1px solid var(--gray-300); margin-right: 0.5rem;">
                                <button id="chat-send-button" class="btn btn-primary" style="width: auto;" onclick="sendChatMessage()">Senden</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ... existing code ...

        // Chat-System Funktionalität
        document.addEventListener('DOMContentLoaded', function() {
            // Chat-Button zum Header hinzufügen
            const headerActions = document.querySelector('.header-actions');
            if (headerActions) {
                const chatButton = document.createElement('button');
                chatButton.className = 'notification-button';
                chatButton.id = 'chat-button';
                chatButton.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                    </svg>
                `;
                chatButton.onclick = function() {
                    document.getElementById('chat-system-modal').classList.add('open');
                    loadChatUsers();
                    document.getElementById('notifications-dropdown').classList.remove('open');
                    document.getElementById('profile-dropdown').classList.remove('open');
                };
                
                // Button vor dem Profil-Button einfügen
                const profileContainer = document.querySelector('.profile-container');
                if (profileContainer) {
                    headerActions.insertBefore(chatButton, profileContainer);
                } else {
                    headerActions.appendChild(chatButton);
                }
            }
            
            // Chat-Nachricht-Input-Enter-Handler
            const chatMessageInput = document.getElementById('chat-message-input');
            
            if (chatMessageInput) {
                chatMessageInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        sendChatMessage();
                    }
                });
            }
            
            // Chat-Benutzer-Suche
            const userSearch = document.getElementById('user-search');
            if (userSearch) {
                userSearch.addEventListener('input', function() {
                    loadChatUsers(this.value);
                });
            }
        });
        
        // Globale Variablen für den aktuellen Chat
        let currentChatUser = null;
        
        // Funktion zum Laden der Chat-Benutzer
        function loadChatUsers(searchTerm = '') {
            const chatUsersList = document.getElementById('chat-users-list');
            if (!chatUsersList) return;
            
            // Chat-Benutzerliste leeren
            chatUsersList.innerHTML = '';
            
            // Alle registrierten Benutzer laden
            const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers') || '[]');
            const currentUser = JSON.parse(localStorage.getItem('zyroUser') || '{}');
            
            // Benutzer filtern (ohne den aktuellen Benutzer)
            const filteredUsers = registeredUsers.filter(user => {
                // Aktuellen Benutzer ausschließen
                if (user.username === currentUser.username) return false;
                
                // Nach Suchbegriff filtern, falls vorhanden
                if (searchTerm) {
                    const searchTermLower = searchTerm.toLowerCase();
                    return user.fullname?.toLowerCase().includes(searchTermLower) || 
                           user.username?.toLowerCase().includes(searchTermLower);
                }
                
                return true;
            });
            
            if (filteredUsers.length === 0) {
                chatUsersList.innerHTML = '<div style="padding: 1rem; text-align: center; color: var(--gray-500);">Keine Benutzer gefunden</div>';
                return;
            }
            
            // Benutzer zur Liste hinzufügen
            filteredUsers.forEach(user => {
                const userItem = document.createElement('div');
                userItem.className = 'chat-user-item';
                userItem.style.padding = '0.75rem 1rem';
                userItem.style.borderBottom = '1px solid var(--gray-200)';
                userItem.style.cursor = 'pointer';
                
                // Ungelesene Nachrichten prüfen
                const chatMessagesKey = getChatMessagesKey(currentUser.username, user.username);
                const chatMessages = JSON.parse(localStorage.getItem(chatMessagesKey) || '[]');
                const unreadCount = chatMessages.filter(msg => 
                    msg.from === user.username && msg.read === false
                ).length;
                
                userItem.innerHTML = `
                    <div style="display: flex; align-items: center;">
                        <div style="width: 2.5rem; height: 2.5rem; border-radius: 50%; background-color: var(--primary-100); color: var(--primary-600); display: flex; align-items: center; justify-content: center; font-weight: 600; margin-right: 0.75rem;">
                            ${(user.fullname || user.username).charAt(0).toUpperCase()}
                        </div>
                        <div style="flex: 1;">
                            <div style="font-weight: 500;">${user.fullname || user.username}</div>
                            <div style="font-size: 0.75rem; color: var(--gray-500);">${user.school || ''}</div>
                        </div>
                        ${unreadCount > 0 ? `<div style="width: 1.5rem; height: 1.5rem; border-radius: 50%; background-color: var(--primary-500); color: white; display: flex; align-items: center; justify-content: center; font-size: 0.75rem;">${unreadCount}</div>` : ''}
                    </div>
                `;
                
                userItem.addEventListener('click', function() {
                    // Chat-Benutzer auswählen
                    document.querySelectorAll('.chat-user-item').forEach(item => {
                        item.style.backgroundColor = '';
                    });
                    this.style.backgroundColor = 'var(--primary-50)';
                    
                    // Ausgewählten Benutzer speichern
                    currentChatUser = user;
                    
                    // Chat-Nachrichten laden
                    loadChatMessages(user);
                    
                    // Chat-Eingabefeld anzeigen
                    document.getElementById('chat-input-area').style.display = 'block';
                });
                
                chatUsersList.appendChild(userItem);
            });
        }
        
        // Funktion zum Laden der Chat-Nachrichten
        function loadChatMessages(chatUser) {
            const chatMessages = document.getElementById('chat-messages');
            if (!chatMessages) return;
            
            // Chat-Nachrichten leeren
            chatMessages.innerHTML = '';
            
            // Aktuellen Benutzer laden
            const currentUser = JSON.parse(localStorage.getItem('zyroUser') || '{}');
            
            // Chat-Header hinzufügen
            const chatHeader = document.createElement('div');
            chatHeader.style.textAlign = 'center';
            chatHeader.style.padding = '0.5rem';
            chatHeader.style.marginBottom = '1rem';
            chatHeader.style.borderBottom = '1px solid var(--gray-200)';
            chatHeader.innerHTML = `<h3>Chat mit ${chatUser.fullname || chatUser.username}</h3>`;
            chatMessages.appendChild(chatHeader);
            
            // Chat-Nachrichten-Key generieren
            const chatMessagesKey = getChatMessagesKey(currentUser.username, chatUser.username);
            
            // Chat-Nachrichten laden
            let messages = JSON.parse(localStorage.getItem(chatMessagesKey) || '[]');
            
            if (messages.length === 0) {
                const emptyChat = document.createElement('div');
                emptyChat.style.textAlign = 'center';
                emptyChat.style.padding = '2rem';
                emptyChat.style.color = 'var(--gray-500)';
                emptyChat.innerHTML = `
                    <p>Noch keine Nachrichten. Schreibe etwas, um den Chat zu starten!</p>
                `;
                chatMessages.appendChild(emptyChat);
                return;
            }
            
            // Nachrichten als gelesen markieren
            messages = messages.map(msg => {
                if (msg.from === chatUser.username) {
                    return { ...msg, read: true };
                }
                return msg;
            });
            
            // Aktualisierte Nachrichten speichern
            localStorage.setItem(chatMessagesKey, JSON.stringify(messages));
            
            // Badge-Anzeige aktualisieren
            const userItem = document.querySelector(`.chat-user-item:nth-child(${Array.from(document.querySelectorAll('.chat-user-item')).findIndex(item => item.textContent.includes(chatUser.username)) + 1})`);
            if (userItem) {
                const badge = userItem.querySelector('div[style*="border-radius: 50%"]');
                if (badge) {
                    badge.remove();
                }
            }
            
            // Nachrichten anzeigen
            let lastDate = null;
            
            messages.forEach(message => {
                // Datum der Nachricht
                const messageDate = new Date(message.timestamp);
                const formattedDate = messageDate.toLocaleDateString('de-DE', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
                
                // Datumstrenner anzeigen, wenn es ein neuer Tag ist
                if (lastDate !== formattedDate) {
                    const dateDivider = document.createElement('div');
                    dateDivider.style.textAlign = 'center';
                    dateDivider.style.margin = '1rem 0';
                    dateDivider.style.position = 'relative';
                    dateDivider.innerHTML = `
                        <span style="background-color: var(--gray-50); padding: 0 0.5rem; position: relative; z-index: 1; color: var(--gray-500); font-size: 0.75rem;">
                            ${formattedDate}
                        </span>
                        <div style="position: absolute; top: 50%; left: 0; right: 0; height: 1px; background-color: var(--gray-200); transform: translateY(-50%); z-index: 0;"></div>
                    `;
                    chatMessages.appendChild(dateDivider);
                    lastDate = formattedDate;
                }
                
                // Nachricht erstellen
                const messageItem = document.createElement('div');
                messageItem.className = `chat-message ${message.from === currentUser.username ? 'sent' : 'received'}`;
                messageItem.style.maxWidth = '70%';
                messageItem.style.margin = '0.5rem 0';
                messageItem.style.padding = '0.75rem 1rem';
                messageItem.style.borderRadius = '0.5rem';
                messageItem.style.wordBreak = 'break-word';
                
                if (message.from === currentUser.username) {
                    // Eigene Nachricht (rechts)
                    messageItem.style.marginLeft = 'auto';
                    messageItem.style.backgroundColor = 'var(--primary-500)';
                    messageItem.style.color = 'white';
                    messageItem.style.borderBottomRightRadius = '0';
                } else {
                    // Fremde Nachricht (links)
                    messageItem.style.marginRight = 'auto';
                    messageItem.style.backgroundColor = 'white';
                    messageItem.style.border = '1px solid var(--gray-200)';
                    messageItem.style.borderBottomLeftRadius = '0';
                }
                
                // Uhrzeit formatieren
                const formattedTime = messageDate.toLocaleTimeString('de-DE', { hour: '2-digit', minute: '2-digit' });
                
                messageItem.innerHTML = `
                    <div>${message.text}</div>
                    <div style="font-size: 0.7rem; text-align: right; margin-top: 0.25rem; opacity: 0.8;">${formattedTime}</div>
                `;
                
                chatMessages.appendChild(messageItem);
            });
            
            // Zum Ende des Chats scrollen
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        // Funktion zum Senden einer Chat-Nachricht
        function sendChatMessage() {
            if (!currentChatUser) return;
            
            const messageInput = document.getElementById('chat-message-input');
            const message = messageInput.value.trim();
            
            if (!message) return;
            
            // Aktuellen Benutzer laden
            const currentUser = JSON.parse(localStorage.getItem('zyroUser') || '{}');
            
            // Chat-Nachrichten-Key generieren
            const chatMessagesKey = getChatMessagesKey(currentUser.username, currentChatUser.username);
            
            // Bestehende Nachrichten laden
            const chatMessages = JSON.parse(localStorage.getItem(chatMessagesKey) || '[]');
            
            // Neue Nachricht erstellen
            const newMessage = {
                from: currentUser.username,
                to: currentChatUser.username,
                text: message,
                timestamp: new Date().toISOString(),
                read: false
            };
            
            // Nachricht zu bestehenden Nachrichten hinzufügen
            chatMessages.push(newMessage);
            
            // Aktualisierte Nachrichten speichern
            localStorage.setItem(chatMessagesKey, JSON.stringify(chatMessages));
            
            // Nachrichteneingabe leeren
            messageInput.value = '';
            
            // Chat-Nachrichten neu laden
            loadChatMessages(currentChatUser);
            
            // Fokus auf Eingabefeld setzen
            messageInput.focus();
        }
        
        // Hilfsfunktion zum Generieren eines eindeutigen Chat-Nachrichten-Keys
        function getChatMessagesKey(user1, user2) {
            // Benutzernamen alphabetisch sortieren, um sicherzustellen, dass der Key immer gleich ist
            const sortedUsers = [user1, user2].sort();
            return `chat_messages_${sortedUsers[0]}_${sortedUsers[1]}`;
        }
    </script>

    <script>
        // ... existing code ...
    </script>
</body>
</html> 
